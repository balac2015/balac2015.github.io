<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><title>使用 NextAuth.js 给 Next.js 应用添加鉴权与认证</title><meta name="robots" content="follow, index"/><meta name="description" content="在上一篇文章中，我们使用 prisma 和 Next.js，创建了一个视频网站，本文将继续开发视频网站，实现邮箱登录、 Github 授权登录，以及密码登录。"/><meta property="og:url" content="https://github.com/balac2015/blog/%E4%BD%BF%E7%94%A8%20NextAuth.js%20%E7%BB%99%20Next.js%20%E5%BA%94%E7%94%A8%E6%B7%BB%E5%8A%A0%E9%89%B4%E6%9D%83%E4%B8%8E%E8%AE%A4%E8%AF%81"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Coding 工坊 | 随风"/><meta property="og:description" content="在上一篇文章中，我们使用 prisma 和 Next.js，创建了一个视频网站，本文将继续开发视频网站，实现邮箱登录、 Github 授权登录，以及密码登录。"/><meta property="og:title" content="使用 NextAuth.js 给 Next.js 应用添加鉴权与认证"/><meta property="og:image" content="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fca150f8a98e4692ba770f4523171bf5~tplv-k3u1fbpfcp-watermark.image?"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site"/><meta name="twitter:title" content="使用 NextAuth.js 给 Next.js 应用添加鉴权与认证"/><meta name="twitter:description" content="在上一篇文章中，我们使用 prisma 和 Next.js，创建了一个视频网站，本文将继续开发视频网站，实现邮箱登录、 Github 授权登录，以及密码登录。"/><meta name="twitter:image" content="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fca150f8a98e4692ba770f4523171bf5~tplv-k3u1fbpfcp-watermark.image?"/><meta property="article:published_time" content="2022-10-17T16:12:49.000Z"/><meta property="article:modified_time" content="2023-01-25T03:42:55.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://github.com/balac2015/blog/使用 NextAuth.js 给 Next.js 应用添加鉴权与认证"
  },
  "headline": "使用 NextAuth.js 给 Next.js 应用添加鉴权与认证",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fca150f8a98e4692ba770f4523171bf5~tplv-k3u1fbpfcp-watermark.image?"
    }
  ],
  "datePublished": "2022-10-17T16:12:49.000Z",
  "dateModified": "2023-01-25T03:42:55.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "随风"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "随风",
    "logo": {
      "@type": "ImageObject",
      "url": "https://github.com/balac2015/static/images/logo.png"
    }
  },
  "description": "在上一篇文章中，我们使用 prisma 和 Next.js，创建了一个视频网站，本文将继续开发视频网站，实现邮箱登录、 Github 授权登录，以及密码登录。"
}</script><meta name="next-head-count" content="20"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" content="#000000"/><meta name="referrer" content="no-referrer"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/css/abb8fa3e48c59e29.css" as="style"/><link rel="stylesheet" href="/_next/static/css/abb8fa3e48c59e29.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-1690aa2475cf3a90.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-b4cdd9636ac3694c.js" defer=""></script><script src="/_next/static/chunks/pages/_app-b326530c3f1b0167.js" defer=""></script><script src="/_next/static/chunks/410-dc08c716b48ef576.js" defer=""></script><script src="/_next/static/chunks/606-dfa1dde35c330eb8.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-a12f8dbad1f7fc24.js" defer=""></script><script src="/_next/static/xRVIygn0gkexXE3qpo3Pp/_buildManifest.js" defer=""></script><script src="/_next/static/xRVIygn0gkexXE3qpo3Pp/_ssgManifest.js" defer=""></script><script src="/_next/static/xRVIygn0gkexXE3qpo3Pp/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><h1><a aria-label="随风小站" href="/"><div class="flex items-center justify-between"><span><svg width="52" height="26" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><image xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAaCAYAAADFTB7LAAAAAXNSR0IArs4c6QAAAHplWElmTU0AKgAAAAgAAwESAAMAAAABAAEAAAExAAIAAAAeAAAAModpAAQAAAABAAAAUAAAAABBZG9iZSBQaG90b3Nob3AgQ1M2IChXaW5kb3dzKQAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAKKADAAQAAAABAAAAGgAAAACQIupnAAAEEWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNi4wLjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgICAgICAgICAgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiCiAgICAgICAgICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8eG1wTU06RG9jdW1lbnRJRD54bXAuZGlkOjdFNDI1QUQ2RkQxNzExRTg5RUUyRDA2RDA3NDUyMUM1PC94bXBNTTpEb2N1bWVudElEPgogICAgICAgICA8eG1wTU06SW5zdGFuY2VJRD54bXAuaWlkOjdFNDI1QUQ1RkQxNzExRTg5RUUyRDA2RDA3NDUyMUM1PC94bXBNTTpJbnN0YW5jZUlEPgogICAgICAgICA8eG1wTU06RGVyaXZlZEZyb20gcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPgogICAgICAgICAgICA8c3RSZWY6aW5zdGFuY2VJRD54bXAuaWlkOjdFNDI1QUQzRkQxNzExRTg5RUUyRDA2RDA3NDUyMUM1PC9zdFJlZjppbnN0YW5jZUlEPgogICAgICAgICAgICA8c3RSZWY6ZG9jdW1lbnRJRD54bXAuZGlkOjdFNDI1QUQ0RkQxNzExRTg5RUUyRDA2RDA3NDUyMUM1PC9zdFJlZjpkb2N1bWVudElEPgogICAgICAgICA8L3htcE1NOkRlcml2ZWRGcm9tPgogICAgICAgICA8eG1wOkNyZWF0b3JUb29sPkFkb2JlIFBob3Rvc2hvcCBDUzYgKFdpbmRvd3MpPC94bXA6Q3JlYXRvclRvb2w+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo0psFQAAACSElEQVRYCc2WMUhVURjH79VQEISKDAfFAqVBbHDOLcFNB0scinJrkrbarMFBEAxSQXCJWuQNurgIEoJTOBRSrdFghqZgaIWv5+8v56qvd73vnKM37gc/znnnfN//+99z73v3BYFFFAqFengB67ALc9BsUZpuCiYuwjD8hH9jk4Vb6TpIUKf5Q9g44SrPfBam4a9Z32O8myCTzhZNnxsDGvbhDbRG3Zg/gD+gkPHBaC/1kWY9EJ3QW+YtcU1Z74IdiGKESRiXe25rNLgOW6ajvghVSeLst8OaydfwCi4k1XjvIVwF70CxAjU2YuRdg48QRY5JpU2tUw6io6bDV8YGl2LyL8Oyqdcw4lJfNhdBPU967rahrWxBTAJ1NaBnViGtzpg09yWE6kDPkb6tt90VjiuM1hdGhcba413PGSIvpUY88pQoKkOnA3SxiomiTZ8PiOj0Fn1qT6tBbwgUutUdp+VZrSOgq31mlWyZhF4lLIHiM1RblpakVbDyA/ZKds6wEIZhnvJ7sAU34Cn4hbnCJ37VyVVo94LiF8S+kZIVgkAnqKtMJTjJHMJToFs87tNEBjd9Ch1qHpP7CTo5xTsOdYepMrjhWuSSzynukt8Pv2EMk00u9f/jBANMvsfUfbgCeiVavxAigwWXq/LJxeQMdfpNXIcFTM5DH1xN0gtJGCChGoHJpMTz2qOf/jPKaDfchEvwHVbhAz5eMx6F/rtps/FoJeUJBnS3lgxlu+kW68gzGzK4lll3GJPBb5DPqskKnol9YzKTHg8A2r/9Qs/XFFsAAAAASUVORK5CYII=" height="26" width="40"></image><image href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAaCAYAAADFTB7LAAAAAXNSR0IArs4c6QAAAHplWElmTU0AKgAAAAgAAwESAAMAAAABAAEAAAExAAIAAAAeAAAAModpAAQAAAABAAAAUAAAAABBZG9iZSBQaG90b3Nob3AgQ1M2IChXaW5kb3dzKQAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAKKADAAQAAAABAAAAGgAAAACQIupnAAAEEWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNi4wLjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgICAgICAgICAgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiCiAgICAgICAgICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8eG1wTU06RG9jdW1lbnRJRD54bXAuZGlkOjdFNDI1QUQ2RkQxNzExRTg5RUUyRDA2RDA3NDUyMUM1PC94bXBNTTpEb2N1bWVudElEPgogICAgICAgICA8eG1wTU06SW5zdGFuY2VJRD54bXAuaWlkOjdFNDI1QUQ1RkQxNzExRTg5RUUyRDA2RDA3NDUyMUM1PC94bXBNTTpJbnN0YW5jZUlEPgogICAgICAgICA8eG1wTU06RGVyaXZlZEZyb20gcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPgogICAgICAgICAgICA8c3RSZWY6aW5zdGFuY2VJRD54bXAuaWlkOjdFNDI1QUQzRkQxNzExRTg5RUUyRDA2RDA3NDUyMUM1PC9zdFJlZjppbnN0YW5jZUlEPgogICAgICAgICAgICA8c3RSZWY6ZG9jdW1lbnRJRD54bXAuZGlkOjdFNDI1QUQ0RkQxNzExRTg5RUUyRDA2RDA3NDUyMUM1PC9zdFJlZjpkb2N1bWVudElEPgogICAgICAgICA8L3htcE1NOkRlcml2ZWRGcm9tPgogICAgICAgICA8eG1wOkNyZWF0b3JUb29sPkFkb2JlIFBob3Rvc2hvcCBDUzYgKFdpbmRvd3MpPC94bXA6Q3JlYXRvclRvb2w+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo0psFQAAACSElEQVRYCc2WMUhVURjH79VQEISKDAfFAqVBbHDOLcFNB0scinJrkrbarMFBEAxSQXCJWuQNurgIEoJTOBRSrdFghqZgaIWv5+8v56qvd73vnKM37gc/znnnfN//+99z73v3BYFFFAqFengB67ALc9BsUZpuCiYuwjD8hH9jk4Vb6TpIUKf5Q9g44SrPfBam4a9Z32O8myCTzhZNnxsDGvbhDbRG3Zg/gD+gkPHBaC/1kWY9EJ3QW+YtcU1Z74IdiGKESRiXe25rNLgOW6ajvghVSeLst8OaydfwCi4k1XjvIVwF70CxAjU2YuRdg48QRY5JpU2tUw6io6bDV8YGl2LyL8Oyqdcw4lJfNhdBPU967rahrWxBTAJ1NaBnViGtzpg09yWE6kDPkb6tt90VjiuM1hdGhcba413PGSIvpUY88pQoKkOnA3SxiomiTZ8PiOj0Fn1qT6tBbwgUutUdp+VZrSOgq31mlWyZhF4lLIHiM1RblpakVbDyA/ZKds6wEIZhnvJ7sAU34Cn4hbnCJ37VyVVo94LiF8S+kZIVgkAnqKtMJTjJHMJToFs87tNEBjd9Ch1qHpP7CTo5xTsOdYepMrjhWuSSzynukt8Pv2EMk00u9f/jBANMvsfUfbgCeiVavxAigwWXq/LJxeQMdfpNXIcFTM5DH1xN0gtJGCChGoHJpMTz2qOf/jPKaDfchEvwHVbhAz5eMx6F/rtps/FoJeUJBnS3lgxlu+kW68gzGzK4lll3GJPBb5DPqskKnol9YzKTHg8A2r/9Qs/XFFsAAAAASUVORK5CYII=" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAaCAYAAADFTB7LAAAAAXNSR0IArs4c6QAAAHplWElmTU0AKgAAAAgAAwESAAMAAAABAAEAAAExAAIAAAAeAAAAModpAAQAAAABAAAAUAAAAABBZG9iZSBQaG90b3Nob3AgQ1M2IChXaW5kb3dzKQAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAKKADAAQAAAABAAAAGgAAAACQIupnAAAEEWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNi4wLjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgICAgICAgICAgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiCiAgICAgICAgICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8eG1wTU06RG9jdW1lbnRJRD54bXAuZGlkOjdFNDI1QUQ2RkQxNzExRTg5RUUyRDA2RDA3NDUyMUM1PC94bXBNTTpEb2N1bWVudElEPgogICAgICAgICA8eG1wTU06SW5zdGFuY2VJRD54bXAuaWlkOjdFNDI1QUQ1RkQxNzExRTg5RUUyRDA2RDA3NDUyMUM1PC94bXBNTTpJbnN0YW5jZUlEPgogICAgICAgICA8eG1wTU06RGVyaXZlZEZyb20gcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPgogICAgICAgICAgICA8c3RSZWY6aW5zdGFuY2VJRD54bXAuaWlkOjdFNDI1QUQzRkQxNzExRTg5RUUyRDA2RDA3NDUyMUM1PC9zdFJlZjppbnN0YW5jZUlEPgogICAgICAgICAgICA8c3RSZWY6ZG9jdW1lbnRJRD54bXAuZGlkOjdFNDI1QUQ0RkQxNzExRTg5RUUyRDA2RDA3NDUyMUM1PC9zdFJlZjpkb2N1bWVudElEPgogICAgICAgICA8L3htcE1NOkRlcml2ZWRGcm9tPgogICAgICAgICA8eG1wOkNyZWF0b3JUb29sPkFkb2JlIFBob3Rvc2hvcCBDUzYgKFdpbmRvd3MpPC94bXA6Q3JlYXRvclRvb2w+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo0psFQAAACSElEQVRYCc2WMUhVURjH79VQEISKDAfFAqVBbHDOLcFNB0scinJrkrbarMFBEAxSQXCJWuQNurgIEoJTOBRSrdFghqZgaIWv5+8v56qvd73vnKM37gc/znnnfN//+99z73v3BYFFFAqFengB67ALc9BsUZpuCiYuwjD8hH9jk4Vb6TpIUKf5Q9g44SrPfBam4a9Z32O8myCTzhZNnxsDGvbhDbRG3Zg/gD+gkPHBaC/1kWY9EJ3QW+YtcU1Z74IdiGKESRiXe25rNLgOW6ajvghVSeLst8OaydfwCi4k1XjvIVwF70CxAjU2YuRdg48QRY5JpU2tUw6io6bDV8YGl2LyL8Oyqdcw4lJfNhdBPU967rahrWxBTAJ1NaBnViGtzpg09yWE6kDPkb6tt90VjiuM1hdGhcba413PGSIvpUY88pQoKkOnA3SxiomiTZ8PiOj0Fn1qT6tBbwgUutUdp+VZrSOgq31mlWyZhF4lLIHiM1RblpakVbDyA/ZKds6wEIZhnvJ7sAU34Cn4hbnCJ37VyVVo94LiF8S+kZIVgkAnqKtMJTjJHMJToFs87tNEBjd9Ch1qHpP7CTo5xTsOdYepMrjhWuSSzynukt8Pv2EMk00u9f/jBANMvsfUfbgCeiVavxAigwWXq/LJxeQMdfpNXIcFTM5DH1xN0gtJGCChGoHJpMTz2qOf/jPKaDfchEvwHVbhAz5eMx6F/rtps/FoJeUJBnS3lgxlu+kW68gzGzK4lll3GJPBb5DPqskKnol9YzKTHg8A2r/9Qs/XFFsAAAAASUVORK5CYII=" height="26" width="40" x="15"></image></svg></span><div class="hidden text-2xl font-semibold sm:block">随风小站</div></div></a></h1><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">文章</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">标签</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/projects">项目</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/boilerplate">模板</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/about">关于</a></div><div class="ml-1 mr-1 flex items-center sm:ml-4"><a class="block p-1" title="RSS" href="/feed.xml"><svg fill="currentColor" class="h-5 w-5" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M3.75 3a.75.75 0 00-.75.75v.5c0 .414.336.75.75.75H4c6.075 0 11 4.925 11 11v.25c0 .414.336.75.75.75h.5a.75.75 0 00.75-.75V16C17 8.82 11.18 3 4 3h-.25z"></path><path d="M3 8.75A.75.75 0 013.75 8H4a8 8 0 018 8v.25a.75.75 0 01-.75.75h-.5a.75.75 0 01-.75-.75V16a6 6 0 00-6-6h-.25A.75.75 0 013 9.25v-.5zM7 15a2 2 0 11-4 0 2 2 0 014 0z"></path></svg></a><button aria-label="Toggle Dark Mode" type="button" class="h-7 w-7 rounded p-1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button></div><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-50 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">文章</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">标签</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/projects">项目</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/boilerplate">模板</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">关于</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div style="transform:translateX(-100%)" class="fixed top-0 left-0 h-1 w-full bg-primary-500 backdrop-blur-3xl transition-transform duration-150"></div><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2022-10-17T16:12:49.000Z">2022年10月18日星期二</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">使用 NextAuth.js 给 Next.js 应用添加鉴权与认证</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><div class=""><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><img alt="avatar" src="/static/images/avatar.jpeg" width="38px" height="38px" class="h-10 w-10 rounded-full"/><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">作者</dt><dd class="text-gray-900 dark:text-gray-100">随风</dd></dl></li></ul></dd></dl><h2 class="pt-6 text-xs font-bold uppercase tracking-wide text-gray-500 dark:text-gray-400">目录</h2><ul class="py-4 text-sm font-medium leading-relaxed xl:border-b xl:border-gray-200 xl:dark:border-gray-700"><li class="false"><a class="text-primary-500" href="#前言">前言</a></li><li class="false"><a class="text-primary-500" href="#nextjs-应用接入-nextauth">Next.js 应用接入 NextAuth</a></li><li class="ml-6"><a class="text-primary-500" href="#安装">安装</a></li><li class="ml-6"><a class="text-primary-500" href="#授权-api">授权 api</a></li><li class="false"><a class="text-primary-500" href="#github-授权流程">Github 授权流程</a></li><li class="ml-6"><a class="text-primary-500" href="#注册-github-oauth-application">注册 GitHub OAuth Application</a></li><li class="ml-6"><a class="text-primary-500" href="#配置-pages_appts">配置 pages/_app.ts</a></li><li class="false"><a class="text-primary-500" href="#客户端获取登录信息">客户端获取登录信息</a></li><li class="false"><a class="text-primary-500" href="#ssr-页面获取登录信息">SSR 页面获取登录信息</a></li><li class="false"><a class="text-primary-500" href="#prisma-适配">Prisma 适配</a></li><li class="ml-6"><a class="text-primary-500" href="#服务端渲染我的视频">服务端渲染我的视频</a></li><li class="false"><a class="text-primary-500" href="#邮箱授权登录">邮箱授权登录</a></li><li class="ml-6"><a class="text-primary-500" href="#更改邮件模板">更改邮件模板</a></li><li class="false"><a class="text-primary-500" href="#密码登录">密码登录</a></li><li class="false"><a class="text-primary-500" href="#自定义登录页面">自定义登录页面</a></li><li class="false"><a class="text-primary-500" href="#小结">小结</a></li><li class="false"><a class="text-primary-500" href="#后续">后续</a></li></ul></div><div class="xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="mt-6"><img alt="使用 NextAuth.js 给 Next.js 应用添加鉴权与认证" class="w-full rounded object-cover shadow-lg" src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fca150f8a98e4692ba770f4523171bf5~tplv-k3u1fbpfcp-watermark.image?"/></div><div class="prose max-w-none break-words pt-10 pb-8 dark:prose-dark"><hr/><p>highlight: monokai theme: vuepress</p><hr/><blockquote><p>文章为稀土掘金技术社区首发签约文章，14 天内禁止转载，14 天后未获授权禁止转载，侵权必究！</p></blockquote><h2 id="前言"><a href="#前言" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>前言</h2><p>在系统中要实现身份验证是一件比较麻烦的事情，比如集成邮箱登录，手机号登录，以及其他第三方登录等，但是有了<a target="_blank" rel="noopener noreferrer" href="https://next-auth.js.org/" title="Next-auth.js">NextAuth.js</a>，一切就变得简单。正如官网说的添加身份验证，只要几分钟就可以实现。在上一篇文章中，我们使用 prisma 和 Next.js，创建了一个视频网站，但我们还没有实现用户的注册与登录，本文将继续开发视频网站，实现邮箱登录、 Github 授权登录，以及密码登录。那么，一起来看看吧！</p><blockquote><p>文中涉及代码全部托管在 <a target="_blank" rel="noopener noreferrer" href="https://github.com/maqi1520/next-prisma-video-app" title="GitHub 仓库代码">GitHub 仓库</a>中。</p></blockquote><h2 id="nextjs-应用接入-nextauth"><a href="#nextjs-应用接入-nextauth" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Next.js 应用接入 NextAuth</h2><p>NextAuth.js 是 Next.js 应用程序的完整开源身份验证解决方案，专门为 Next.js 设计，NextAuth 的特点：</p><ol><li>灵活且易于使用，支持 OAuth1.0 OAuth2.0 和 OpenId 链接；</li><li>灵活数据管理，可以不使用数据库，也可以选择使用 MySQL, MariaDB, Postgres, SQL Server, MongoDB 以及 SQLite。</li><li>默认安全，默认 Cookie 机制，可开启 JSON Web Token；</li><li>NextAuth 推进无密码的登录机制</li><li>支持 serverless 部署</li></ol><h3 id="安装"><a href="#安装" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>安装</h3><p>首先我们使用 yarn 安装 NextAuth.js</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line"><span class="token function">yarn</span> <span class="token function">add</span> next-auth
</span></code></pre></div><h3 id="授权-api"><a href="#授权-api" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>授权 api</h3><p>要通过 NextAuth.js 获得授权， 需要先创建一个<code>pages/api/auth/[...nextauth].ts</code> 文件，它包含了所有全局 NextAuth.js 配置。</p><div class="relative"><pre><code class="language-ts code-highlight"><span class="code-line"><span class="token keyword">import</span> NextAuth <span class="token keyword">from</span> <span class="token string">&#x27;next-auth&#x27;</span>
</span><span class="code-line"><span class="token keyword">import</span> GithubProvider <span class="token keyword">from</span> <span class="token string">&#x27;next-auth/providers/github&#x27;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">export</span> <span class="token keyword">const</span> authOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token comment">// 在 providers 中配置更多授权服务</span>
</span><span class="code-line">  providers<span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-line">    <span class="token function">GithubProvider</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">      clientId<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">GITHUB_ID</span><span class="token punctuation">,</span>
</span><span class="code-line">      clientSecret<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">GITHUB_SECRET</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token comment">// ...add more providers here</span>
</span><span class="code-line">  <span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">NextAuth</span><span class="token punctuation">(</span>authOptions<span class="token punctuation">)</span>
</span></code></pre></div><p>我们先添加一种授权登录方式，首先是使用 GITHUB 登录</p><h2 id="github-授权流程"><a href="#github-授权流程" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Github 授权流程</h2><p><img alt="Github 授权流程" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/191317b9b9a64f73bedeed9a3ca2fc3d~tplv-k3u1fbpfcp-zoom-1.image"/></p><p>我之前使用过 Nodejs 集成 Github OAuth 流程，大致要分为以上 6 个步骤，需要写不少代码和接口，但使用了 Next-auth.js， 就可以非常轻松的集成到我们的应用中，几乎不用写代码。</p><h3 id="注册-github-oauth-application"><a href="#注册-github-oauth-application" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>注册 GitHub OAuth Application</h3><p>环境变量可以在 <a target="_blank" rel="noopener noreferrer" href="https://github.com/settings/applications/new">Github 开发者</a>中申请，点击注册一个新 OAuth Application：</p><p><img alt="注册 GitHub OAuth Application" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5404922894744ff8a65eb2fbf667af88~tplv-k3u1fbpfcp-zoom-1.image"/></p><p>回调地址填<code>http://localhost:3000/api/auth/callback/github</code></p><p>地址可以先填开发环境地址，待上前线前可以修改为正式域名地址，或者开发环境和生产环境单独申请。</p><p><img alt="复制GITHUB_ID" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2dc458d20a6d472795e179a30738fe8b~tplv-k3u1fbpfcp-zoom-1.image"/></p><p>注册成功过后，在页面上复制 <code>Client ID</code> 和 <code>Client secrets</code> 到 <code>.env</code> 文件中</p><div class="relative"><pre><code class="code-highlight language-text"><span class="code-line">GITHUB_ID=你注册的 GITHUB_ID
</span><span class="code-line">GITHUB_SECRET=你注册的 GITHUB_SECRET
</span></code></pre></div><h3 id="配置-pages_appts"><a href="#配置-pages_appts" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>配置 <code>pages/_app.ts</code></h3><p>为了让所有页面能够获取到 <code>Session</code>， 我们需要在 <code>pages/_app.ts</code> 外层加<code>SessionProvider</code></p><div class="relative"><pre><code class="language-ts code-highlight"><span class="code-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> SessionProvider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;next-auth/react&#x27;</span>
</span><span class="code-line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span> Component<span class="token punctuation">,</span> pageProps<span class="token operator">:</span> <span class="token punctuation">{</span> session<span class="token punctuation">,</span> <span class="token operator">...</span>pageProps <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">return</span> <span class="token punctuation">(</span>
</span><span class="code-line">    <span class="token operator">&lt;</span>SessionProvider session<span class="token operator">=</span><span class="token punctuation">{</span>session<span class="token punctuation">}</span><span class="token operator">&gt;</span>
</span><span class="code-line">      <span class="token operator">&lt;</span>Component <span class="token punctuation">{</span><span class="token operator">...</span>pageProps<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
</span><span class="code-line">    <span class="token operator">&lt;</span><span class="token operator">/</span>SessionProvider<span class="token operator">&gt;</span>
</span><span class="code-line">  <span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><h2 id="客户端获取登录信息"><a href="#客户端获取登录信息" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>客户端获取登录信息</h2><p>然后我们就可以创建一个登录组件<code>components/login-btn.tsx</code>。</p><div class="relative"><pre><code class="code-highlight language-tsx"><span class="code-line"><span class="token keyword">import</span> <span class="token imports"><span class="token punctuation">{</span> useSession<span class="token punctuation">,</span> signIn<span class="token punctuation">,</span> signOut <span class="token punctuation">}</span></span> <span class="token keyword">from</span> <span class="token string">&#x27;next-auth/react&#x27;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> data<span class="token operator">:</span> session <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>session<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">return</span> <span class="token punctuation">(</span>
</span><span class="code-line">      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mr-1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">session.user.email</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token language-javascript script"><span class="token punctuation script-punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator arrow">=&gt;</span> <span class="token function">signOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">登出</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">    <span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token language-javascript script"><span class="token punctuation script-punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator arrow">=&gt;</span> <span class="token function">signIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">登录</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>在首页引用登录组件，就可以使用 GITHUB 来登录了，一起看来看看效果吧。</p><p><img alt="GITHUB 授权登录成功" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/eae6bcd997904e5f82ba31afaa041640~tplv-k3u1fbpfcp-zoom-1.image"/></p><p><strong>注意</strong>：有时候会因为网络问题， GitHub 无法登录。我们可以设置 <code>NextAuthOptions</code> 的 <code>debug</code> 为 <code>true</code>，会在控制台看到以下错误信息:</p><p><img alt="GITHUB 授权登录超时" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e26361ca0dc543bc948b08468db4eac0~tplv-k3u1fbpfcp-zoom-1.image"/></p><p>原因是访问 GitHub 需要代理，需要将代理设置为全局模式，并且设置请求 <code>timeout</code> 时间，将超时时间延长。</p><div class="relative"><pre><code class="language-ts code-highlight"><span class="code-line"><span class="token function">GithubProvider</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">  clientId<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">GITHUB_ID</span><span class="token punctuation">,</span>
</span><span class="code-line">  clientSecret<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">GITHUB_SECRET</span><span class="token punctuation">,</span>
</span><span class="code-line">  httpOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">    timeout<span class="token operator">:</span> <span class="token number">50000</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span></code></pre></div><p>登录成功后，我们看下页面打印出来的数据，包含 GitHub 登录账户的基本信息。</p><p>通过控制台我们可以发现，<code>useSession</code> 其实就是访问了<code>http://localhost:3000/api/auth/session</code>接口获取信息，这部分是在客户端实现的，那么在服务端可以获取到用户授权信息吗？</p><h2 id="ssr-页面获取登录信息"><a href="#ssr-页面获取登录信息" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>SSR 页面获取登录信息</h2><p>回到我们要开发的视频网站，还缺少个人视频管理页面，这个页面必须是当前登录用户才能访问，没授权，是不能访问的。</p><p>新建<code>pages/me.tsx</code>，用于用户管理自己的视频。</p><div class="relative"><pre><code class="code-highlight language-tsx"><span class="code-line"><span class="token keyword">import</span> <span class="token imports"><span class="token punctuation">{</span> authOptions <span class="token punctuation">}</span></span> <span class="token keyword">from</span> <span class="token string">&#x27;@/pages/api/auth/[...nextauth]&#x27;</span>
</span><span class="code-line"><span class="token keyword">import</span> <span class="token imports"><span class="token punctuation">{</span> unstable_getServerSession <span class="token punctuation">}</span></span> <span class="token keyword">from</span> <span class="token string">&#x27;next-auth/next&#x27;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">个人中心</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getServerSideProps</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> session <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">unstable_getServerSession</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token property-access">req</span><span class="token punctuation">,</span> context<span class="token punctuation">.</span><span class="token property-access">res</span><span class="token punctuation">,</span> authOptions<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>session<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">return</span> <span class="token punctuation">{</span>
</span><span class="code-line">      redirect<span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">        destination<span class="token operator">:</span> <span class="token string">&#x27;/&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">        permanent<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">return</span> <span class="token punctuation">{</span>
</span><span class="code-line">    props<span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">      session<span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>此时访问 <code>http://localhost:3000/me</code> 若没有授权登录，则将自动跳转到首页。</p><p>看打印出的<code>session</code>值，其中没有 <code>User</code> 的 <code>id</code>，而我们的视频表关联的是 <code>UserId</code> ，因此我们需要将用户的授权信息同步到我们的数据表中。</p><h2 id="prisma-适配"><a href="#prisma-适配" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Prisma 适配</h2><p>next-auth.js 为 prisma 提供了适配器，我们只需要按官网给出的步骤依次执行</p><ol><li>安装 prisma 适配器</li></ol><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line"><span class="token function">yarn</span> <span class="token function">add</span> @next-auth/prisma-adapter
</span></code></pre></div><ol start="2"><li>在 NextAuth.js 配置 prisma 适配器</li></ol><div class="relative"><pre><code class="language-ts code-highlight"><span class="code-line"><span class="token keyword">import</span> NextAuth<span class="token punctuation">,</span> <span class="token punctuation">{</span> NextAuthOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;next-auth&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">import</span> EmailProvider <span class="token keyword">from</span> <span class="token string">&quot;next-auth/providers/email&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">import</span> GithubProvider <span class="token keyword">from</span> <span class="token string">&quot;next-auth/providers/github&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">import</span> prisma <span class="token keyword">from</span> <span class="token string">&quot;@/lib/prisma&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token operator">+</span> <span class="token keyword">import</span> <span class="token punctuation">{</span> PrismaAdapter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@next-auth/prisma-adapter&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">export</span> <span class="token keyword">const</span> authOptions<span class="token operator">:</span> NextAuthOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token comment">//debug: true,</span>
</span><span class="code-line"><span class="token operator">+</span>  adapter<span class="token operator">:</span> <span class="token function">PrismaAdapter</span><span class="token punctuation">(</span>prisma<span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">  providers<span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-line">    <span class="token comment">// OAuth authentication providers...</span>
</span><span class="code-line">    <span class="token function">GithubProvider</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">      clientId<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">GITHUB_ID</span><span class="token punctuation">,</span>
</span><span class="code-line">      clientSecret<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">GITHUB_SECRET</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token operator">+</span>  callbacks<span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line"><span class="token operator">+</span>    <span class="token function function-variable">session</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> session<span class="token punctuation">,</span> token<span class="token punctuation">,</span> user <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line"><span class="token operator">+</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>session<span class="token operator">?.</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line"><span class="token operator">+</span>        session<span class="token punctuation">.</span>user<span class="token punctuation">.</span>id <span class="token operator">=</span> user<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
</span><span class="code-line"><span class="token operator">+</span>      <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token operator">+</span>      <span class="token keyword">return</span> session<span class="token punctuation">;</span>
</span><span class="code-line"><span class="token operator">+</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token operator">+</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">NextAuth</span><span class="token punctuation">(</span>authOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre></div><p>添加 <code>callbacks</code> 函数，将 <code>user</code> <code>id</code> 赋值给 <code>session</code> 中的 <code>user</code> <code>id</code>，方便后面接口中可以直接获取用户 <code>id</code>。</p><ol start="3"><li>添加 prisma Schema 中添加模型</li></ol><div class="relative"><pre><code class="code-highlight language-js"><span class="code-line">model <span class="token maybe-class-name">Account</span> <span class="token punctuation">{</span>
</span><span class="code-line">  id                 <span class="token class-name known-class-name">String</span>  @id @<span class="token keyword module">default</span><span class="token punctuation">(</span><span class="token function">cuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">  userId             <span class="token class-name known-class-name">String</span>
</span><span class="code-line">  type               <span class="token class-name known-class-name">String</span>
</span><span class="code-line">  provider           <span class="token class-name known-class-name">String</span>
</span><span class="code-line">  providerAccountId  <span class="token class-name known-class-name">String</span>
</span><span class="code-line">  refresh_token      <span class="token class-name known-class-name">String</span><span class="token operator">?</span>  @db<span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Text</span></span>
</span><span class="code-line">  access_token       <span class="token class-name known-class-name">String</span><span class="token operator">?</span>  @db<span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Text</span></span>
</span><span class="code-line">  expires_at         <span class="token maybe-class-name">Int</span><span class="token operator">?</span>
</span><span class="code-line">  token_type         <span class="token class-name known-class-name">String</span><span class="token operator">?</span>
</span><span class="code-line">  scope              <span class="token class-name known-class-name">String</span><span class="token operator">?</span>
</span><span class="code-line">  id_token           <span class="token class-name known-class-name">String</span><span class="token operator">?</span>  @db<span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Text</span></span>
</span><span class="code-line">  session_state      <span class="token class-name known-class-name">String</span><span class="token operator">?</span>
</span><span class="code-line">
</span><span class="code-line">  user <span class="token maybe-class-name">User</span> @<span class="token function">relation</span><span class="token punctuation">(</span>fields<span class="token operator">:</span> <span class="token punctuation">[</span>userId<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">references</span><span class="token operator">:</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">onDelete</span><span class="token operator">:</span> <span class="token maybe-class-name">Cascade</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">  @@<span class="token function">unique</span><span class="token punctuation">(</span><span class="token punctuation">[</span>provider<span class="token punctuation">,</span> providerAccountId<span class="token punctuation">]</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">model <span class="token maybe-class-name">Session</span> <span class="token punctuation">{</span>
</span><span class="code-line">  id           <span class="token class-name known-class-name">String</span>   @id @<span class="token keyword module">default</span><span class="token punctuation">(</span><span class="token function">cuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">  sessionToken <span class="token class-name known-class-name">String</span>   @unique
</span><span class="code-line">  userId       <span class="token class-name known-class-name">String</span>
</span><span class="code-line">  expires      <span class="token maybe-class-name">DateTime</span>
</span><span class="code-line">  user         <span class="token maybe-class-name">User</span>     @<span class="token function">relation</span><span class="token punctuation">(</span>fields<span class="token operator">:</span> <span class="token punctuation">[</span>userId<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">references</span><span class="token operator">:</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">onDelete</span><span class="token operator">:</span> <span class="token maybe-class-name">Cascade</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">model <span class="token maybe-class-name">User</span> <span class="token punctuation">{</span>
</span><span class="code-line">  id            <span class="token class-name known-class-name">String</span>    @id @<span class="token keyword module">default</span><span class="token punctuation">(</span><span class="token function">cuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">  name          <span class="token class-name known-class-name">String</span><span class="token operator">?</span>
</span><span class="code-line">  email         <span class="token class-name known-class-name">String</span><span class="token operator">?</span>   @unique
</span><span class="code-line">  emailVerified <span class="token maybe-class-name">DateTime</span><span class="token operator">?</span>
</span><span class="code-line">  image         <span class="token class-name known-class-name">String</span><span class="token operator">?</span>
</span><span class="code-line">  accounts      <span class="token maybe-class-name">Account</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
</span><span class="code-line">  sessions      <span class="token maybe-class-name">Session</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">model <span class="token maybe-class-name">VerificationToken</span> <span class="token punctuation">{</span>
</span><span class="code-line">  identifier <span class="token class-name known-class-name">String</span>
</span><span class="code-line">  token      <span class="token class-name known-class-name">String</span>   @unique
</span><span class="code-line">  expires    <span class="token maybe-class-name">DateTime</span>
</span><span class="code-line">
</span><span class="code-line">  @@<span class="token function">unique</span><span class="token punctuation">(</span><span class="token punctuation">[</span>identifier<span class="token punctuation">,</span> token<span class="token punctuation">]</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>当我们将这些模型粘贴到 Schema 后，会看到 VSCode 中有错误提示</p><p><img alt="Prisma Schema 错误提示" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/89d1c1d0b1bb4a4e857a9b81c7c4d3fe~tplv-k3u1fbpfcp-zoom-1.image"/></p><p>原因是我们之前设计的用户表 <code>id</code> 是 <code>Int</code> 类型，跟当前的 <code>Sring</code> 类型不匹配，解决办法是将 <code>Int</code> 改成 <code>String</code>，最好的做法是所有表中的 <code>id</code> 类型改成统一。</p><ol start="3"><li>迁移 Schema，生成表</li></ol><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">npx prisma migrate dev
</span></code></pre></div><p>执行完成后，我们刷新页面，重新登录页面，来看下效果</p><p><img alt="session 包含 userId" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2a95b766d31f437b97c9ed7627844bb9~tplv-k3u1fbpfcp-zoom-1.image"/></p><p><code>session</code> 中已经有了 <code>id</code>，这里我测试了下，将我 Github 默认邮箱改成另一个，也不会影响注册用户表中的信息，因为 <code>Account</code> 表中的唯一值是<code>provider + providerAccountId</code>。</p><h3 id="服务端渲染我的视频"><a href="#服务端渲染我的视频" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>服务端渲染我的视频</h3><p>在 <code>session</code> 中可以获取 <code>userId</code>，那么我们就可以在 <code>getServerSideProps</code> 获取当前用户的视频了。</p><div class="relative"><pre><code class="language-ts code-highlight"><span class="code-line"><span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getServerSideProps</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> session <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">unstable_getServerSession</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>req<span class="token punctuation">,</span> context<span class="token punctuation">.</span>res<span class="token punctuation">,</span> authOptions<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>session<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">return</span> <span class="token punctuation">{</span>
</span><span class="code-line">      redirect<span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">        destination<span class="token operator">:</span> <span class="token string">&#x27;/&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">        permanent<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> prisma<span class="token punctuation">.</span>video<span class="token punctuation">.</span><span class="token function">findMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">    where<span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">      authorId<span class="token operator">:</span> session<span class="token punctuation">.</span>user<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">    include<span class="token operator">:</span> <span class="token punctuation">{</span> author<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">return</span> <span class="token punctuation">{</span>
</span><span class="code-line">    props<span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">      session<span class="token punctuation">,</span>
</span><span class="code-line">      data<span class="token operator">:</span> <span class="token function">makeSerializable</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>这里有个问题，当我们获取 <code>user.id</code> 的时候， typescript 会提示错误，因为默认的 <code>User</code> 类型中是不包含 <code>id</code></p><p><img alt="TS 校验提示" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/45f3eb2d697b47a8a7b3795ce45d0271~tplv-k3u1fbpfcp-zoom-1.image"/></p><p>所以我们需要重写下 next-auth 中 <code>Session</code> 的接口，新建 <code>types/next-auth.d.ts</code> 输入以下代码，就可以继承默认的 <code>Session</code> TS 类型接口了</p><div class="relative"><pre><code class="language-ts code-highlight"><span class="code-line"><span class="token keyword">import</span> NextAuth<span class="token punctuation">,</span> <span class="token punctuation">{</span> DefaultSession <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;next-auth&#x27;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">&#x27;next-auth&#x27;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">interface</span> <span class="token class-name">Session</span> <span class="token punctuation">{</span>
</span><span class="code-line">    user<span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">      id<span class="token operator">:</span> <span class="token builtin">string</span>
</span><span class="code-line">    <span class="token punctuation">}</span> <span class="token operator">&amp;</span> DefaultSession<span class="token punctuation">[</span><span class="token string">&#x27;user&#x27;</span><span class="token punctuation">]</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>添加完成后，在页面中使用 <code>useSession</code>, <code>unstable_getServerSession</code> 等获取到的 <code>Session</code> 不会 TS 类型报错了。</p><h2 id="邮箱授权登录"><a href="#邮箱授权登录" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>邮箱授权登录</h2><p>有了 Github 授权登录，并且关联了数据库，那要加上邮箱授权登录，便是轻而易举。</p><p>首先安装 <code>nodemailer</code>，用于 Node.js 发送邮件</p><div class="relative"><pre><code class="language-ts code-highlight"><span class="code-line">yarn add nodemailer
</span></code></pre></div><p>然后在 <code>pages/api/auth/[...nextauth].ts</code>引入并且配置 <code>EmailProvider</code></p><div class="relative"><pre><code class="language-ts code-highlight"><span class="code-line"><span class="token keyword">import</span> EmailProvider <span class="token keyword">from</span> <span class="token string">&#x27;next-auth/providers/email&#x27;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">export</span> <span class="token keyword">const</span> authOptions<span class="token operator">:</span> NextAuthOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token comment">//debug: true,</span>
</span><span class="code-line">  adapter<span class="token operator">:</span> <span class="token function">PrismaAdapter</span><span class="token punctuation">(</span>prisma<span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">  providers<span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-line">    <span class="token function">EmailProvider</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">      server<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">EMAIL_SERVER</span><span class="token punctuation">,</span>
</span><span class="code-line">      from<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">EMAIL_FROM</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token comment">//maxAge: 24 * 60 * 60, // 设置邮箱链接失效时间，默认24小时</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token comment">// OAuth authentication providers...</span>
</span><span class="code-line">    <span class="token function">GithubProvider</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">      clientId<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">GITHUB_ID</span><span class="token punctuation">,</span>
</span><span class="code-line">      clientSecret<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">GITHUB_SECRET</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token comment">// ...</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>然后在 <code>.env</code> 文件中配置环境变量</p><div class="relative"><pre><code class="code-highlight"><span class="code-line">EMAIL_SERVER=smtp://username:password@smtp.example.com:587
</span><span class="code-line">EMAIL_FROM=NextAuth &lt;noreply@example.com&gt;
</span></code></pre></div><p>这里的 <code>EMAIL_SERVER</code> 中的 <code>username</code> 就是发件邮箱的账号，而 <code>password</code> 并不是邮箱密码，需要在邮箱设置中开启，这里我以 163 邮箱为例</p><p><img alt="163 邮箱设置" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/92f7009115f24795b663ba531dd36ae3~tplv-k3u1fbpfcp-zoom-1.image"/></p><p>登录邮箱后，在邮箱设置中开启 POP3/SMTP/IMAP 服务，点击开启，这里会需要短信验证，验证会有一个授权密码，这个授权码就是 <code>password</code>， 最后面的服务地址和端口需要根据你最终选择的 POP3/SMTP/IMAP 服务来配置，下图是 126 邮箱的服务器配置。</p><p><img alt="126邮箱服务器信息" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a94bc6fa2fb54eff97aab1e328fbdb82~tplv-k3u1fbpfcp-zoom-1.image"/></p><p>配置完成后刷新浏览器就可以使用邮箱来完成登录了，登录的邮箱账号不能是发送邮件服务的账号，比如我设置的是发送邮件服务是 163 邮箱，那我注册的时候使用 QQ 邮箱。</p><p><img alt="使用邮箱登录界面" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2e1f821360a94a489a9afd8a16e16901~tplv-k3u1fbpfcp-zoom-1.image"/></p><p>点击 “sign in with Email” 后，你就会收到如下邮件，在邮箱中点击链接，便会自动授权登录成功。</p><p><img alt="收到默认邮件模板" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6e61723698e74d4a99e9d2f000be5f1d~tplv-k3u1fbpfcp-zoom-1.image"/></p><p>登录成功后的，Session 中的信息跟我 Github 账号登录的信息是一致的，因为在数据库中，邮箱地址是唯一值。</p><p><img alt="邮箱登录成功" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/876dbb24b4724554b756ebe51b547def~tplv-k3u1fbpfcp-zoom-1.image"/></p><h3 id="更改邮件模板"><a href="#更改邮件模板" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>更改邮件模板</h3><p>有些同学会说，发送的邮件主题太丑了，我们可以定制吗？</p><p>放心，Next-auth 帮我们考虑到了 , <code>EmailProvider</code> 支持自定义模板，我们需要配置 <code>sendVerificationRequest</code> 函数</p><div class="relative"><pre><code class="language-ts code-highlight"><span class="code-line"><span class="token keyword">import</span> EmailProvider <span class="token keyword">from</span> <span class="token string">&quot;next-auth/providers/email&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token operator">...</span>
</span><span class="code-line">providers<span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-line">  <span class="token function">EmailProvider</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">    server<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">EMAIL_SERVER</span><span class="token punctuation">,</span>
</span><span class="code-line">    from<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">EMAIL_FROM</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token function">sendVerificationRequest</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">      identifier<span class="token operator">:</span> email<span class="token punctuation">,</span>
</span><span class="code-line">      url<span class="token punctuation">,</span>
</span><span class="code-line">      provider<span class="token operator">:</span> <span class="token punctuation">{</span> server<span class="token punctuation">,</span> from <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token comment">/* your function */</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">]</span>
</span></code></pre></div><p>邮件模板函数可能会很大，可以将 <code>sendVerificationRequest</code> 提取为单独文件，然后再引入；</p><div class="relative"><pre><code class="language-ts code-highlight"><span class="code-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createTransport <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;nodemailer&#x27;</span>
</span><span class="code-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> SendVerificationRequestParams <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;next-auth/providers/email&#x27;</span>
</span><span class="code-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Theme <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;next-auth&#x27;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">sendVerificationRequest</span><span class="token punctuation">(</span>params<span class="token operator">:</span> SendVerificationRequestParams<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> identifier<span class="token punctuation">,</span> url<span class="token punctuation">,</span> provider<span class="token punctuation">,</span> theme <span class="token punctuation">}</span> <span class="token operator">=</span> params
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> host <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">URL</span></span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token keyword">const</span> transport <span class="token operator">=</span> <span class="token function">createTransport</span><span class="token punctuation">(</span>provider<span class="token punctuation">.</span>server<span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> transport<span class="token punctuation">.</span><span class="token function">sendMail</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">    to<span class="token operator">:</span> identifier<span class="token punctuation">,</span>
</span><span class="code-line">    from<span class="token operator">:</span> provider<span class="token punctuation">.</span>from<span class="token punctuation">,</span>
</span><span class="code-line">    subject<span class="token operator">:</span> <span class="token template-string"><span class="token string template-punctuation">`</span><span class="token interpolation"><span class="token punctuation interpolation-punctuation">${</span>host<span class="token punctuation interpolation-punctuation">}</span></span><span class="token string"> 注册认证</span><span class="token string template-punctuation">`</span></span><span class="token punctuation">,</span>
</span><span class="code-line">    text<span class="token operator">:</span> <span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">{</span> url<span class="token punctuation">,</span> host <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">    html<span class="token operator">:</span> <span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">{</span> url<span class="token punctuation">,</span> host<span class="token punctuation">,</span> theme <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token keyword">const</span> failed <span class="token operator">=</span> result<span class="token punctuation">.</span>rejected<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>pending<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>Boolean<span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>failed<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string template-punctuation">`</span><span class="token string">Email(s) (</span><span class="token interpolation"><span class="token punctuation interpolation-punctuation">${</span>failed<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#x27;, &#x27;</span><span class="token punctuation">)</span><span class="token punctuation interpolation-punctuation">}</span></span><span class="token string">) could not be sent</span><span class="token string template-punctuation">`</span></span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">/**
</span></span><span class="code-line"><span class="token comment"> *使用HTML body 代替正文内容
</span></span><span class="code-line"><span class="token comment"> */</span>
</span><span class="code-line"><span class="token keyword">function</span> <span class="token function">html</span><span class="token punctuation">(</span>params<span class="token operator">:</span> <span class="token punctuation">{</span> url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> host<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> theme<span class="token operator">:</span> Theme <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> url<span class="token punctuation">,</span> host<span class="token punctuation">,</span> theme <span class="token punctuation">}</span> <span class="token operator">=</span> params
</span><span class="code-line">  <span class="token comment">//由于使用</span>
</span><span class="code-line">  <span class="token keyword">const</span> escapedHost <span class="token operator">=</span> host<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token language-regex regex-source"><span class="token escape special-escape">\.</span></span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&#x27;&amp;#8203;.&#x27;</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">return</span> <span class="token template-string"><span class="token string template-punctuation">`</span><span class="token string">
</span></span></span><span class="code-line"><span class="token template-string"><span class="token string">&lt;body&gt;
</span></span></span><span class="code-line"><span class="token template-string"><span class="token string">  &lt;div style=&quot;background:#f2f5f7;display: flex;justify-content: center;align-items: center; height:200px&quot;&gt;欢迎注册</span><span class="token interpolation"><span class="token punctuation interpolation-punctuation">${</span>escapedHost<span class="token punctuation interpolation-punctuation">}</span></span><span class="token string">,点击&lt;a href=&quot;</span><span class="token interpolation"><span class="token punctuation interpolation-punctuation">${</span>url<span class="token punctuation interpolation-punctuation">}</span></span><span class="token string">&quot; target=&quot;_blank&quot;&gt;登录&lt;/a&gt;&lt;/div&gt;
</span></span></span><span class="code-line"><span class="token template-string"><span class="token string">&lt;/body&gt;
</span></span></span><span class="code-line"><span class="token template-string"><span class="token string"></span><span class="token string template-punctuation">`</span></span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">/** 不支持HTML 的邮件客户端会显示下面的文本信息 */</span>
</span><span class="code-line"><span class="token keyword">function</span> <span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">{</span> url<span class="token punctuation">,</span> host <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> host<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">return</span> <span class="token template-string"><span class="token string template-punctuation">`</span><span class="token string">欢迎注册 </span><span class="token interpolation"><span class="token punctuation interpolation-punctuation">${</span>host<span class="token punctuation interpolation-punctuation">}</span></span><span class="token string">\n点击</span><span class="token interpolation"><span class="token punctuation interpolation-punctuation">${</span>url<span class="token punctuation interpolation-punctuation">}</span></span><span class="token string">登录\n\n</span><span class="token string template-punctuation">`</span></span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>当然这里我简化了模板代码， 在真实场景中，我们也可以替换 HTML 文件来实现。</p><h2 id="密码登录"><a href="#密码登录" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>密码登录</h2><p>密码登录 Next-auth 是不鼓励使用的，因为与密码相关的固有安全风险以及与支持用户名和密码具有额外复杂性。</p><p>使用密码登录需要使用 <code>CredentialsProvider</code></p><div class="relative"><pre><code class="language-ts code-highlight"><span class="code-line"><span class="token keyword">import</span> NextAuth<span class="token punctuation">,</span> <span class="token punctuation">{</span> NextAuthOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;next-auth&#x27;</span>
</span><span class="code-line"><span class="token keyword">import</span> CredentialsProvider <span class="token keyword">from</span> <span class="token string">&#x27;next-auth/providers/credentials&#x27;</span>
</span><span class="code-line"><span class="token keyword">import</span> prisma <span class="token keyword">from</span> <span class="token string">&#x27;@/lib/prisma&#x27;</span>
</span><span class="code-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> PrismaAdapter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;@next-auth/prisma-adapter&#x27;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">export</span> <span class="token keyword">const</span> authOptions<span class="token operator">:</span> NextAuthOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token comment">//debug: true,</span>
</span><span class="code-line">  adapter<span class="token operator">:</span> <span class="token function">PrismaAdapter</span><span class="token punctuation">(</span>prisma<span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">  providers<span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-line">    <span class="token function">CredentialsProvider</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token comment">// 登录按钮显示 (e.g. &quot;Sign in with Credentials&quot;)</span>
</span><span class="code-line">      name<span class="token operator">:</span> <span class="token string">&#x27;Credentials&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token comment">// credentials 用于配置登录页面的表单</span>
</span><span class="code-line">      credentials<span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">        email<span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">          label<span class="token operator">:</span> <span class="token string">&#x27;邮箱&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">          type<span class="token operator">:</span> <span class="token string">&#x27;text&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">          placeholder<span class="token operator">:</span> <span class="token string">&#x27;请输入邮箱&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">        password<span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">          label<span class="token operator">:</span> <span class="token string">&#x27;密码&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">          type<span class="token operator">:</span> <span class="token string">&#x27;password&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">          placeholder<span class="token operator">:</span> <span class="token string">&#x27;请输入密码&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token keyword">async</span> <span class="token function">authorize</span><span class="token punctuation">(</span>credentials<span class="token punctuation">,</span> req<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>credentials<span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token comment">// TODO</span>
</span><span class="code-line">        <span class="token comment">// const maybeUser= await prisma.user.findFirst({where:{</span>
</span><span class="code-line">        <span class="token comment">//   email: credentials.email,</span>
</span><span class="code-line">        <span class="token comment">//  }})</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token comment">// 根据 credentials 我们查询数据库中的信息</span>
</span><span class="code-line">        <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">          id<span class="token operator">:</span> <span class="token string">&#x27;1&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">          name<span class="token operator">:</span> <span class="token string">&#x27;xiaoma&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">          email<span class="token operator">:</span> <span class="token string">&#x27;xiaoma@example.com&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">          <span class="token comment">// 返回的对象将保存才JWT 的用户属性中</span>
</span><span class="code-line">          <span class="token keyword">return</span> user
</span><span class="code-line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
</span><span class="code-line">          <span class="token comment">// 如果返回null，则会显示一个错误，建议用户检查其详细信息。</span>
</span><span class="code-line">          <span class="token keyword">return</span> <span class="token keyword">null</span>
</span><span class="code-line">          <span class="token comment">// 跳转到错误页面，并且携带错误信息 http://localhost:3000/api/auth/error?error=用户名或密码错误</span>
</span><span class="code-line">          <span class="token comment">//throw new Error(&quot;用户名或密码错误&quot;);</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">      <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">  session<span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">    strategy<span class="token operator">:</span> <span class="token string">&#x27;jwt&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">  jwt<span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">    secret<span class="token operator">:</span> <span class="token string">&#x27;test&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">  callbacks<span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">async</span> <span class="token function">jwt</span><span class="token punctuation">(</span><span class="token punctuation">{</span> token<span class="token punctuation">,</span> user<span class="token punctuation">,</span> account<span class="token punctuation">,</span> profile<span class="token punctuation">,</span> isNewUser <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        token<span class="token punctuation">.</span>id <span class="token operator">=</span> user<span class="token punctuation">.</span>id
</span><span class="code-line">      <span class="token punctuation">}</span>
</span><span class="code-line">      <span class="token keyword">return</span> token
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token function function-variable">session</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> session<span class="token punctuation">,</span> token<span class="token punctuation">,</span> user <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>session<span class="token operator">?.</span>user <span class="token operator">&amp;&amp;</span> token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        session<span class="token punctuation">.</span>user<span class="token punctuation">.</span>id <span class="token operator">=</span> token<span class="token punctuation">.</span>id <span class="token keyword">as</span> <span class="token builtin">string</span>
</span><span class="code-line">      <span class="token punctuation">}</span>
</span><span class="code-line">      <span class="token keyword">return</span> session
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">NextAuth</span><span class="token punctuation">(</span>authOptions<span class="token punctuation">)</span>
</span></code></pre></div><p>上面代码中，我们首先需要开启 JWT 模式，在 <code>authorize</code> 方法中我们可以根据用户所填的表单信息进行数据库查询，由于我们的数据库中没有密码字段，所以上面的代码中直接返回了一个固定 <code>user</code> 信息，那真实的流程应该是：邮箱登录——&gt; 设置密码——&gt;密码登录</p><p><strong>实现效果</strong>:</p><p><img alt="密码登录界面" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/69b4253a8cae4cb5b60a0dcbd3b1d345~tplv-k3u1fbpfcp-zoom-1.image"/></p><h2 id="自定义登录页面"><a href="#自定义登录页面" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>自定义登录页面</h2><p>有同学会说，这个页面怎么这么丑，既有中文也有英文呢？显然在国内是不合适的， Next-auth 帮我们考虑到了，它支持配置自定义页面。</p><p>在 <code>pages/api/auth/[...nextauth].ts</code> 添加 <code>pages</code> 参数就可以实现自定义</p><div class="relative"><pre><code class="language-ts code-highlight"><span class="code-line">pages<span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">    signIn<span class="token operator">:</span> <span class="token string">&#x27;/auth/login&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">,</span>
</span></code></pre></div><p>自定义界面 ，可配置 <code>signIn</code>，<code>signOut</code>，<code>error</code>，<code>verifyRequest</code> 和 <code>newUser</code>，在这里，我们只配置登录页面。</p><p>登录页面的 dom 结构可以参考默认的 dom 结构， 直接复制出来就可以了。</p><p><img alt="查看默认登录界面dom" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d7dbe3e136cf4bc1b5dc550832e41dba~tplv-k3u1fbpfcp-zoom-1.image"/></p><p>我们可以看到 form 表单中，有个默认的隐藏域，提交了 <code>csrfToken</code> 的值，那么这个值该如何获取呢？</p><div class="relative"><pre><code class="code-highlight language-tsx"><span class="code-line"><span class="token keyword">import</span> <span class="token imports"><span class="token punctuation">{</span> getCsrfToken <span class="token punctuation">}</span></span> <span class="token keyword">from</span> <span class="token string">&#x27;next-auth/react&#x27;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">SignIn</span><span class="token punctuation">(</span><span class="token punctuation">{</span> csrfToken <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">return</span> <span class="token punctuation">(</span>
</span><span class="code-line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/api/auth/signin/email<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>csrfToken<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">defaultValue</span><span class="token language-javascript script"><span class="token punctuation script-punctuation">=</span><span class="token punctuation">{</span>csrfToken<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">        Email address
</span></span><span class="code-line"><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>email<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>email<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>email<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Sign in with Email</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getServerSideProps</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> csrfToken <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getCsrfToken</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token keyword">return</span> <span class="token punctuation">{</span>
</span><span class="code-line">    props<span class="token operator">:</span> <span class="token punctuation">{</span> csrfToken <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p><code>csrfToken</code> 可以通过导出的 <code>getCsrfToken</code> 方法获取，并且赋值给隐藏域 <code>csrfToken</code>，在提交表单的时候，就会自动提交该值。</p><p>最后我们来看下实现效果:</p><p><img alt="自定义登录页面" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bc4575f1b5ff491d94f555e9121c2cf2~tplv-k3u1fbpfcp-zoom-1.image"/></p><p>是不是有国内 App 的风格了呢？这里我使用了 <code>@chakra-ui/react</code> 实现代码也很简单，这里就不贴了，感兴趣的小伙伴可以直接看我的 <a target="_blank" rel="noopener noreferrer" href="https://github.com/maqi1520/next-prisma-video-app">github</a>。</p><p>还有些小伙伴会问，登录页面能否能做成弹窗呢？当然也可以。</p><div class="relative"><pre><code class="code-highlight language-tsx"><span class="code-line"><span class="token keyword">import</span> <span class="token imports"><span class="token punctuation">{</span> signIn <span class="token punctuation">}</span></span> <span class="token keyword">from</span> <span class="token string">&#x27;next-auth/react&#x27;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Login</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">return</span> <span class="token punctuation">(</span>
</span><span class="code-line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
</span></span><span class="code-line"><span class="token tag">      <span class="token attr-name">onClick</span><span class="token language-javascript script"><span class="token punctuation script-punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator arrow">=&gt;</span>
</span></span></span><span class="code-line"><span class="token tag"><span class="token language-javascript script">        <span class="token function">signIn</span><span class="token punctuation">(</span><span class="token string">&#x27;credentials&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
</span></span></span><span class="code-line"><span class="token tag"><span class="token language-javascript script">          email<span class="token operator">:</span> <span class="token string">&#x27;xiaoma@example.com&#x27;</span><span class="token punctuation">,</span>
</span></span></span><span class="code-line"><span class="token tag"><span class="token language-javascript script">          password<span class="token operator">:</span> <span class="token string">&#x27;1234&#x27;</span><span class="token punctuation">,</span>
</span></span></span><span class="code-line"><span class="token tag"><span class="token language-javascript script">        <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span></span><span class="code-line"><span class="token tag"><span class="token language-javascript script">      <span class="token punctuation">}</span></span>
</span></span><span class="code-line"><span class="token tag">    <span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">      登录
</span></span><span class="code-line"><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>界面我们可以完全自定义，写成一个组件，只需要调用内置的 <code>signIn</code> 方法即可，它会帮我们自动添加 <code>csrfToken</code> 值。</p><h2 id="小结"><a href="#小结" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>小结</h2><p>思考：国内 app 使用手机短信验证登录已经成为主流，结合前面的文章，我们该如何修改表，使用哪个 <code>providers</code> 来实现？相信你已经有了答案。</p><p>本文通过 NextAuth.js， 给我们的视频网站实现了邮箱登录、 Github 授权登录，以及密码登录。你学会了吗？若对你有帮助，记得帮我点赞。</p><h2 id="后续"><a href="#后续" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>后续</h2><p>接下来我将继续分享 Next.js 相关的实战文章，欢迎各位关注我的《Next.js 全栈开发实战》 专栏。</p><ul><li>使用 React query 给 Next.js 应用全局状态管理</li><li>使用 i18next 实现 Next.js 应用国际化</li><li>使用 Playwright 进行 Next.js 应用的端到端测试</li><li>使用 Github actions 给 Next.js 应用创建 CI/CD</li><li>使用 Docker 部署 Next.js 应用</li><li>将 Next.js 应用部署到腾讯云 serverless</li></ul><p>你对哪块内容比较感兴趣呢？欢迎在评论区留言，感谢您的阅读。</p></div><div class="border-t border-gray-200 pt-6 pb-6 text-sm text-gray-700 dark:border-gray-700 dark:text-gray-300"><div class="mb-3"><img alt="runjs-cool" width="384" height="140" src="/static/images/runjs-cool.webp"/></div><span>关注微信公众号，获取最新原创文章（首发）</span><a target="_blank" rel="noopener noreferrer" href="https://github.com/balac2015/blob/main/data/blog/使用 NextAuth.js 给 Next.js 应用添加鉴权与认证.md">View on GitHub</a></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">标签</h2><div class="mt-3 flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/reactjs">React.js</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">上一篇 文章</h2><div class="mt-3 text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/%E4%BD%BF%E7%94%A8%20Notion%20%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9B%E8%A1%8C%20Next.js%20%E5%BA%94%E7%94%A8%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91">使用 Notion 数据库进行 Next.js 应用全栈开发</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">下一篇 文章</h2><div class="mt-3 text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/%E4%BD%BF%E7%94%A8%20Vitest%20%E5%92%8C%20React%20Testing%20Library%20%E7%BB%99%20Next.js%20%E5%BA%94%E7%94%A8%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95">使用 Vitest 和 React Testing Library 给 Next.js 应用单元测试</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">← 返回文章列表</a></div></footer></div></div></article></div></main></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var d=Object.create;var t=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var u=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty;var i=a=\u003et(a,\"__esModule\",{value:!0});var k=(a,s)=\u003e()=\u003e(s||a((s={exports:{}}).exports,s),s.exports),g=(a,s)=\u003e{for(var c in s)t(a,c,{get:s[c],enumerable:!0})},o=(a,s,c,e)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let l of m(s))!N.call(a,l)\u0026\u0026(c||l!==\"default\")\u0026\u0026t(a,l,{get:()=\u003es[l],enumerable:!(e=h(s,l))||e.enumerable});return a},f=(a,s)=\u003eo(i(t(a!=null?d(u(a)):{},\"default\",!s\u0026\u0026a\u0026\u0026a.__esModule?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a),y=(a=\u003e(s,c)=\u003ea\u0026\u0026a.get(s)||(c=o(i({}),s,1),a\u0026\u0026a.set(s,c),c))(typeof WeakMap!=\"undefined\"?new WeakMap:0);var p=k((j,r)=\u003e{r.exports=_jsx_runtime});var v={};g(v,{default:()=\u003ex,frontmatter:()=\u003eb});var n=f(p()),b={title:\"\\u4F7F\\u7528 NextAuth.js \\u7ED9 Next.js \\u5E94\\u7528\\u6DFB\\u52A0\\u9274\\u6743\\u4E0E\\u8BA4\\u8BC1\",date:\"2022/10/18 00:12:49\",lastmod:\"2023/1/25 11:42:55\",tags:[\"React.js\"],draft:!1,summary:\"\\u5728\\u4E0A\\u4E00\\u7BC7\\u6587\\u7AE0\\u4E2D\\uFF0C\\u6211\\u4EEC\\u4F7F\\u7528 prisma \\u548C Next.js\\uFF0C\\u521B\\u5EFA\\u4E86\\u4E00\\u4E2A\\u89C6\\u9891\\u7F51\\u7AD9\\uFF0C\\u672C\\u6587\\u5C06\\u7EE7\\u7EED\\u5F00\\u53D1\\u89C6\\u9891\\u7F51\\u7AD9\\uFF0C\\u5B9E\\u73B0\\u90AE\\u7BB1\\u767B\\u5F55\\u3001 Github \\u6388\\u6743\\u767B\\u5F55\\uFF0C\\u4EE5\\u53CA\\u5BC6\\u7801\\u767B\\u5F55\\u3002\",images:\"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fca150f8a98e4692ba770f4523171bf5~tplv-k3u1fbpfcp-watermark.image?\",authors:[\"default\"],layout:\"PostLayout\"};function w(a={}){let{wrapper:s}=a.components||{};return s?(0,n.jsx)(s,Object.assign({},a,{children:(0,n.jsx)(c,{})})):c();function c(){let e=Object.assign({hr:\"hr\",p:\"p\",blockquote:\"blockquote\",h2:\"h2\",a:\"a\",span:\"span\",ol:\"ol\",li:\"li\",h3:\"h3\",pre:\"pre\",code:\"code\",img:\"img\",strong:\"strong\",ul:\"ul\"},a.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.hr,{}),(0,n.jsx)(e.p,{children:\"highlight: monokai theme: vuepress\"}),(0,n.jsx)(e.hr,{}),(0,n.jsx)(e.blockquote,{children:(0,n.jsx)(e.p,{children:\"\\u6587\\u7AE0\\u4E3A\\u7A00\\u571F\\u6398\\u91D1\\u6280\\u672F\\u793E\\u533A\\u9996\\u53D1\\u7B7E\\u7EA6\\u6587\\u7AE0\\uFF0C14 \\u5929\\u5185\\u7981\\u6B62\\u8F6C\\u8F7D\\uFF0C14 \\u5929\\u540E\\u672A\\u83B7\\u6388\\u6743\\u7981\\u6B62\\u8F6C\\u8F7D\\uFF0C\\u4FB5\\u6743\\u5FC5\\u7A76\\uFF01\"})}),(0,n.jsxs)(e.h2,{id:\"\\u524D\\u8A00\",children:[(0,n.jsx)(e.a,{href:\"#\\u524D\\u8A00\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\u524D\\u8A00\"]}),(0,n.jsxs)(e.p,{children:[\"\\u5728\\u7CFB\\u7EDF\\u4E2D\\u8981\\u5B9E\\u73B0\\u8EAB\\u4EFD\\u9A8C\\u8BC1\\u662F\\u4E00\\u4EF6\\u6BD4\\u8F83\\u9EBB\\u70E6\\u7684\\u4E8B\\u60C5\\uFF0C\\u6BD4\\u5982\\u96C6\\u6210\\u90AE\\u7BB1\\u767B\\u5F55\\uFF0C\\u624B\\u673A\\u53F7\\u767B\\u5F55\\uFF0C\\u4EE5\\u53CA\\u5176\\u4ED6\\u7B2C\\u4E09\\u65B9\\u767B\\u5F55\\u7B49\\uFF0C\\u4F46\\u662F\\u6709\\u4E86\",(0,n.jsx)(e.a,{href:\"https://next-auth.js.org/\",title:\"Next-auth.js\",children:\"NextAuth.js\"}),\"\\uFF0C\\u4E00\\u5207\\u5C31\\u53D8\\u5F97\\u7B80\\u5355\\u3002\\u6B63\\u5982\\u5B98\\u7F51\\u8BF4\\u7684\\u6DFB\\u52A0\\u8EAB\\u4EFD\\u9A8C\\u8BC1\\uFF0C\\u53EA\\u8981\\u51E0\\u5206\\u949F\\u5C31\\u53EF\\u4EE5\\u5B9E\\u73B0\\u3002\\u5728\\u4E0A\\u4E00\\u7BC7\\u6587\\u7AE0\\u4E2D\\uFF0C\\u6211\\u4EEC\\u4F7F\\u7528 prisma \\u548C Next.js\\uFF0C\\u521B\\u5EFA\\u4E86\\u4E00\\u4E2A\\u89C6\\u9891\\u7F51\\u7AD9\\uFF0C\\u4F46\\u6211\\u4EEC\\u8FD8\\u6CA1\\u6709\\u5B9E\\u73B0\\u7528\\u6237\\u7684\\u6CE8\\u518C\\u4E0E\\u767B\\u5F55\\uFF0C\\u672C\\u6587\\u5C06\\u7EE7\\u7EED\\u5F00\\u53D1\\u89C6\\u9891\\u7F51\\u7AD9\\uFF0C\\u5B9E\\u73B0\\u90AE\\u7BB1\\u767B\\u5F55\\u3001 Github \\u6388\\u6743\\u767B\\u5F55\\uFF0C\\u4EE5\\u53CA\\u5BC6\\u7801\\u767B\\u5F55\\u3002\\u90A3\\u4E48\\uFF0C\\u4E00\\u8D77\\u6765\\u770B\\u770B\\u5427\\uFF01\"]}),(0,n.jsx)(e.blockquote,{children:(0,n.jsxs)(e.p,{children:[\"\\u6587\\u4E2D\\u6D89\\u53CA\\u4EE3\\u7801\\u5168\\u90E8\\u6258\\u7BA1\\u5728 \",(0,n.jsx)(e.a,{href:\"https://github.com/maqi1520/next-prisma-video-app\",title:\"GitHub \\u4ED3\\u5E93\\u4EE3\\u7801\",children:\"GitHub \\u4ED3\\u5E93\"}),\"\\u4E2D\\u3002\"]})}),(0,n.jsxs)(e.h2,{id:\"nextjs-\\u5E94\\u7528\\u63A5\\u5165-nextauth\",children:[(0,n.jsx)(e.a,{href:\"#nextjs-\\u5E94\\u7528\\u63A5\\u5165-nextauth\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Next.js \\u5E94\\u7528\\u63A5\\u5165 NextAuth\"]}),(0,n.jsx)(e.p,{children:\"NextAuth.js \\u662F Next.js \\u5E94\\u7528\\u7A0B\\u5E8F\\u7684\\u5B8C\\u6574\\u5F00\\u6E90\\u8EAB\\u4EFD\\u9A8C\\u8BC1\\u89E3\\u51B3\\u65B9\\u6848\\uFF0C\\u4E13\\u95E8\\u4E3A Next.js \\u8BBE\\u8BA1\\uFF0CNextAuth \\u7684\\u7279\\u70B9\\uFF1A\"}),(0,n.jsxs)(e.ol,{children:[(0,n.jsx)(e.li,{children:\"\\u7075\\u6D3B\\u4E14\\u6613\\u4E8E\\u4F7F\\u7528\\uFF0C\\u652F\\u6301 OAuth1.0 OAuth2.0 \\u548C OpenId \\u94FE\\u63A5\\uFF1B\"}),(0,n.jsx)(e.li,{children:\"\\u7075\\u6D3B\\u6570\\u636E\\u7BA1\\u7406\\uFF0C\\u53EF\\u4EE5\\u4E0D\\u4F7F\\u7528\\u6570\\u636E\\u5E93\\uFF0C\\u4E5F\\u53EF\\u4EE5\\u9009\\u62E9\\u4F7F\\u7528 MySQL, MariaDB, Postgres, SQL Server, MongoDB \\u4EE5\\u53CA SQLite\\u3002\"}),(0,n.jsx)(e.li,{children:\"\\u9ED8\\u8BA4\\u5B89\\u5168\\uFF0C\\u9ED8\\u8BA4 Cookie \\u673A\\u5236\\uFF0C\\u53EF\\u5F00\\u542F JSON Web Token\\uFF1B\"}),(0,n.jsx)(e.li,{children:\"NextAuth \\u63A8\\u8FDB\\u65E0\\u5BC6\\u7801\\u7684\\u767B\\u5F55\\u673A\\u5236\"}),(0,n.jsx)(e.li,{children:\"\\u652F\\u6301 serverless \\u90E8\\u7F72\"})]}),(0,n.jsxs)(e.h3,{id:\"\\u5B89\\u88C5\",children:[(0,n.jsx)(e.a,{href:\"#\\u5B89\\u88C5\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\u5B89\\u88C5\"]}),(0,n.jsx)(e.p,{children:\"\\u9996\\u5148\\u6211\\u4EEC\\u4F7F\\u7528 yarn \\u5B89\\u88C5 NextAuth.js\"}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"code-highlight language-bash\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token function\",children:\"yarn\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"add\"}),` next-auth\n`]})})}),(0,n.jsxs)(e.h3,{id:\"\\u6388\\u6743-api\",children:[(0,n.jsx)(e.a,{href:\"#\\u6388\\u6743-api\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\u6388\\u6743 api\"]}),(0,n.jsxs)(e.p,{children:[\"\\u8981\\u901A\\u8FC7 NextAuth.js \\u83B7\\u5F97\\u6388\\u6743\\uFF0C \\u9700\\u8981\\u5148\\u521B\\u5EFA\\u4E00\\u4E2A\",(0,n.jsx)(e.code,{children:\"pages/api/auth/[...nextauth].ts\"}),\" \\u6587\\u4EF6\\uFF0C\\u5B83\\u5305\\u542B\\u4E86\\u6240\\u6709\\u5168\\u5C40 NextAuth.js \\u914D\\u7F6E\\u3002\"]}),(0,n.jsx)(e.pre,{className:\"language-ts\",children:(0,n.jsxs)(e.code,{className:\"language-ts code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" NextAuth \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'next-auth'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" GithubProvider \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'next-auth/providers/github'\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"export\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" authOptions \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// \\u5728 providers \\u4E2D\\u914D\\u7F6E\\u66F4\\u591A\\u6388\\u6743\\u670D\\u52A1\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  providers\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"GithubProvider\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      clientId\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" process\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"env\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"GITHUB_ID\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      clientSecret\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" process\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"env\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"GITHUB_SECRET\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// ...add more providers here\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"export\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"default\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"NextAuth\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"authOptions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"\\u6211\\u4EEC\\u5148\\u6DFB\\u52A0\\u4E00\\u79CD\\u6388\\u6743\\u767B\\u5F55\\u65B9\\u5F0F\\uFF0C\\u9996\\u5148\\u662F\\u4F7F\\u7528 GITHUB \\u767B\\u5F55\"}),(0,n.jsxs)(e.h2,{id:\"github-\\u6388\\u6743\\u6D41\\u7A0B\",children:[(0,n.jsx)(e.a,{href:\"#github-\\u6388\\u6743\\u6D41\\u7A0B\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Github \\u6388\\u6743\\u6D41\\u7A0B\"]}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:\"Github \\u6388\\u6743\\u6D41\\u7A0B\",src:\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/191317b9b9a64f73bedeed9a3ca2fc3d~tplv-k3u1fbpfcp-zoom-1.image\"})}),(0,n.jsx)(e.p,{children:\"\\u6211\\u4E4B\\u524D\\u4F7F\\u7528\\u8FC7 Nodejs \\u96C6\\u6210 Github OAuth \\u6D41\\u7A0B\\uFF0C\\u5927\\u81F4\\u8981\\u5206\\u4E3A\\u4EE5\\u4E0A 6 \\u4E2A\\u6B65\\u9AA4\\uFF0C\\u9700\\u8981\\u5199\\u4E0D\\u5C11\\u4EE3\\u7801\\u548C\\u63A5\\u53E3\\uFF0C\\u4F46\\u4F7F\\u7528\\u4E86 Next-auth.js\\uFF0C \\u5C31\\u53EF\\u4EE5\\u975E\\u5E38\\u8F7B\\u677E\\u7684\\u96C6\\u6210\\u5230\\u6211\\u4EEC\\u7684\\u5E94\\u7528\\u4E2D\\uFF0C\\u51E0\\u4E4E\\u4E0D\\u7528\\u5199\\u4EE3\\u7801\\u3002\"}),(0,n.jsxs)(e.h3,{id:\"\\u6CE8\\u518C-github-oauth-application\",children:[(0,n.jsx)(e.a,{href:\"#\\u6CE8\\u518C-github-oauth-application\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\u6CE8\\u518C GitHub OAuth Application\"]}),(0,n.jsxs)(e.p,{children:[\"\\u73AF\\u5883\\u53D8\\u91CF\\u53EF\\u4EE5\\u5728 \",(0,n.jsx)(e.a,{href:\"https://github.com/settings/applications/new\",children:\"Github \\u5F00\\u53D1\\u8005\"}),\"\\u4E2D\\u7533\\u8BF7\\uFF0C\\u70B9\\u51FB\\u6CE8\\u518C\\u4E00\\u4E2A\\u65B0 OAuth Application\\uFF1A\"]}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:\"\\u6CE8\\u518C GitHub OAuth Application\",src:\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5404922894744ff8a65eb2fbf667af88~tplv-k3u1fbpfcp-zoom-1.image\"})}),(0,n.jsxs)(e.p,{children:[\"\\u56DE\\u8C03\\u5730\\u5740\\u586B\",(0,n.jsx)(e.code,{children:\"http://localhost:3000/api/auth/callback/github\"})]}),(0,n.jsx)(e.p,{children:\"\\u5730\\u5740\\u53EF\\u4EE5\\u5148\\u586B\\u5F00\\u53D1\\u73AF\\u5883\\u5730\\u5740\\uFF0C\\u5F85\\u4E0A\\u524D\\u7EBF\\u524D\\u53EF\\u4EE5\\u4FEE\\u6539\\u4E3A\\u6B63\\u5F0F\\u57DF\\u540D\\u5730\\u5740\\uFF0C\\u6216\\u8005\\u5F00\\u53D1\\u73AF\\u5883\\u548C\\u751F\\u4EA7\\u73AF\\u5883\\u5355\\u72EC\\u7533\\u8BF7\\u3002\"}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:\"\\u590D\\u5236GITHUB_ID\",src:\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2dc458d20a6d472795e179a30738fe8b~tplv-k3u1fbpfcp-zoom-1.image\"})}),(0,n.jsxs)(e.p,{children:[\"\\u6CE8\\u518C\\u6210\\u529F\\u8FC7\\u540E\\uFF0C\\u5728\\u9875\\u9762\\u4E0A\\u590D\\u5236 \",(0,n.jsx)(e.code,{children:\"Client ID\"}),\" \\u548C \",(0,n.jsx)(e.code,{children:\"Client secrets\"}),\" \\u5230 \",(0,n.jsx)(e.code,{children:\".env\"}),\" \\u6587\\u4EF6\\u4E2D\"]}),(0,n.jsx)(e.pre,{className:\"language-text\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-text\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`GITHUB_ID=\\u4F60\\u6CE8\\u518C\\u7684 GITHUB_ID\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`GITHUB_SECRET=\\u4F60\\u6CE8\\u518C\\u7684 GITHUB_SECRET\n`})]})}),(0,n.jsxs)(e.h3,{id:\"\\u914D\\u7F6E-pages_appts\",children:[(0,n.jsx)(e.a,{href:\"#\\u914D\\u7F6E-pages_appts\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\u914D\\u7F6E \",(0,n.jsx)(e.code,{children:\"pages/_app.ts\"})]}),(0,n.jsxs)(e.p,{children:[\"\\u4E3A\\u4E86\\u8BA9\\u6240\\u6709\\u9875\\u9762\\u80FD\\u591F\\u83B7\\u53D6\\u5230 \",(0,n.jsx)(e.code,{children:\"Session\"}),\"\\uFF0C \\u6211\\u4EEC\\u9700\\u8981\\u5728 \",(0,n.jsx)(e.code,{children:\"pages/_app.ts\"}),\" \\u5916\\u5C42\\u52A0\",(0,n.jsx)(e.code,{children:\"SessionProvider\"})]}),(0,n.jsx)(e.pre,{className:\"language-ts\",children:(0,n.jsxs)(e.code,{className:\"language-ts code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" SessionProvider \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'next-auth/react'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"export\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"default\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"App\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" Component\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" pageProps\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" session\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"...\"}),\"pageProps \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"SessionProvider session\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"session\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"Component \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"...\"}),\"pageProps\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"/\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"/\"}),\"SessionProvider\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.h2,{id:\"\\u5BA2\\u6237\\u7AEF\\u83B7\\u53D6\\u767B\\u5F55\\u4FE1\\u606F\",children:[(0,n.jsx)(e.a,{href:\"#\\u5BA2\\u6237\\u7AEF\\u83B7\\u53D6\\u767B\\u5F55\\u4FE1\\u606F\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\u5BA2\\u6237\\u7AEF\\u83B7\\u53D6\\u767B\\u5F55\\u4FE1\\u606F\"]}),(0,n.jsxs)(e.p,{children:[\"\\u7136\\u540E\\u6211\\u4EEC\\u5C31\\u53EF\\u4EE5\\u521B\\u5EFA\\u4E00\\u4E2A\\u767B\\u5F55\\u7EC4\\u4EF6\",(0,n.jsx)(e.code,{children:\"components/login-btn.tsx\"}),\"\\u3002\"]}),(0,n.jsx)(e.pre,{className:\"language-tsx\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-tsx\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token imports\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" useSession\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" signIn\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" signOut \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'next-auth/react'\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"export\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"default\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"Component\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" data\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" session \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"useSession\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"session\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token tag\",children:(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c\"})}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),(0,n.jsx)(e.span,{className:\"token plain-text\",children:`\n`})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token plain-text\",children:\"        \"}),(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c\"}),\"span\"]}),\" \",(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"className\"}),(0,n.jsxs)(e.span,{className:\"token attr-value\",children:[(0,n.jsx)(e.span,{className:\"token punctuation attr-equals\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:'\"'}),\"mr-1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:'\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),(0,n.jsx)(e.span,{className:\"token plain-text\",children:\"session.user.email\"}),(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"span\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),(0,n.jsx)(e.span,{className:\"token plain-text\",children:`\n`})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token plain-text\",children:\"        \"}),(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c\"}),\"button\"]}),\" \",(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"onClick\"}),(0,n.jsxs)(e.span,{className:\"token language-javascript script\",children:[(0,n.jsx)(e.span,{className:\"token punctuation script-punctuation\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator arrow\",children:\"=\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"signOut\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),(0,n.jsx)(e.span,{className:\"token plain-text\",children:\"\\u767B\\u51FA\"}),(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"button\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),(0,n.jsx)(e.span,{className:\"token plain-text\",children:`\n`})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token plain-text\",children:\"      \"}),(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token tag\",children:(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c/\"})}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c\"}),\"button\"]}),\" \",(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"onClick\"}),(0,n.jsxs)(e.span,{className:\"token language-javascript script\",children:[(0,n.jsx)(e.span,{className:\"token punctuation script-punctuation\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator arrow\",children:\"=\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"signIn\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),(0,n.jsx)(e.span,{className:\"token plain-text\",children:\"\\u767B\\u5F55\"}),(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"button\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"\\u5728\\u9996\\u9875\\u5F15\\u7528\\u767B\\u5F55\\u7EC4\\u4EF6\\uFF0C\\u5C31\\u53EF\\u4EE5\\u4F7F\\u7528 GITHUB \\u6765\\u767B\\u5F55\\u4E86\\uFF0C\\u4E00\\u8D77\\u770B\\u6765\\u770B\\u770B\\u6548\\u679C\\u5427\\u3002\"}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:\"GITHUB \\u6388\\u6743\\u767B\\u5F55\\u6210\\u529F\",src:\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/eae6bcd997904e5f82ba31afaa041640~tplv-k3u1fbpfcp-zoom-1.image\"})}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.strong,{children:\"\\u6CE8\\u610F\"}),\"\\uFF1A\\u6709\\u65F6\\u5019\\u4F1A\\u56E0\\u4E3A\\u7F51\\u7EDC\\u95EE\\u9898\\uFF0C GitHub \\u65E0\\u6CD5\\u767B\\u5F55\\u3002\\u6211\\u4EEC\\u53EF\\u4EE5\\u8BBE\\u7F6E \",(0,n.jsx)(e.code,{children:\"NextAuthOptions\"}),\" \\u7684 \",(0,n.jsx)(e.code,{children:\"debug\"}),\" \\u4E3A \",(0,n.jsx)(e.code,{children:\"true\"}),\"\\uFF0C\\u4F1A\\u5728\\u63A7\\u5236\\u53F0\\u770B\\u5230\\u4EE5\\u4E0B\\u9519\\u8BEF\\u4FE1\\u606F:\"]}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:\"GITHUB \\u6388\\u6743\\u767B\\u5F55\\u8D85\\u65F6\",src:\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e26361ca0dc543bc948b08468db4eac0~tplv-k3u1fbpfcp-zoom-1.image\"})}),(0,n.jsxs)(e.p,{children:[\"\\u539F\\u56E0\\u662F\\u8BBF\\u95EE GitHub \\u9700\\u8981\\u4EE3\\u7406\\uFF0C\\u9700\\u8981\\u5C06\\u4EE3\\u7406\\u8BBE\\u7F6E\\u4E3A\\u5168\\u5C40\\u6A21\\u5F0F\\uFF0C\\u5E76\\u4E14\\u8BBE\\u7F6E\\u8BF7\\u6C42 \",(0,n.jsx)(e.code,{children:\"timeout\"}),\" \\u65F6\\u95F4\\uFF0C\\u5C06\\u8D85\\u65F6\\u65F6\\u95F4\\u5EF6\\u957F\\u3002\"]}),(0,n.jsx)(e.pre,{className:\"language-ts\",children:(0,n.jsxs)(e.code,{className:\"language-ts code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token function\",children:\"GithubProvider\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  clientId\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" process\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"env\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"GITHUB_ID\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  clientSecret\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" process\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"env\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"GITHUB_SECRET\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  httpOptions\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    timeout\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"50000\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"\\u767B\\u5F55\\u6210\\u529F\\u540E\\uFF0C\\u6211\\u4EEC\\u770B\\u4E0B\\u9875\\u9762\\u6253\\u5370\\u51FA\\u6765\\u7684\\u6570\\u636E\\uFF0C\\u5305\\u542B GitHub \\u767B\\u5F55\\u8D26\\u6237\\u7684\\u57FA\\u672C\\u4FE1\\u606F\\u3002\"}),(0,n.jsxs)(e.p,{children:[\"\\u901A\\u8FC7\\u63A7\\u5236\\u53F0\\u6211\\u4EEC\\u53EF\\u4EE5\\u53D1\\u73B0\\uFF0C\",(0,n.jsx)(e.code,{children:\"useSession\"}),\" \\u5176\\u5B9E\\u5C31\\u662F\\u8BBF\\u95EE\\u4E86\",(0,n.jsx)(e.code,{children:\"http://localhost:3000/api/auth/session\"}),\"\\u63A5\\u53E3\\u83B7\\u53D6\\u4FE1\\u606F\\uFF0C\\u8FD9\\u90E8\\u5206\\u662F\\u5728\\u5BA2\\u6237\\u7AEF\\u5B9E\\u73B0\\u7684\\uFF0C\\u90A3\\u4E48\\u5728\\u670D\\u52A1\\u7AEF\\u53EF\\u4EE5\\u83B7\\u53D6\\u5230\\u7528\\u6237\\u6388\\u6743\\u4FE1\\u606F\\u5417\\uFF1F\"]}),(0,n.jsxs)(e.h2,{id:\"ssr-\\u9875\\u9762\\u83B7\\u53D6\\u767B\\u5F55\\u4FE1\\u606F\",children:[(0,n.jsx)(e.a,{href:\"#ssr-\\u9875\\u9762\\u83B7\\u53D6\\u767B\\u5F55\\u4FE1\\u606F\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"SSR \\u9875\\u9762\\u83B7\\u53D6\\u767B\\u5F55\\u4FE1\\u606F\"]}),(0,n.jsx)(e.p,{children:\"\\u56DE\\u5230\\u6211\\u4EEC\\u8981\\u5F00\\u53D1\\u7684\\u89C6\\u9891\\u7F51\\u7AD9\\uFF0C\\u8FD8\\u7F3A\\u5C11\\u4E2A\\u4EBA\\u89C6\\u9891\\u7BA1\\u7406\\u9875\\u9762\\uFF0C\\u8FD9\\u4E2A\\u9875\\u9762\\u5FC5\\u987B\\u662F\\u5F53\\u524D\\u767B\\u5F55\\u7528\\u6237\\u624D\\u80FD\\u8BBF\\u95EE\\uFF0C\\u6CA1\\u6388\\u6743\\uFF0C\\u662F\\u4E0D\\u80FD\\u8BBF\\u95EE\\u7684\\u3002\"}),(0,n.jsxs)(e.p,{children:[\"\\u65B0\\u5EFA\",(0,n.jsx)(e.code,{children:\"pages/me.tsx\"}),\"\\uFF0C\\u7528\\u4E8E\\u7528\\u6237\\u7BA1\\u7406\\u81EA\\u5DF1\\u7684\\u89C6\\u9891\\u3002\"]}),(0,n.jsx)(e.pre,{className:\"language-tsx\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-tsx\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token imports\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" authOptions \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'@/pages/api/auth/[...nextauth]'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token imports\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" unstable_getServerSession \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'next-auth/next'\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"export\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"default\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"Page\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c\"}),\"div\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),(0,n.jsx)(e.span,{className:\"token plain-text\",children:\"\\u4E2A\\u4EBA\\u4E2D\\u5FC3\"}),(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"div\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"export\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"getServerSideProps\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" session \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"await\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"unstable_getServerSession\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"req\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"res\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" authOptions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"!\"}),\"session\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      redirect\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        destination\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'/'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        permanent\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"false\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    props\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      session\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"\\u6B64\\u65F6\\u8BBF\\u95EE \",(0,n.jsx)(e.code,{children:\"http://localhost:3000/me\"}),\" \\u82E5\\u6CA1\\u6709\\u6388\\u6743\\u767B\\u5F55\\uFF0C\\u5219\\u5C06\\u81EA\\u52A8\\u8DF3\\u8F6C\\u5230\\u9996\\u9875\\u3002\"]}),(0,n.jsxs)(e.p,{children:[\"\\u770B\\u6253\\u5370\\u51FA\\u7684\",(0,n.jsx)(e.code,{children:\"session\"}),\"\\u503C\\uFF0C\\u5176\\u4E2D\\u6CA1\\u6709 \",(0,n.jsx)(e.code,{children:\"User\"}),\" \\u7684 \",(0,n.jsx)(e.code,{children:\"id\"}),\"\\uFF0C\\u800C\\u6211\\u4EEC\\u7684\\u89C6\\u9891\\u8868\\u5173\\u8054\\u7684\\u662F \",(0,n.jsx)(e.code,{children:\"UserId\"}),\" \\uFF0C\\u56E0\\u6B64\\u6211\\u4EEC\\u9700\\u8981\\u5C06\\u7528\\u6237\\u7684\\u6388\\u6743\\u4FE1\\u606F\\u540C\\u6B65\\u5230\\u6211\\u4EEC\\u7684\\u6570\\u636E\\u8868\\u4E2D\\u3002\"]}),(0,n.jsxs)(e.h2,{id:\"prisma-\\u9002\\u914D\",children:[(0,n.jsx)(e.a,{href:\"#prisma-\\u9002\\u914D\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Prisma \\u9002\\u914D\"]}),(0,n.jsx)(e.p,{children:\"next-auth.js \\u4E3A prisma \\u63D0\\u4F9B\\u4E86\\u9002\\u914D\\u5668\\uFF0C\\u6211\\u4EEC\\u53EA\\u9700\\u8981\\u6309\\u5B98\\u7F51\\u7ED9\\u51FA\\u7684\\u6B65\\u9AA4\\u4F9D\\u6B21\\u6267\\u884C\"}),(0,n.jsx)(e.ol,{children:(0,n.jsx)(e.li,{children:\"\\u5B89\\u88C5 prisma \\u9002\\u914D\\u5668\"})}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"code-highlight language-bash\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token function\",children:\"yarn\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"add\"}),` @next-auth/prisma-adapter\n`]})})}),(0,n.jsx)(e.ol,{start:\"2\",children:(0,n.jsx)(e.li,{children:\"\\u5728 NextAuth.js \\u914D\\u7F6E prisma \\u9002\\u914D\\u5668\"})}),(0,n.jsx)(e.pre,{className:\"language-ts\",children:(0,n.jsxs)(e.code,{className:\"language-ts code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" NextAuth\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" NextAuthOptions \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"next-auth\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" EmailProvider \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"next-auth/providers/email\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" GithubProvider \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"next-auth/providers/github\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" prisma \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"@/lib/prisma\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" PrismaAdapter \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"@next-auth/prisma-adapter\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"export\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" authOptions\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" NextAuthOptions \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"//debug: true,\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\"  adapter\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"PrismaAdapter\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"prisma\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  providers\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// OAuth authentication providers...\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"GithubProvider\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      clientId\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" process\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"env\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"GITHUB_ID\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      clientSecret\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" process\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"env\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"GITHUB_SECRET\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\"  callbacks\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\"    \",(0,n.jsx)(e.span,{className:\"token function function-variable\",children:\"session\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" session\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" token\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" user \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\"      \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"session\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"?.\"}),\"user\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\"        session\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"user\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"id \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" user\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"id\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\"      \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" session\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"export\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"default\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"NextAuth\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"authOptions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"\\u6DFB\\u52A0 \",(0,n.jsx)(e.code,{children:\"callbacks\"}),\" \\u51FD\\u6570\\uFF0C\\u5C06 \",(0,n.jsx)(e.code,{children:\"user\"}),\" \",(0,n.jsx)(e.code,{children:\"id\"}),\" \\u8D4B\\u503C\\u7ED9 \",(0,n.jsx)(e.code,{children:\"session\"}),\" \\u4E2D\\u7684 \",(0,n.jsx)(e.code,{children:\"user\"}),\" \",(0,n.jsx)(e.code,{children:\"id\"}),\"\\uFF0C\\u65B9\\u4FBF\\u540E\\u9762\\u63A5\\u53E3\\u4E2D\\u53EF\\u4EE5\\u76F4\\u63A5\\u83B7\\u53D6\\u7528\\u6237 \",(0,n.jsx)(e.code,{children:\"id\"}),\"\\u3002\"]}),(0,n.jsx)(e.ol,{start:\"3\",children:(0,n.jsx)(e.li,{children:\"\\u6DFB\\u52A0 prisma Schema \\u4E2D\\u6DFB\\u52A0\\u6A21\\u578B\"})}),(0,n.jsx)(e.pre,{className:\"language-js\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-js\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"model \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"Account\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  id                 \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"String\"}),\"  @id @\",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"default\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"cuid\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  userId             \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"String\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  type               \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"String\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  provider           \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"String\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  providerAccountId  \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"String\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  refresh_token      \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),\"  @db\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"Text\"})}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  access_token       \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),\"  @db\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"Text\"})}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  expires_at         \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"Int\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  token_type         \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  scope              \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  id_token           \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),\"  @db\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"Text\"})}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  session_state      \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  user \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"User\"}),\" @\",(0,n.jsx)(e.span,{className:\"token function\",children:\"relation\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"fields\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"userId\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"references\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"id\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"onDelete\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"Cascade\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  @@\",(0,n.jsx)(e.span,{className:\"token function\",children:\"unique\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"provider\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" providerAccountId\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"model \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"Session\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  id           \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"String\"}),\"   @id @\",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"default\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"cuid\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  sessionToken \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"String\"}),`   @unique\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  userId       \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"String\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  expires      \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"DateTime\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  user         \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"User\"}),\"     @\",(0,n.jsx)(e.span,{className:\"token function\",children:\"relation\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"fields\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"userId\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"references\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"id\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"onDelete\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"Cascade\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"model \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"User\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  id            \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"String\"}),\"    @id @\",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"default\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"cuid\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  name          \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  email         \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),`   @unique\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  emailVerified \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"DateTime\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  image         \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  accounts      \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"Account\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  sessions      \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"Session\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"model \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"VerificationToken\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  identifier \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"String\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  token      \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"String\"}),`   @unique\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  expires    \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"DateTime\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  @@\",(0,n.jsx)(e.span,{className:\"token function\",children:\"unique\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"identifier\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" token\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"\\u5F53\\u6211\\u4EEC\\u5C06\\u8FD9\\u4E9B\\u6A21\\u578B\\u7C98\\u8D34\\u5230 Schema \\u540E\\uFF0C\\u4F1A\\u770B\\u5230 VSCode \\u4E2D\\u6709\\u9519\\u8BEF\\u63D0\\u793A\"}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:\"Prisma Schema \\u9519\\u8BEF\\u63D0\\u793A\",src:\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/89d1c1d0b1bb4a4e857a9b81c7c4d3fe~tplv-k3u1fbpfcp-zoom-1.image\"})}),(0,n.jsxs)(e.p,{children:[\"\\u539F\\u56E0\\u662F\\u6211\\u4EEC\\u4E4B\\u524D\\u8BBE\\u8BA1\\u7684\\u7528\\u6237\\u8868 \",(0,n.jsx)(e.code,{children:\"id\"}),\" \\u662F \",(0,n.jsx)(e.code,{children:\"Int\"}),\" \\u7C7B\\u578B\\uFF0C\\u8DDF\\u5F53\\u524D\\u7684 \",(0,n.jsx)(e.code,{children:\"Sring\"}),\" \\u7C7B\\u578B\\u4E0D\\u5339\\u914D\\uFF0C\\u89E3\\u51B3\\u529E\\u6CD5\\u662F\\u5C06 \",(0,n.jsx)(e.code,{children:\"Int\"}),\" \\u6539\\u6210 \",(0,n.jsx)(e.code,{children:\"String\"}),\"\\uFF0C\\u6700\\u597D\\u7684\\u505A\\u6CD5\\u662F\\u6240\\u6709\\u8868\\u4E2D\\u7684 \",(0,n.jsx)(e.code,{children:\"id\"}),\" \\u7C7B\\u578B\\u6539\\u6210\\u7EDF\\u4E00\\u3002\"]}),(0,n.jsx)(e.ol,{start:\"3\",children:(0,n.jsx)(e.li,{children:\"\\u8FC1\\u79FB Schema\\uFF0C\\u751F\\u6210\\u8868\"})}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"code-highlight language-bash\",children:(0,n.jsx)(e.span,{className:\"code-line\",children:`npx prisma migrate dev\n`})})}),(0,n.jsx)(e.p,{children:\"\\u6267\\u884C\\u5B8C\\u6210\\u540E\\uFF0C\\u6211\\u4EEC\\u5237\\u65B0\\u9875\\u9762\\uFF0C\\u91CD\\u65B0\\u767B\\u5F55\\u9875\\u9762\\uFF0C\\u6765\\u770B\\u4E0B\\u6548\\u679C\"}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:\"session \\u5305\\u542B userId\",src:\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2a95b766d31f437b97c9ed7627844bb9~tplv-k3u1fbpfcp-zoom-1.image\"})}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"session\"}),\" \\u4E2D\\u5DF2\\u7ECF\\u6709\\u4E86 \",(0,n.jsx)(e.code,{children:\"id\"}),\"\\uFF0C\\u8FD9\\u91CC\\u6211\\u6D4B\\u8BD5\\u4E86\\u4E0B\\uFF0C\\u5C06\\u6211 Github \\u9ED8\\u8BA4\\u90AE\\u7BB1\\u6539\\u6210\\u53E6\\u4E00\\u4E2A\\uFF0C\\u4E5F\\u4E0D\\u4F1A\\u5F71\\u54CD\\u6CE8\\u518C\\u7528\\u6237\\u8868\\u4E2D\\u7684\\u4FE1\\u606F\\uFF0C\\u56E0\\u4E3A \",(0,n.jsx)(e.code,{children:\"Account\"}),\" \\u8868\\u4E2D\\u7684\\u552F\\u4E00\\u503C\\u662F\",(0,n.jsx)(e.code,{children:\"provider + providerAccountId\"}),\"\\u3002\"]}),(0,n.jsxs)(e.h3,{id:\"\\u670D\\u52A1\\u7AEF\\u6E32\\u67D3\\u6211\\u7684\\u89C6\\u9891\",children:[(0,n.jsx)(e.a,{href:\"#\\u670D\\u52A1\\u7AEF\\u6E32\\u67D3\\u6211\\u7684\\u89C6\\u9891\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\u670D\\u52A1\\u7AEF\\u6E32\\u67D3\\u6211\\u7684\\u89C6\\u9891\"]}),(0,n.jsxs)(e.p,{children:[\"\\u5728 \",(0,n.jsx)(e.code,{children:\"session\"}),\" \\u4E2D\\u53EF\\u4EE5\\u83B7\\u53D6 \",(0,n.jsx)(e.code,{children:\"userId\"}),\"\\uFF0C\\u90A3\\u4E48\\u6211\\u4EEC\\u5C31\\u53EF\\u4EE5\\u5728 \",(0,n.jsx)(e.code,{children:\"getServerSideProps\"}),\" \\u83B7\\u53D6\\u5F53\\u524D\\u7528\\u6237\\u7684\\u89C6\\u9891\\u4E86\\u3002\"]}),(0,n.jsx)(e.pre,{className:\"language-ts\",children:(0,n.jsxs)(e.code,{className:\"language-ts code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"export\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"getServerSideProps\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" session \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"await\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"unstable_getServerSession\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" authOptions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"!\"}),\"session\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      redirect\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        destination\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'/'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        permanent\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"false\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" data \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"await\"}),\" prisma\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"video\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"findMany\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    where\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      authorId\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" session\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"user\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"id\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    include\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" author\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"true\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    props\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      session\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      data\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"makeSerializable\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"data\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"\\u8FD9\\u91CC\\u6709\\u4E2A\\u95EE\\u9898\\uFF0C\\u5F53\\u6211\\u4EEC\\u83B7\\u53D6 \",(0,n.jsx)(e.code,{children:\"user.id\"}),\" \\u7684\\u65F6\\u5019\\uFF0C typescript \\u4F1A\\u63D0\\u793A\\u9519\\u8BEF\\uFF0C\\u56E0\\u4E3A\\u9ED8\\u8BA4\\u7684 \",(0,n.jsx)(e.code,{children:\"User\"}),\" \\u7C7B\\u578B\\u4E2D\\u662F\\u4E0D\\u5305\\u542B \",(0,n.jsx)(e.code,{children:\"id\"})]}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:\"TS \\u6821\\u9A8C\\u63D0\\u793A\",src:\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/45f3eb2d697b47a8a7b3795ce45d0271~tplv-k3u1fbpfcp-zoom-1.image\"})}),(0,n.jsxs)(e.p,{children:[\"\\u6240\\u4EE5\\u6211\\u4EEC\\u9700\\u8981\\u91CD\\u5199\\u4E0B next-auth \\u4E2D \",(0,n.jsx)(e.code,{children:\"Session\"}),\" \\u7684\\u63A5\\u53E3\\uFF0C\\u65B0\\u5EFA \",(0,n.jsx)(e.code,{children:\"types/next-auth.d.ts\"}),\" \\u8F93\\u5165\\u4EE5\\u4E0B\\u4EE3\\u7801\\uFF0C\\u5C31\\u53EF\\u4EE5\\u7EE7\\u627F\\u9ED8\\u8BA4\\u7684 \",(0,n.jsx)(e.code,{children:\"Session\"}),\" TS \\u7C7B\\u578B\\u63A5\\u53E3\\u4E86\"]}),(0,n.jsx)(e.pre,{className:\"language-ts\",children:(0,n.jsxs)(e.code,{className:\"language-ts code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" NextAuth\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" DefaultSession \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'next-auth'\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"declare\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"module\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'next-auth'\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"interface\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Session\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    user\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      id\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\" DefaultSession\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'user'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"\\u6DFB\\u52A0\\u5B8C\\u6210\\u540E\\uFF0C\\u5728\\u9875\\u9762\\u4E2D\\u4F7F\\u7528 \",(0,n.jsx)(e.code,{children:\"useSession\"}),\", \",(0,n.jsx)(e.code,{children:\"unstable_getServerSession\"}),\" \\u7B49\\u83B7\\u53D6\\u5230\\u7684 \",(0,n.jsx)(e.code,{children:\"Session\"}),\" \\u4E0D\\u4F1A TS \\u7C7B\\u578B\\u62A5\\u9519\\u4E86\\u3002\"]}),(0,n.jsxs)(e.h2,{id:\"\\u90AE\\u7BB1\\u6388\\u6743\\u767B\\u5F55\",children:[(0,n.jsx)(e.a,{href:\"#\\u90AE\\u7BB1\\u6388\\u6743\\u767B\\u5F55\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\u90AE\\u7BB1\\u6388\\u6743\\u767B\\u5F55\"]}),(0,n.jsx)(e.p,{children:\"\\u6709\\u4E86 Github \\u6388\\u6743\\u767B\\u5F55\\uFF0C\\u5E76\\u4E14\\u5173\\u8054\\u4E86\\u6570\\u636E\\u5E93\\uFF0C\\u90A3\\u8981\\u52A0\\u4E0A\\u90AE\\u7BB1\\u6388\\u6743\\u767B\\u5F55\\uFF0C\\u4FBF\\u662F\\u8F7B\\u800C\\u6613\\u4E3E\\u3002\"}),(0,n.jsxs)(e.p,{children:[\"\\u9996\\u5148\\u5B89\\u88C5 \",(0,n.jsx)(e.code,{children:\"nodemailer\"}),\"\\uFF0C\\u7528\\u4E8E Node.js \\u53D1\\u9001\\u90AE\\u4EF6\"]}),(0,n.jsx)(e.pre,{className:\"language-ts\",children:(0,n.jsx)(e.code,{className:\"language-ts code-highlight\",children:(0,n.jsx)(e.span,{className:\"code-line\",children:`yarn add nodemailer\n`})})}),(0,n.jsxs)(e.p,{children:[\"\\u7136\\u540E\\u5728 \",(0,n.jsx)(e.code,{children:\"pages/api/auth/[...nextauth].ts\"}),\"\\u5F15\\u5165\\u5E76\\u4E14\\u914D\\u7F6E \",(0,n.jsx)(e.code,{children:\"EmailProvider\"})]}),(0,n.jsx)(e.pre,{className:\"language-ts\",children:(0,n.jsxs)(e.code,{className:\"language-ts code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" EmailProvider \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'next-auth/providers/email'\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"export\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" authOptions\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" NextAuthOptions \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"//debug: true,\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  adapter\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"PrismaAdapter\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"prisma\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  providers\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"EmailProvider\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      server\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" process\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"env\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"EMAIL_SERVER\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      from\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" process\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"env\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"EMAIL_FROM\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"//maxAge: 24 * 60 * 60, // \\u8BBE\\u7F6E\\u90AE\\u7BB1\\u94FE\\u63A5\\u5931\\u6548\\u65F6\\u95F4\\uFF0C\\u9ED8\\u8BA424\\u5C0F\\u65F6\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// OAuth authentication providers...\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"GithubProvider\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      clientId\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" process\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"env\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"GITHUB_ID\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      clientSecret\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" process\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"env\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"GITHUB_SECRET\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// ...\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"\\u7136\\u540E\\u5728 \",(0,n.jsx)(e.code,{children:\".env\"}),\" \\u6587\\u4EF6\\u4E2D\\u914D\\u7F6E\\u73AF\\u5883\\u53D8\\u91CF\"]}),(0,n.jsx)(e.pre,{children:(0,n.jsxs)(e.code,{className:\"code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`EMAIL_SERVER=smtp://username:password@smtp.example.com:587\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`EMAIL_FROM=NextAuth \u003cnoreply@example.com\u003e\n`})]})}),(0,n.jsxs)(e.p,{children:[\"\\u8FD9\\u91CC\\u7684 \",(0,n.jsx)(e.code,{children:\"EMAIL_SERVER\"}),\" \\u4E2D\\u7684 \",(0,n.jsx)(e.code,{children:\"username\"}),\" \\u5C31\\u662F\\u53D1\\u4EF6\\u90AE\\u7BB1\\u7684\\u8D26\\u53F7\\uFF0C\\u800C \",(0,n.jsx)(e.code,{children:\"password\"}),\" \\u5E76\\u4E0D\\u662F\\u90AE\\u7BB1\\u5BC6\\u7801\\uFF0C\\u9700\\u8981\\u5728\\u90AE\\u7BB1\\u8BBE\\u7F6E\\u4E2D\\u5F00\\u542F\\uFF0C\\u8FD9\\u91CC\\u6211\\u4EE5 163 \\u90AE\\u7BB1\\u4E3A\\u4F8B\"]}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:\"163 \\u90AE\\u7BB1\\u8BBE\\u7F6E\",src:\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/92f7009115f24795b663ba531dd36ae3~tplv-k3u1fbpfcp-zoom-1.image\"})}),(0,n.jsxs)(e.p,{children:[\"\\u767B\\u5F55\\u90AE\\u7BB1\\u540E\\uFF0C\\u5728\\u90AE\\u7BB1\\u8BBE\\u7F6E\\u4E2D\\u5F00\\u542F POP3/SMTP/IMAP \\u670D\\u52A1\\uFF0C\\u70B9\\u51FB\\u5F00\\u542F\\uFF0C\\u8FD9\\u91CC\\u4F1A\\u9700\\u8981\\u77ED\\u4FE1\\u9A8C\\u8BC1\\uFF0C\\u9A8C\\u8BC1\\u4F1A\\u6709\\u4E00\\u4E2A\\u6388\\u6743\\u5BC6\\u7801\\uFF0C\\u8FD9\\u4E2A\\u6388\\u6743\\u7801\\u5C31\\u662F \",(0,n.jsx)(e.code,{children:\"password\"}),\"\\uFF0C \\u6700\\u540E\\u9762\\u7684\\u670D\\u52A1\\u5730\\u5740\\u548C\\u7AEF\\u53E3\\u9700\\u8981\\u6839\\u636E\\u4F60\\u6700\\u7EC8\\u9009\\u62E9\\u7684 POP3/SMTP/IMAP \\u670D\\u52A1\\u6765\\u914D\\u7F6E\\uFF0C\\u4E0B\\u56FE\\u662F 126 \\u90AE\\u7BB1\\u7684\\u670D\\u52A1\\u5668\\u914D\\u7F6E\\u3002\"]}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:\"126\\u90AE\\u7BB1\\u670D\\u52A1\\u5668\\u4FE1\\u606F\",src:\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a94bc6fa2fb54eff97aab1e328fbdb82~tplv-k3u1fbpfcp-zoom-1.image\"})}),(0,n.jsx)(e.p,{children:\"\\u914D\\u7F6E\\u5B8C\\u6210\\u540E\\u5237\\u65B0\\u6D4F\\u89C8\\u5668\\u5C31\\u53EF\\u4EE5\\u4F7F\\u7528\\u90AE\\u7BB1\\u6765\\u5B8C\\u6210\\u767B\\u5F55\\u4E86\\uFF0C\\u767B\\u5F55\\u7684\\u90AE\\u7BB1\\u8D26\\u53F7\\u4E0D\\u80FD\\u662F\\u53D1\\u9001\\u90AE\\u4EF6\\u670D\\u52A1\\u7684\\u8D26\\u53F7\\uFF0C\\u6BD4\\u5982\\u6211\\u8BBE\\u7F6E\\u7684\\u662F\\u53D1\\u9001\\u90AE\\u4EF6\\u670D\\u52A1\\u662F 163 \\u90AE\\u7BB1\\uFF0C\\u90A3\\u6211\\u6CE8\\u518C\\u7684\\u65F6\\u5019\\u4F7F\\u7528 QQ \\u90AE\\u7BB1\\u3002\"}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:\"\\u4F7F\\u7528\\u90AE\\u7BB1\\u767B\\u5F55\\u754C\\u9762\",src:\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2e1f821360a94a489a9afd8a16e16901~tplv-k3u1fbpfcp-zoom-1.image\"})}),(0,n.jsx)(e.p,{children:\"\\u70B9\\u51FB \\u201Csign in with Email\\u201D \\u540E\\uFF0C\\u4F60\\u5C31\\u4F1A\\u6536\\u5230\\u5982\\u4E0B\\u90AE\\u4EF6\\uFF0C\\u5728\\u90AE\\u7BB1\\u4E2D\\u70B9\\u51FB\\u94FE\\u63A5\\uFF0C\\u4FBF\\u4F1A\\u81EA\\u52A8\\u6388\\u6743\\u767B\\u5F55\\u6210\\u529F\\u3002\"}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:\"\\u6536\\u5230\\u9ED8\\u8BA4\\u90AE\\u4EF6\\u6A21\\u677F\",src:\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6e61723698e74d4a99e9d2f000be5f1d~tplv-k3u1fbpfcp-zoom-1.image\"})}),(0,n.jsx)(e.p,{children:\"\\u767B\\u5F55\\u6210\\u529F\\u540E\\u7684\\uFF0CSession \\u4E2D\\u7684\\u4FE1\\u606F\\u8DDF\\u6211 Github \\u8D26\\u53F7\\u767B\\u5F55\\u7684\\u4FE1\\u606F\\u662F\\u4E00\\u81F4\\u7684\\uFF0C\\u56E0\\u4E3A\\u5728\\u6570\\u636E\\u5E93\\u4E2D\\uFF0C\\u90AE\\u7BB1\\u5730\\u5740\\u662F\\u552F\\u4E00\\u503C\\u3002\"}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:\"\\u90AE\\u7BB1\\u767B\\u5F55\\u6210\\u529F\",src:\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/876dbb24b4724554b756ebe51b547def~tplv-k3u1fbpfcp-zoom-1.image\"})}),(0,n.jsxs)(e.h3,{id:\"\\u66F4\\u6539\\u90AE\\u4EF6\\u6A21\\u677F\",children:[(0,n.jsx)(e.a,{href:\"#\\u66F4\\u6539\\u90AE\\u4EF6\\u6A21\\u677F\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\u66F4\\u6539\\u90AE\\u4EF6\\u6A21\\u677F\"]}),(0,n.jsx)(e.p,{children:\"\\u6709\\u4E9B\\u540C\\u5B66\\u4F1A\\u8BF4\\uFF0C\\u53D1\\u9001\\u7684\\u90AE\\u4EF6\\u4E3B\\u9898\\u592A\\u4E11\\u4E86\\uFF0C\\u6211\\u4EEC\\u53EF\\u4EE5\\u5B9A\\u5236\\u5417\\uFF1F\"}),(0,n.jsxs)(e.p,{children:[\"\\u653E\\u5FC3\\uFF0CNext-auth \\u5E2E\\u6211\\u4EEC\\u8003\\u8651\\u5230\\u4E86 , \",(0,n.jsx)(e.code,{children:\"EmailProvider\"}),\" \\u652F\\u6301\\u81EA\\u5B9A\\u4E49\\u6A21\\u677F\\uFF0C\\u6211\\u4EEC\\u9700\\u8981\\u914D\\u7F6E \",(0,n.jsx)(e.code,{children:\"sendVerificationRequest\"}),\" \\u51FD\\u6570\"]}),(0,n.jsx)(e.pre,{className:\"language-ts\",children:(0,n.jsxs)(e.code,{className:\"language-ts code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" EmailProvider \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"next-auth/providers/email\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"...\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"providers\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token function\",children:\"EmailProvider\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    server\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" process\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"env\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"EMAIL_SERVER\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    from\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" process\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"env\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"EMAIL_FROM\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"sendVerificationRequest\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      identifier\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" email\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      url\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      provider\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" server\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" from \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"/* your function */\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"\\u90AE\\u4EF6\\u6A21\\u677F\\u51FD\\u6570\\u53EF\\u80FD\\u4F1A\\u5F88\\u5927\\uFF0C\\u53EF\\u4EE5\\u5C06 \",(0,n.jsx)(e.code,{children:\"sendVerificationRequest\"}),\" \\u63D0\\u53D6\\u4E3A\\u5355\\u72EC\\u6587\\u4EF6\\uFF0C\\u7136\\u540E\\u518D\\u5F15\\u5165\\uFF1B\"]}),(0,n.jsx)(e.pre,{className:\"language-ts\",children:(0,n.jsxs)(e.code,{className:\"language-ts code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" createTransport \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'nodemailer'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" SendVerificationRequestParams \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'next-auth/providers/email'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" Theme \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'next-auth'\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"export\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"sendVerificationRequest\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"params\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" SendVerificationRequestParams\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" identifier\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" url\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" provider\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" theme \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),` params\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" host \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:(0,n.jsx)(e.span,{className:\"token constant\",children:\"URL\"})}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"url\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" transport \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"createTransport\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"provider\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"server\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" result \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"await\"}),\" transport\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"sendMail\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    to\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" identifier\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    from\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" provider\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"from\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    subject\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsxs)(e.span,{className:\"token template-string\",children:[(0,n.jsx)(e.span,{className:\"token string template-punctuation\",children:\"`\"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation interpolation-punctuation\",children:\"${\"}),\"host\",(0,n.jsx)(e.span,{className:\"token punctuation interpolation-punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:\" \\u6CE8\\u518C\\u8BA4\\u8BC1\"}),(0,n.jsx)(e.span,{className:\"token string template-punctuation\",children:\"`\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    text\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"text\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" url\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" host \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    html\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"html\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" url\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" host\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" theme \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" failed \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" result\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"rejected\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"concat\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"result\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"pending\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"filter\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"Boolean\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"failed\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"length\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"throw\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Error\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token template-string\",children:[(0,n.jsx)(e.span,{className:\"token string template-punctuation\",children:\"`\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"Email(s) (\"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation interpolation-punctuation\",children:\"${\"}),\"failed\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"join\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"', '\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation interpolation-punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:\") could not be sent\"}),(0,n.jsx)(e.span,{className:\"token string template-punctuation\",children:\"`\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`/**\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:` *\\u4F7F\\u7528HTML body \\u4EE3\\u66FF\\u6B63\\u6587\\u5185\\u5BB9\n`})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\" */\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"html\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"params\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" url\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" host\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" theme\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" Theme \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" url\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" host\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" theme \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),` params\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"//\\u7531\\u4E8E\\u4F7F\\u7528\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" escapedHost \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" host\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"replace\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token regex\",children:[(0,n.jsx)(e.span,{className:\"token regex-delimiter\",children:\"/\"}),(0,n.jsx)(e.span,{className:\"token language-regex regex-source\",children:(0,n.jsx)(e.span,{className:\"token escape special-escape\",children:\"\\\\.\"})}),(0,n.jsx)(e.span,{className:\"token regex-delimiter\",children:\"/\"}),(0,n.jsx)(e.span,{className:\"token regex-flags\",children:\"g\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'\u0026#8203;.'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsxs)(e.span,{className:\"token template-string\",children:[(0,n.jsx)(e.span,{className:\"token string template-punctuation\",children:\"`\"}),(0,n.jsx)(e.span,{className:\"token string\",children:`\n`})]})]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token template-string\",children:(0,n.jsx)(e.span,{className:\"token string\",children:`\u003cbody\u003e\n`})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsxs)(e.span,{className:\"token template-string\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'  \u003cdiv style=\"background:#f2f5f7;display: flex;justify-content: center;align-items: center; height:200px\"\u003e\\u6B22\\u8FCE\\u6CE8\\u518C'}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation interpolation-punctuation\",children:\"${\"}),\"escapedHost\",(0,n.jsx)(e.span,{className:\"token punctuation interpolation-punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:',\\u70B9\\u51FB\u003ca href=\"'}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation interpolation-punctuation\",children:\"${\"}),\"url\",(0,n.jsx)(e.span,{className:\"token punctuation interpolation-punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:`\" target=\"_blank\"\u003e\\u767B\\u5F55\u003c/a\u003e\u003c/div\u003e\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token template-string\",children:(0,n.jsx)(e.span,{className:\"token string\",children:`\u003c/body\u003e\n`})})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token template-string\",children:[(0,n.jsx)(e.span,{className:\"token string\"}),(0,n.jsx)(e.span,{className:\"token string template-punctuation\",children:\"`\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"/** \\u4E0D\\u652F\\u6301HTML \\u7684\\u90AE\\u4EF6\\u5BA2\\u6237\\u7AEF\\u4F1A\\u663E\\u793A\\u4E0B\\u9762\\u7684\\u6587\\u672C\\u4FE1\\u606F */\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"text\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" url\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" host \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" url\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" host\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsxs)(e.span,{className:\"token template-string\",children:[(0,n.jsx)(e.span,{className:\"token string template-punctuation\",children:\"`\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"\\u6B22\\u8FCE\\u6CE8\\u518C \"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation interpolation-punctuation\",children:\"${\"}),\"host\",(0,n.jsx)(e.span,{className:\"token punctuation interpolation-punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:\"\\\\n\\u70B9\\u51FB\"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation interpolation-punctuation\",children:\"${\"}),\"url\",(0,n.jsx)(e.span,{className:\"token punctuation interpolation-punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:\"\\u767B\\u5F55\\\\n\\\\n\"}),(0,n.jsx)(e.span,{className:\"token string template-punctuation\",children:\"`\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"\\u5F53\\u7136\\u8FD9\\u91CC\\u6211\\u7B80\\u5316\\u4E86\\u6A21\\u677F\\u4EE3\\u7801\\uFF0C \\u5728\\u771F\\u5B9E\\u573A\\u666F\\u4E2D\\uFF0C\\u6211\\u4EEC\\u4E5F\\u53EF\\u4EE5\\u66FF\\u6362 HTML \\u6587\\u4EF6\\u6765\\u5B9E\\u73B0\\u3002\"}),(0,n.jsxs)(e.h2,{id:\"\\u5BC6\\u7801\\u767B\\u5F55\",children:[(0,n.jsx)(e.a,{href:\"#\\u5BC6\\u7801\\u767B\\u5F55\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\u5BC6\\u7801\\u767B\\u5F55\"]}),(0,n.jsx)(e.p,{children:\"\\u5BC6\\u7801\\u767B\\u5F55 Next-auth \\u662F\\u4E0D\\u9F13\\u52B1\\u4F7F\\u7528\\u7684\\uFF0C\\u56E0\\u4E3A\\u4E0E\\u5BC6\\u7801\\u76F8\\u5173\\u7684\\u56FA\\u6709\\u5B89\\u5168\\u98CE\\u9669\\u4EE5\\u53CA\\u4E0E\\u652F\\u6301\\u7528\\u6237\\u540D\\u548C\\u5BC6\\u7801\\u5177\\u6709\\u989D\\u5916\\u590D\\u6742\\u6027\\u3002\"}),(0,n.jsxs)(e.p,{children:[\"\\u4F7F\\u7528\\u5BC6\\u7801\\u767B\\u5F55\\u9700\\u8981\\u4F7F\\u7528 \",(0,n.jsx)(e.code,{children:\"CredentialsProvider\"})]}),(0,n.jsx)(e.pre,{className:\"language-ts\",children:(0,n.jsxs)(e.code,{className:\"language-ts code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" NextAuth\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" NextAuthOptions \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'next-auth'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" CredentialsProvider \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'next-auth/providers/credentials'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" prisma \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'@/lib/prisma'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" PrismaAdapter \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'@next-auth/prisma-adapter'\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"export\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" authOptions\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" NextAuthOptions \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"//debug: true,\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  adapter\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"PrismaAdapter\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"prisma\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  providers\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"CredentialsProvider\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token comment\",children:'// \\u767B\\u5F55\\u6309\\u94AE\\u663E\\u793A (e.g. \"Sign in with Credentials\")'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      name\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'Credentials'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// credentials \\u7528\\u4E8E\\u914D\\u7F6E\\u767B\\u5F55\\u9875\\u9762\\u7684\\u8868\\u5355\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      credentials\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        email\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          label\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'\\u90AE\\u7BB1'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          type\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'text'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          placeholder\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'\\u8BF7\\u8F93\\u5165\\u90AE\\u7BB1'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        password\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          label\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'\\u5BC6\\u7801'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          type\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'password'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          placeholder\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'\\u8BF7\\u8F93\\u5165\\u5BC6\\u7801'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"authorize\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"credentials\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"console\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"log\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"credentials\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// TODO\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// const maybeUser= await prisma.user.findFirst({where:{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"//   email: credentials.email,\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"//  }})\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// \\u6839\\u636E credentials \\u6211\\u4EEC\\u67E5\\u8BE2\\u6570\\u636E\\u5E93\\u4E2D\\u7684\\u4FE1\\u606F\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" user \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          id\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'1'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          name\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'xiaoma'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          email\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'xiaoma@example.com'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"user\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// \\u8FD4\\u56DE\\u7684\\u5BF9\\u8C61\\u5C06\\u4FDD\\u5B58\\u624DJWT \\u7684\\u7528\\u6237\\u5C5E\\u6027\\u4E2D\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),` user\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"else\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// \\u5982\\u679C\\u8FD4\\u56DEnull\\uFF0C\\u5219\\u4F1A\\u663E\\u793A\\u4E00\\u4E2A\\u9519\\u8BEF\\uFF0C\\u5EFA\\u8BAE\\u7528\\u6237\\u68C0\\u67E5\\u5176\\u8BE6\\u7EC6\\u4FE1\\u606F\\u3002\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"null\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// \\u8DF3\\u8F6C\\u5230\\u9519\\u8BEF\\u9875\\u9762\\uFF0C\\u5E76\\u4E14\\u643A\\u5E26\\u9519\\u8BEF\\u4FE1\\u606F http://localhost:3000/api/auth/error?error=\\u7528\\u6237\\u540D\\u6216\\u5BC6\\u7801\\u9519\\u8BEF\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token comment\",children:'//throw new Error(\"\\u7528\\u6237\\u540D\\u6216\\u5BC6\\u7801\\u9519\\u8BEF\");'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  session\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    strategy\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'jwt'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  jwt\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    secret\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'test'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  callbacks\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"jwt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" token\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" user\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" account\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" profile\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" isNewUser \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"user\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        token\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"id \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" user\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`id\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),` token\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function function-variable\",children:\"session\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" session\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" token\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" user \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"session\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"?.\"}),\"user \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" token\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        session\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"user\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"id \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" token\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"id \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),` session\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"export\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"default\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"NextAuth\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"authOptions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"\\u4E0A\\u9762\\u4EE3\\u7801\\u4E2D\\uFF0C\\u6211\\u4EEC\\u9996\\u5148\\u9700\\u8981\\u5F00\\u542F JWT \\u6A21\\u5F0F\\uFF0C\\u5728 \",(0,n.jsx)(e.code,{children:\"authorize\"}),\" \\u65B9\\u6CD5\\u4E2D\\u6211\\u4EEC\\u53EF\\u4EE5\\u6839\\u636E\\u7528\\u6237\\u6240\\u586B\\u7684\\u8868\\u5355\\u4FE1\\u606F\\u8FDB\\u884C\\u6570\\u636E\\u5E93\\u67E5\\u8BE2\\uFF0C\\u7531\\u4E8E\\u6211\\u4EEC\\u7684\\u6570\\u636E\\u5E93\\u4E2D\\u6CA1\\u6709\\u5BC6\\u7801\\u5B57\\u6BB5\\uFF0C\\u6240\\u4EE5\\u4E0A\\u9762\\u7684\\u4EE3\\u7801\\u4E2D\\u76F4\\u63A5\\u8FD4\\u56DE\\u4E86\\u4E00\\u4E2A\\u56FA\\u5B9A \",(0,n.jsx)(e.code,{children:\"user\"}),\" \\u4FE1\\u606F\\uFF0C\\u90A3\\u771F\\u5B9E\\u7684\\u6D41\\u7A0B\\u5E94\\u8BE5\\u662F\\uFF1A\\u90AE\\u7BB1\\u767B\\u5F55\\u2014\\u2014\u003e \\u8BBE\\u7F6E\\u5BC6\\u7801\\u2014\\u2014\u003e\\u5BC6\\u7801\\u767B\\u5F55\"]}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.strong,{children:\"\\u5B9E\\u73B0\\u6548\\u679C\"}),\":\"]}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:\"\\u5BC6\\u7801\\u767B\\u5F55\\u754C\\u9762\",src:\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/69b4253a8cae4cb5b60a0dcbd3b1d345~tplv-k3u1fbpfcp-zoom-1.image\"})}),(0,n.jsxs)(e.h2,{id:\"\\u81EA\\u5B9A\\u4E49\\u767B\\u5F55\\u9875\\u9762\",children:[(0,n.jsx)(e.a,{href:\"#\\u81EA\\u5B9A\\u4E49\\u767B\\u5F55\\u9875\\u9762\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\u81EA\\u5B9A\\u4E49\\u767B\\u5F55\\u9875\\u9762\"]}),(0,n.jsx)(e.p,{children:\"\\u6709\\u540C\\u5B66\\u4F1A\\u8BF4\\uFF0C\\u8FD9\\u4E2A\\u9875\\u9762\\u600E\\u4E48\\u8FD9\\u4E48\\u4E11\\uFF0C\\u65E2\\u6709\\u4E2D\\u6587\\u4E5F\\u6709\\u82F1\\u6587\\u5462\\uFF1F\\u663E\\u7136\\u5728\\u56FD\\u5185\\u662F\\u4E0D\\u5408\\u9002\\u7684\\uFF0C Next-auth \\u5E2E\\u6211\\u4EEC\\u8003\\u8651\\u5230\\u4E86\\uFF0C\\u5B83\\u652F\\u6301\\u914D\\u7F6E\\u81EA\\u5B9A\\u4E49\\u9875\\u9762\\u3002\"}),(0,n.jsxs)(e.p,{children:[\"\\u5728 \",(0,n.jsx)(e.code,{children:\"pages/api/auth/[...nextauth].ts\"}),\" \\u6DFB\\u52A0 \",(0,n.jsx)(e.code,{children:\"pages\"}),\" \\u53C2\\u6570\\u5C31\\u53EF\\u4EE5\\u5B9E\\u73B0\\u81EA\\u5B9A\\u4E49\"]}),(0,n.jsx)(e.pre,{className:\"language-ts\",children:(0,n.jsxs)(e.code,{className:\"language-ts code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"pages\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    signIn\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'/auth/login'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"\\u81EA\\u5B9A\\u4E49\\u754C\\u9762 \\uFF0C\\u53EF\\u914D\\u7F6E \",(0,n.jsx)(e.code,{children:\"signIn\"}),\"\\uFF0C\",(0,n.jsx)(e.code,{children:\"signOut\"}),\"\\uFF0C\",(0,n.jsx)(e.code,{children:\"error\"}),\"\\uFF0C\",(0,n.jsx)(e.code,{children:\"verifyRequest\"}),\" \\u548C \",(0,n.jsx)(e.code,{children:\"newUser\"}),\"\\uFF0C\\u5728\\u8FD9\\u91CC\\uFF0C\\u6211\\u4EEC\\u53EA\\u914D\\u7F6E\\u767B\\u5F55\\u9875\\u9762\\u3002\"]}),(0,n.jsx)(e.p,{children:\"\\u767B\\u5F55\\u9875\\u9762\\u7684 dom \\u7ED3\\u6784\\u53EF\\u4EE5\\u53C2\\u8003\\u9ED8\\u8BA4\\u7684 dom \\u7ED3\\u6784\\uFF0C \\u76F4\\u63A5\\u590D\\u5236\\u51FA\\u6765\\u5C31\\u53EF\\u4EE5\\u4E86\\u3002\"}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:\"\\u67E5\\u770B\\u9ED8\\u8BA4\\u767B\\u5F55\\u754C\\u9762dom\",src:\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d7dbe3e136cf4bc1b5dc550832e41dba~tplv-k3u1fbpfcp-zoom-1.image\"})}),(0,n.jsxs)(e.p,{children:[\"\\u6211\\u4EEC\\u53EF\\u4EE5\\u770B\\u5230 form \\u8868\\u5355\\u4E2D\\uFF0C\\u6709\\u4E2A\\u9ED8\\u8BA4\\u7684\\u9690\\u85CF\\u57DF\\uFF0C\\u63D0\\u4EA4\\u4E86 \",(0,n.jsx)(e.code,{children:\"csrfToken\"}),\" \\u7684\\u503C\\uFF0C\\u90A3\\u4E48\\u8FD9\\u4E2A\\u503C\\u8BE5\\u5982\\u4F55\\u83B7\\u53D6\\u5462\\uFF1F\"]}),(0,n.jsx)(e.pre,{className:\"language-tsx\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-tsx\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token imports\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" getCsrfToken \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'next-auth/react'\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"export\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"default\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"SignIn\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" csrfToken \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c\"}),\"form\"]}),\" \",(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"method\"}),(0,n.jsxs)(e.span,{className:\"token attr-value\",children:[(0,n.jsx)(e.span,{className:\"token punctuation attr-equals\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:'\"'}),\"post\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:'\"'})]}),\" \",(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"action\"}),(0,n.jsxs)(e.span,{className:\"token attr-value\",children:[(0,n.jsx)(e.span,{className:\"token punctuation attr-equals\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:'\"'}),\"/api/auth/signin/email\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:'\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),(0,n.jsx)(e.span,{className:\"token plain-text\",children:`\n`})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token plain-text\",children:\"      \"}),(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c\"}),\"input\"]}),\" \",(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"name\"}),(0,n.jsxs)(e.span,{className:\"token attr-value\",children:[(0,n.jsx)(e.span,{className:\"token punctuation attr-equals\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:'\"'}),\"csrfToken\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:'\"'})]}),\" \",(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"type\"}),(0,n.jsxs)(e.span,{className:\"token attr-value\",children:[(0,n.jsx)(e.span,{className:\"token punctuation attr-equals\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:'\"'}),\"hidden\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:'\"'})]}),\" \",(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"defaultValue\"}),(0,n.jsxs)(e.span,{className:\"token language-javascript script\",children:[(0,n.jsx)(e.span,{className:\"token punctuation script-punctuation\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"csrfToken\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"/\u003e\"})]}),(0,n.jsx)(e.span,{className:\"token plain-text\",children:`\n`})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token plain-text\",children:\"      \"}),(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c\"}),\"label\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),(0,n.jsx)(e.span,{className:\"token plain-text\",children:`\n`})]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token plain-text\",children:`        Email address\n`})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token plain-text\",children:\"        \"}),(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c\"}),\"input\"]}),\" \",(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"type\"}),(0,n.jsxs)(e.span,{className:\"token attr-value\",children:[(0,n.jsx)(e.span,{className:\"token punctuation attr-equals\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:'\"'}),\"email\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:'\"'})]}),\" \",(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"id\"}),(0,n.jsxs)(e.span,{className:\"token attr-value\",children:[(0,n.jsx)(e.span,{className:\"token punctuation attr-equals\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:'\"'}),\"email\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:'\"'})]}),\" \",(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"name\"}),(0,n.jsxs)(e.span,{className:\"token attr-value\",children:[(0,n.jsx)(e.span,{className:\"token punctuation attr-equals\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:'\"'}),\"email\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:'\"'})]}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"/\u003e\"})]}),(0,n.jsx)(e.span,{className:\"token plain-text\",children:`\n`})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token plain-text\",children:\"      \"}),(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"label\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),(0,n.jsx)(e.span,{className:\"token plain-text\",children:`\n`})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token plain-text\",children:\"      \"}),(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c\"}),\"button\"]}),\" \",(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"type\"}),(0,n.jsxs)(e.span,{className:\"token attr-value\",children:[(0,n.jsx)(e.span,{className:\"token punctuation attr-equals\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:'\"'}),\"submit\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:'\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),(0,n.jsx)(e.span,{className:\"token plain-text\",children:\"Sign in with Email\"}),(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"button\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),(0,n.jsx)(e.span,{className:\"token plain-text\",children:`\n`})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token plain-text\",children:\"    \"}),(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"form\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"export\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"getServerSideProps\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" csrfToken \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"await\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"getCsrfToken\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    props\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" csrfToken \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"csrfToken\"}),\" \\u53EF\\u4EE5\\u901A\\u8FC7\\u5BFC\\u51FA\\u7684 \",(0,n.jsx)(e.code,{children:\"getCsrfToken\"}),\" \\u65B9\\u6CD5\\u83B7\\u53D6\\uFF0C\\u5E76\\u4E14\\u8D4B\\u503C\\u7ED9\\u9690\\u85CF\\u57DF \",(0,n.jsx)(e.code,{children:\"csrfToken\"}),\"\\uFF0C\\u5728\\u63D0\\u4EA4\\u8868\\u5355\\u7684\\u65F6\\u5019\\uFF0C\\u5C31\\u4F1A\\u81EA\\u52A8\\u63D0\\u4EA4\\u8BE5\\u503C\\u3002\"]}),(0,n.jsx)(e.p,{children:\"\\u6700\\u540E\\u6211\\u4EEC\\u6765\\u770B\\u4E0B\\u5B9E\\u73B0\\u6548\\u679C:\"}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:\"\\u81EA\\u5B9A\\u4E49\\u767B\\u5F55\\u9875\\u9762\",src:\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bc4575f1b5ff491d94f555e9121c2cf2~tplv-k3u1fbpfcp-zoom-1.image\"})}),(0,n.jsxs)(e.p,{children:[\"\\u662F\\u4E0D\\u662F\\u6709\\u56FD\\u5185 App \\u7684\\u98CE\\u683C\\u4E86\\u5462\\uFF1F\\u8FD9\\u91CC\\u6211\\u4F7F\\u7528\\u4E86 \",(0,n.jsx)(e.code,{children:\"@chakra-ui/react\"}),\" \\u5B9E\\u73B0\\u4EE3\\u7801\\u4E5F\\u5F88\\u7B80\\u5355\\uFF0C\\u8FD9\\u91CC\\u5C31\\u4E0D\\u8D34\\u4E86\\uFF0C\\u611F\\u5174\\u8DA3\\u7684\\u5C0F\\u4F19\\u4F34\\u53EF\\u4EE5\\u76F4\\u63A5\\u770B\\u6211\\u7684 \",(0,n.jsx)(e.a,{href:\"https://github.com/maqi1520/next-prisma-video-app\",children:\"github\"}),\"\\u3002\"]}),(0,n.jsx)(e.p,{children:\"\\u8FD8\\u6709\\u4E9B\\u5C0F\\u4F19\\u4F34\\u4F1A\\u95EE\\uFF0C\\u767B\\u5F55\\u9875\\u9762\\u80FD\\u5426\\u80FD\\u505A\\u6210\\u5F39\\u7A97\\u5462\\uFF1F\\u5F53\\u7136\\u4E5F\\u53EF\\u4EE5\\u3002\"}),(0,n.jsx)(e.pre,{className:\"language-tsx\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-tsx\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token imports\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" signIn \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'next-auth/react'\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"export\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"default\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"Login\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c\"}),\"button\"]}),`\n`]})]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsxs)(e.span,{className:\"token tag\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"onClick\"}),(0,n.jsxs)(e.span,{className:\"token language-javascript script\",children:[(0,n.jsx)(e.span,{className:\"token punctuation script-punctuation\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator arrow\",children:\"=\u003e\"}),`\n`]})]})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token tag\",children:(0,n.jsxs)(e.span,{className:\"token language-javascript script\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token function\",children:\"signIn\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'credentials'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token tag\",children:(0,n.jsxs)(e.span,{className:\"token language-javascript script\",children:[\"          email\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'xiaoma@example.com'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token tag\",children:(0,n.jsxs)(e.span,{className:\"token language-javascript script\",children:[\"          password\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'1234'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token tag\",children:(0,n.jsxs)(e.span,{className:\"token language-javascript script\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token language-javascript script\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),`\n`]})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),(0,n.jsx)(e.span,{className:\"token plain-text\",children:`\n`})]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token plain-text\",children:`      \\u767B\\u5F55\n`})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token plain-text\",children:\"    \"}),(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"button\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"\\u754C\\u9762\\u6211\\u4EEC\\u53EF\\u4EE5\\u5B8C\\u5168\\u81EA\\u5B9A\\u4E49\\uFF0C\\u5199\\u6210\\u4E00\\u4E2A\\u7EC4\\u4EF6\\uFF0C\\u53EA\\u9700\\u8981\\u8C03\\u7528\\u5185\\u7F6E\\u7684 \",(0,n.jsx)(e.code,{children:\"signIn\"}),\" \\u65B9\\u6CD5\\u5373\\u53EF\\uFF0C\\u5B83\\u4F1A\\u5E2E\\u6211\\u4EEC\\u81EA\\u52A8\\u6DFB\\u52A0 \",(0,n.jsx)(e.code,{children:\"csrfToken\"}),\" \\u503C\\u3002\"]}),(0,n.jsxs)(e.h2,{id:\"\\u5C0F\\u7ED3\",children:[(0,n.jsx)(e.a,{href:\"#\\u5C0F\\u7ED3\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\u5C0F\\u7ED3\"]}),(0,n.jsxs)(e.p,{children:[\"\\u601D\\u8003\\uFF1A\\u56FD\\u5185 app \\u4F7F\\u7528\\u624B\\u673A\\u77ED\\u4FE1\\u9A8C\\u8BC1\\u767B\\u5F55\\u5DF2\\u7ECF\\u6210\\u4E3A\\u4E3B\\u6D41\\uFF0C\\u7ED3\\u5408\\u524D\\u9762\\u7684\\u6587\\u7AE0\\uFF0C\\u6211\\u4EEC\\u8BE5\\u5982\\u4F55\\u4FEE\\u6539\\u8868\\uFF0C\\u4F7F\\u7528\\u54EA\\u4E2A \",(0,n.jsx)(e.code,{children:\"providers\"}),\" \\u6765\\u5B9E\\u73B0\\uFF1F\\u76F8\\u4FE1\\u4F60\\u5DF2\\u7ECF\\u6709\\u4E86\\u7B54\\u6848\\u3002\"]}),(0,n.jsx)(e.p,{children:\"\\u672C\\u6587\\u901A\\u8FC7 NextAuth.js\\uFF0C \\u7ED9\\u6211\\u4EEC\\u7684\\u89C6\\u9891\\u7F51\\u7AD9\\u5B9E\\u73B0\\u4E86\\u90AE\\u7BB1\\u767B\\u5F55\\u3001 Github \\u6388\\u6743\\u767B\\u5F55\\uFF0C\\u4EE5\\u53CA\\u5BC6\\u7801\\u767B\\u5F55\\u3002\\u4F60\\u5B66\\u4F1A\\u4E86\\u5417\\uFF1F\\u82E5\\u5BF9\\u4F60\\u6709\\u5E2E\\u52A9\\uFF0C\\u8BB0\\u5F97\\u5E2E\\u6211\\u70B9\\u8D5E\\u3002\"}),(0,n.jsxs)(e.h2,{id:\"\\u540E\\u7EED\",children:[(0,n.jsx)(e.a,{href:\"#\\u540E\\u7EED\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\u540E\\u7EED\"]}),(0,n.jsx)(e.p,{children:\"\\u63A5\\u4E0B\\u6765\\u6211\\u5C06\\u7EE7\\u7EED\\u5206\\u4EAB Next.js \\u76F8\\u5173\\u7684\\u5B9E\\u6218\\u6587\\u7AE0\\uFF0C\\u6B22\\u8FCE\\u5404\\u4F4D\\u5173\\u6CE8\\u6211\\u7684\\u300ANext.js \\u5168\\u6808\\u5F00\\u53D1\\u5B9E\\u6218\\u300B \\u4E13\\u680F\\u3002\"}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:\"\\u4F7F\\u7528 React query \\u7ED9 Next.js \\u5E94\\u7528\\u5168\\u5C40\\u72B6\\u6001\\u7BA1\\u7406\"}),(0,n.jsx)(e.li,{children:\"\\u4F7F\\u7528 i18next \\u5B9E\\u73B0 Next.js \\u5E94\\u7528\\u56FD\\u9645\\u5316\"}),(0,n.jsx)(e.li,{children:\"\\u4F7F\\u7528 Playwright \\u8FDB\\u884C Next.js \\u5E94\\u7528\\u7684\\u7AEF\\u5230\\u7AEF\\u6D4B\\u8BD5\"}),(0,n.jsx)(e.li,{children:\"\\u4F7F\\u7528 Github actions \\u7ED9 Next.js \\u5E94\\u7528\\u521B\\u5EFA CI/CD\"}),(0,n.jsx)(e.li,{children:\"\\u4F7F\\u7528 Docker \\u90E8\\u7F72 Next.js \\u5E94\\u7528\"}),(0,n.jsx)(e.li,{children:\"\\u5C06 Next.js \\u5E94\\u7528\\u90E8\\u7F72\\u5230\\u817E\\u8BAF\\u4E91 serverless\"})]}),(0,n.jsx)(e.p,{children:\"\\u4F60\\u5BF9\\u54EA\\u5757\\u5185\\u5BB9\\u6BD4\\u8F83\\u611F\\u5174\\u8DA3\\u5462\\uFF1F\\u6B22\\u8FCE\\u5728\\u8BC4\\u8BBA\\u533A\\u7559\\u8A00\\uFF0C\\u611F\\u8C22\\u60A8\\u7684\\u9605\\u8BFB\\u3002\"})]})}}var x=w;return y(v);})();\n;return Component;","toc":[{"value":"前言","url":"#前言","depth":2},{"value":"Next.js 应用接入 NextAuth","url":"#nextjs-应用接入-nextauth","depth":2},{"value":"安装","url":"#安装","depth":3},{"value":"授权 api","url":"#授权-api","depth":3},{"value":"Github 授权流程","url":"#github-授权流程","depth":2},{"value":"注册 GitHub OAuth Application","url":"#注册-github-oauth-application","depth":3},{"value":"配置 pages/_app.ts","url":"#配置-pages_appts","depth":3},{"value":"客户端获取登录信息","url":"#客户端获取登录信息","depth":2},{"value":"SSR 页面获取登录信息","url":"#ssr-页面获取登录信息","depth":2},{"value":"Prisma 适配","url":"#prisma-适配","depth":2},{"value":"服务端渲染我的视频","url":"#服务端渲染我的视频","depth":3},{"value":"邮箱授权登录","url":"#邮箱授权登录","depth":2},{"value":"更改邮件模板","url":"#更改邮件模板","depth":3},{"value":"密码登录","url":"#密码登录","depth":2},{"value":"自定义登录页面","url":"#自定义登录页面","depth":2},{"value":"小结","url":"#小结","depth":2},{"value":"后续","url":"#后续","depth":2}],"frontMatter":{"readingTime":{"text":"16 min read","minutes":15.05,"time":903000,"words":3010},"slug":"使用 NextAuth.js 给 Next.js 应用添加鉴权与认证","fileName":"使用 NextAuth.js 给 Next.js 应用添加鉴权与认证.md","title":"使用 NextAuth.js 给 Next.js 应用添加鉴权与认证","date":"2022-10-17T16:12:49.000Z","lastmod":"2023/1/25 11:42:55","tags":["React.js"],"draft":false,"summary":"在上一篇文章中，我们使用 prisma 和 Next.js，创建了一个视频网站，本文将继续开发视频网站，实现邮箱登录、 Github 授权登录，以及密码登录。","images":"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fca150f8a98e4692ba770f4523171bf5~tplv-k3u1fbpfcp-watermark.image?","authors":["default"],"layout":"PostLayout"}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.19,"time":11400,"words":38},"slug":["default"],"fileName":"default.md","name":"随风","avatar":"/static/images/avatar.jpeg","occupation":"前端工程师","company":"分享 JavaScript 热门框架，记录前端工程师学习成长历程。","email":"tianping888@163.com","juejin":"https://juejin.cn","zhihu":"https://www.zhihu.com","github":"https://github.com/balac2015","date":null}],"prev":{"title":"使用 Notion 数据库进行 Next.js 应用全栈开发","date":"2022-09-27T15:49:28.000Z","lastmod":"2023/1/25 11:42:59","tags":["React.js","数据库"],"draft":false,"summary":"今天我就得带大家来白嫖一下 Notion 数据库，让我们的个人应用轻松上线，本文记录了利用 Next.js 和 Notion API 编写了一个前端刷题网站的全过程。","images":"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0e025d77556e4073989114847ff39959~tplv-k3u1fbpfcp-watermark.image?","authors":["default"],"layout":"PostLayout","slug":"使用 Notion 数据库进行 Next.js 应用全栈开发"},"next":{"title":"使用 Vitest 和 React Testing Library 给 Next.js 应用单元测试","date":"2022-10-25T15:51:35.000Z","lastmod":"2023/1/25 11:42:53","tags":["前端","React.js"],"draft":false,"summary":"在本文中我们给 Next.js 应用配置了 vitest 和 React-testing-library 测试环境，这套配置同样适用于其他 react 项目，只需要依照步骤配置即可。","images":"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d17f81bec9424f6bbf2e808cebff6706~tplv-k3u1fbpfcp-watermark.image?","authors":["default"],"layout":"PostLayout","slug":"使用 Vitest 和 React Testing Library 给 Next.js 应用单元测试"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["使用 NextAuth.js 给 Next.js 应用添加鉴权与认证"]},"buildId":"xRVIygn0gkexXE3qpo3Pp","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>