<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><title>Next.js 应用实现权限管理</title><meta name="robots" content="follow, index"/><meta name="description" content="今天我们就聊一聊权限系统的设计与实现，要在网站中实现复杂的权限管理对应新手来说，这可能会是比较困难的，但权限系统是软件中不可或缺的部分，我们只要掌握一个套路，就会变得非常简单，一起来看看吧！"/><meta property="og:url" content="https://github.com/balac2015/blog/Next.js%20%E5%BA%94%E7%94%A8%E5%AE%9E%E7%8E%B0%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Coding 工坊 | 随风"/><meta property="og:description" content="今天我们就聊一聊权限系统的设计与实现，要在网站中实现复杂的权限管理对应新手来说，这可能会是比较困难的，但权限系统是软件中不可或缺的部分，我们只要掌握一个套路，就会变得非常简单，一起来看看吧！"/><meta property="og:title" content="Next.js 应用实现权限管理"/><meta property="og:image" content="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1e6342307e9244edb7650de27adf8eda~tplv-k3u1fbpfcp-watermark.image?"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site"/><meta name="twitter:title" content="Next.js 应用实现权限管理"/><meta name="twitter:description" content="今天我们就聊一聊权限系统的设计与实现，要在网站中实现复杂的权限管理对应新手来说，这可能会是比较困难的，但权限系统是软件中不可或缺的部分，我们只要掌握一个套路，就会变得非常简单，一起来看看吧！"/><meta name="twitter:image" content="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1e6342307e9244edb7650de27adf8eda~tplv-k3u1fbpfcp-watermark.image?"/><meta property="article:published_time" content="2022-11-14T14:48:39.000Z"/><meta property="article:modified_time" content="2023-01-25T03:42:28.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://github.com/balac2015/blog/Next.js 应用实现权限管理"
  },
  "headline": "Next.js 应用实现权限管理",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1e6342307e9244edb7650de27adf8eda~tplv-k3u1fbpfcp-watermark.image?"
    }
  ],
  "datePublished": "2022-11-14T14:48:39.000Z",
  "dateModified": "2023-01-25T03:42:28.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "随风"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "随风",
    "logo": {
      "@type": "ImageObject",
      "url": "https://github.com/balac2015/static/images/logo.png"
    }
  },
  "description": "今天我们就聊一聊权限系统的设计与实现，要在网站中实现复杂的权限管理对应新手来说，这可能会是比较困难的，但权限系统是软件中不可或缺的部分，我们只要掌握一个套路，就会变得非常简单，一起来看看吧！"
}</script><meta name="next-head-count" content="20"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" content="#000000"/><meta name="referrer" content="no-referrer"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/css/74948a7751764c68.css" as="style"/><link rel="stylesheet" href="/_next/static/css/74948a7751764c68.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-925c2639b2e726da.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-b4cdd9636ac3694c.js" defer=""></script><script src="/_next/static/chunks/pages/_app-c437ddfe1566e6c0.js" defer=""></script><script src="/_next/static/chunks/410-dc08c716b48ef576.js" defer=""></script><script src="/_next/static/chunks/606-bcfce32a938ad92d.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-a12f8dbad1f7fc24.js" defer=""></script><script src="/_next/static/aH9txFemS00-bQZ7Vq_Y7/_buildManifest.js" defer=""></script><script src="/_next/static/aH9txFemS00-bQZ7Vq_Y7/_ssgManifest.js" defer=""></script><script src="/_next/static/aH9txFemS00-bQZ7Vq_Y7/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><h1><a aria-label="随风小站" href="/"><div class="flex items-center justify-between"><span><svg width="52" height="26" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><image xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAaCAYAAADFTB7LAAAAAXNSR0IArs4c6QAAAHplWElmTU0AKgAAAAgAAwESAAMAAAABAAEAAAExAAIAAAAeAAAAModpAAQAAAABAAAAUAAAAABBZG9iZSBQaG90b3Nob3AgQ1M2IChXaW5kb3dzKQAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAKKADAAQAAAABAAAAGgAAAACQIupnAAAEEWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNi4wLjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgICAgICAgICAgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiCiAgICAgICAgICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8eG1wTU06RG9jdW1lbnRJRD54bXAuZGlkOjdFNDI1QUQ2RkQxNzExRTg5RUUyRDA2RDA3NDUyMUM1PC94bXBNTTpEb2N1bWVudElEPgogICAgICAgICA8eG1wTU06SW5zdGFuY2VJRD54bXAuaWlkOjdFNDI1QUQ1RkQxNzExRTg5RUUyRDA2RDA3NDUyMUM1PC94bXBNTTpJbnN0YW5jZUlEPgogICAgICAgICA8eG1wTU06RGVyaXZlZEZyb20gcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPgogICAgICAgICAgICA8c3RSZWY6aW5zdGFuY2VJRD54bXAuaWlkOjdFNDI1QUQzRkQxNzExRTg5RUUyRDA2RDA3NDUyMUM1PC9zdFJlZjppbnN0YW5jZUlEPgogICAgICAgICAgICA8c3RSZWY6ZG9jdW1lbnRJRD54bXAuZGlkOjdFNDI1QUQ0RkQxNzExRTg5RUUyRDA2RDA3NDUyMUM1PC9zdFJlZjpkb2N1bWVudElEPgogICAgICAgICA8L3htcE1NOkRlcml2ZWRGcm9tPgogICAgICAgICA8eG1wOkNyZWF0b3JUb29sPkFkb2JlIFBob3Rvc2hvcCBDUzYgKFdpbmRvd3MpPC94bXA6Q3JlYXRvclRvb2w+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo0psFQAAACSElEQVRYCc2WMUhVURjH79VQEISKDAfFAqVBbHDOLcFNB0scinJrkrbarMFBEAxSQXCJWuQNurgIEoJTOBRSrdFghqZgaIWv5+8v56qvd73vnKM37gc/znnnfN//+99z73v3BYFFFAqFengB67ALc9BsUZpuCiYuwjD8hH9jk4Vb6TpIUKf5Q9g44SrPfBam4a9Z32O8myCTzhZNnxsDGvbhDbRG3Zg/gD+gkPHBaC/1kWY9EJ3QW+YtcU1Z74IdiGKESRiXe25rNLgOW6ajvghVSeLst8OaydfwCi4k1XjvIVwF70CxAjU2YuRdg48QRY5JpU2tUw6io6bDV8YGl2LyL8Oyqdcw4lJfNhdBPU967rahrWxBTAJ1NaBnViGtzpg09yWE6kDPkb6tt90VjiuM1hdGhcba413PGSIvpUY88pQoKkOnA3SxiomiTZ8PiOj0Fn1qT6tBbwgUutUdp+VZrSOgq31mlWyZhF4lLIHiM1RblpakVbDyA/ZKds6wEIZhnvJ7sAU34Cn4hbnCJ37VyVVo94LiF8S+kZIVgkAnqKtMJTjJHMJToFs87tNEBjd9Ch1qHpP7CTo5xTsOdYepMrjhWuSSzynukt8Pv2EMk00u9f/jBANMvsfUfbgCeiVavxAigwWXq/LJxeQMdfpNXIcFTM5DH1xN0gtJGCChGoHJpMTz2qOf/jPKaDfchEvwHVbhAz5eMx6F/rtps/FoJeUJBnS3lgxlu+kW68gzGzK4lll3GJPBb5DPqskKnol9YzKTHg8A2r/9Qs/XFFsAAAAASUVORK5CYII=" height="26" width="40"></image><image href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAaCAYAAADFTB7LAAAAAXNSR0IArs4c6QAAAHplWElmTU0AKgAAAAgAAwESAAMAAAABAAEAAAExAAIAAAAeAAAAModpAAQAAAABAAAAUAAAAABBZG9iZSBQaG90b3Nob3AgQ1M2IChXaW5kb3dzKQAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAKKADAAQAAAABAAAAGgAAAACQIupnAAAEEWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNi4wLjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgICAgICAgICAgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiCiAgICAgICAgICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8eG1wTU06RG9jdW1lbnRJRD54bXAuZGlkOjdFNDI1QUQ2RkQxNzExRTg5RUUyRDA2RDA3NDUyMUM1PC94bXBNTTpEb2N1bWVudElEPgogICAgICAgICA8eG1wTU06SW5zdGFuY2VJRD54bXAuaWlkOjdFNDI1QUQ1RkQxNzExRTg5RUUyRDA2RDA3NDUyMUM1PC94bXBNTTpJbnN0YW5jZUlEPgogICAgICAgICA8eG1wTU06RGVyaXZlZEZyb20gcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPgogICAgICAgICAgICA8c3RSZWY6aW5zdGFuY2VJRD54bXAuaWlkOjdFNDI1QUQzRkQxNzExRTg5RUUyRDA2RDA3NDUyMUM1PC9zdFJlZjppbnN0YW5jZUlEPgogICAgICAgICAgICA8c3RSZWY6ZG9jdW1lbnRJRD54bXAuZGlkOjdFNDI1QUQ0RkQxNzExRTg5RUUyRDA2RDA3NDUyMUM1PC9zdFJlZjpkb2N1bWVudElEPgogICAgICAgICA8L3htcE1NOkRlcml2ZWRGcm9tPgogICAgICAgICA8eG1wOkNyZWF0b3JUb29sPkFkb2JlIFBob3Rvc2hvcCBDUzYgKFdpbmRvd3MpPC94bXA6Q3JlYXRvclRvb2w+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo0psFQAAACSElEQVRYCc2WMUhVURjH79VQEISKDAfFAqVBbHDOLcFNB0scinJrkrbarMFBEAxSQXCJWuQNurgIEoJTOBRSrdFghqZgaIWv5+8v56qvd73vnKM37gc/znnnfN//+99z73v3BYFFFAqFengB67ALc9BsUZpuCiYuwjD8hH9jk4Vb6TpIUKf5Q9g44SrPfBam4a9Z32O8myCTzhZNnxsDGvbhDbRG3Zg/gD+gkPHBaC/1kWY9EJ3QW+YtcU1Z74IdiGKESRiXe25rNLgOW6ajvghVSeLst8OaydfwCi4k1XjvIVwF70CxAjU2YuRdg48QRY5JpU2tUw6io6bDV8YGl2LyL8Oyqdcw4lJfNhdBPU967rahrWxBTAJ1NaBnViGtzpg09yWE6kDPkb6tt90VjiuM1hdGhcba413PGSIvpUY88pQoKkOnA3SxiomiTZ8PiOj0Fn1qT6tBbwgUutUdp+VZrSOgq31mlWyZhF4lLIHiM1RblpakVbDyA/ZKds6wEIZhnvJ7sAU34Cn4hbnCJ37VyVVo94LiF8S+kZIVgkAnqKtMJTjJHMJToFs87tNEBjd9Ch1qHpP7CTo5xTsOdYepMrjhWuSSzynukt8Pv2EMk00u9f/jBANMvsfUfbgCeiVavxAigwWXq/LJxeQMdfpNXIcFTM5DH1xN0gtJGCChGoHJpMTz2qOf/jPKaDfchEvwHVbhAz5eMx6F/rtps/FoJeUJBnS3lgxlu+kW68gzGzK4lll3GJPBb5DPqskKnol9YzKTHg8A2r/9Qs/XFFsAAAAASUVORK5CYII=" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAaCAYAAADFTB7LAAAAAXNSR0IArs4c6QAAAHplWElmTU0AKgAAAAgAAwESAAMAAAABAAEAAAExAAIAAAAeAAAAModpAAQAAAABAAAAUAAAAABBZG9iZSBQaG90b3Nob3AgQ1M2IChXaW5kb3dzKQAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAKKADAAQAAAABAAAAGgAAAACQIupnAAAEEWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNi4wLjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgICAgICAgICAgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiCiAgICAgICAgICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8eG1wTU06RG9jdW1lbnRJRD54bXAuZGlkOjdFNDI1QUQ2RkQxNzExRTg5RUUyRDA2RDA3NDUyMUM1PC94bXBNTTpEb2N1bWVudElEPgogICAgICAgICA8eG1wTU06SW5zdGFuY2VJRD54bXAuaWlkOjdFNDI1QUQ1RkQxNzExRTg5RUUyRDA2RDA3NDUyMUM1PC94bXBNTTpJbnN0YW5jZUlEPgogICAgICAgICA8eG1wTU06RGVyaXZlZEZyb20gcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPgogICAgICAgICAgICA8c3RSZWY6aW5zdGFuY2VJRD54bXAuaWlkOjdFNDI1QUQzRkQxNzExRTg5RUUyRDA2RDA3NDUyMUM1PC9zdFJlZjppbnN0YW5jZUlEPgogICAgICAgICAgICA8c3RSZWY6ZG9jdW1lbnRJRD54bXAuZGlkOjdFNDI1QUQ0RkQxNzExRTg5RUUyRDA2RDA3NDUyMUM1PC9zdFJlZjpkb2N1bWVudElEPgogICAgICAgICA8L3htcE1NOkRlcml2ZWRGcm9tPgogICAgICAgICA8eG1wOkNyZWF0b3JUb29sPkFkb2JlIFBob3Rvc2hvcCBDUzYgKFdpbmRvd3MpPC94bXA6Q3JlYXRvclRvb2w+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo0psFQAAACSElEQVRYCc2WMUhVURjH79VQEISKDAfFAqVBbHDOLcFNB0scinJrkrbarMFBEAxSQXCJWuQNurgIEoJTOBRSrdFghqZgaIWv5+8v56qvd73vnKM37gc/znnnfN//+99z73v3BYFFFAqFengB67ALc9BsUZpuCiYuwjD8hH9jk4Vb6TpIUKf5Q9g44SrPfBam4a9Z32O8myCTzhZNnxsDGvbhDbRG3Zg/gD+gkPHBaC/1kWY9EJ3QW+YtcU1Z74IdiGKESRiXe25rNLgOW6ajvghVSeLst8OaydfwCi4k1XjvIVwF70CxAjU2YuRdg48QRY5JpU2tUw6io6bDV8YGl2LyL8Oyqdcw4lJfNhdBPU967rahrWxBTAJ1NaBnViGtzpg09yWE6kDPkb6tt90VjiuM1hdGhcba413PGSIvpUY88pQoKkOnA3SxiomiTZ8PiOj0Fn1qT6tBbwgUutUdp+VZrSOgq31mlWyZhF4lLIHiM1RblpakVbDyA/ZKds6wEIZhnvJ7sAU34Cn4hbnCJ37VyVVo94LiF8S+kZIVgkAnqKtMJTjJHMJToFs87tNEBjd9Ch1qHpP7CTo5xTsOdYepMrjhWuSSzynukt8Pv2EMk00u9f/jBANMvsfUfbgCeiVavxAigwWXq/LJxeQMdfpNXIcFTM5DH1xN0gtJGCChGoHJpMTz2qOf/jPKaDfchEvwHVbhAz5eMx6F/rtps/FoJeUJBnS3lgxlu+kW68gzGzK4lll3GJPBb5DPqskKnol9YzKTHg8A2r/9Qs/XFFsAAAAASUVORK5CYII=" height="26" width="40" x="15"></image></svg></span><div class="hidden text-2xl font-semibold sm:block">随风小站</div></div></a></h1><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">文章</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">标签</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/projects">项目</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tools">工具</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/boilerplate">模板</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/about">关于</a></div><div class="ml-1 mr-1 flex items-center sm:ml-4"><a class="block p-1" title="RSS" href="/feed.xml"><svg fill="currentColor" class="h-5 w-5" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M3.75 3a.75.75 0 00-.75.75v.5c0 .414.336.75.75.75H4c6.075 0 11 4.925 11 11v.25c0 .414.336.75.75.75h.5a.75.75 0 00.75-.75V16C17 8.82 11.18 3 4 3h-.25z"></path><path d="M3 8.75A.75.75 0 013.75 8H4a8 8 0 018 8v.25a.75.75 0 01-.75.75h-.5a.75.75 0 01-.75-.75V16a6 6 0 00-6-6h-.25A.75.75 0 013 9.25v-.5zM7 15a2 2 0 11-4 0 2 2 0 014 0z"></path></svg></a><button aria-label="Toggle Dark Mode" type="button" class="h-7 w-7 rounded p-1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button></div><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-50 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">文章</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">标签</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/projects">项目</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tools">工具</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/boilerplate">模板</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">关于</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div style="transform:translateX(-100%)" class="fixed top-0 left-0 h-1 w-full bg-primary-500 backdrop-blur-3xl transition-transform duration-150"></div><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2022-11-14T14:48:39.000Z">2022年11月14日星期一</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Next.js 应用实现权限管理</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><div class=""><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><img alt="avatar" src="/static/images/avatar.jpeg" width="38px" height="38px" class="h-10 w-10 rounded-full"/><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">作者</dt><dd class="text-gray-900 dark:text-gray-100">随风</dd></dl></li></ul></dd></dl><h2 class="pt-6 text-xs font-bold uppercase tracking-wide text-gray-500 dark:text-gray-400">目录</h2><ul class="py-4 text-sm font-medium leading-relaxed xl:border-b xl:border-gray-200 xl:dark:border-gray-700"><li class="false"><a class="text-primary-500" href="#前言">前言</a></li><li class="false"><a class="text-primary-500" href="#权限区分">权限区分</a></li><li class="false"><a class="text-primary-500" href="#权限系统设计">权限系统设计</a></li><li class="false"><a class="text-primary-500" href="#后端接口设计">后端接口设计</a></li><li class="false"><a class="text-primary-500" href="#react-中实现权限管理">React 中实现权限管理</a></li><li class="false"><a class="text-primary-500" href="#nextjs-实现权限管理">Next.js 实现权限管理</a></li><li class="false"><a class="text-primary-500" href="#小结">小结</a></li></ul></div><div class="xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="mt-6"><img alt="Next.js 应用实现权限管理" class="w-full rounded object-cover shadow-lg" src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1e6342307e9244edb7650de27adf8eda~tplv-k3u1fbpfcp-watermark.image?"/></div><div class="prose max-w-none break-words pt-10 pb-8 dark:prose-dark"><blockquote><p>文章为稀土掘金技术社区首发签约文章，14 天内禁止转载，14 天后未获授权禁止转载，侵权必究！</p></blockquote><h2 id="前言"><a href="#前言" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>前言</h2><p>在前面的文章中<a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/7155514465591984136" title="使用 NextAuth.js 给 Next.js 应用添加鉴权与认证">《使用 NextAuth.js 给 Next.js 应用添加鉴权与认证》</a>，我们使用了 Github OAuth 和邮箱认证登录，我们的视频网站就有了用户系统，和用户系统离不开的，便是权限系统，今天我们就聊一聊权限系统的设计与实现，要在网站中实现复杂的权限管理对应新手来说，这可能会是比较困难的，但权限系统是软件中不可或缺的部分，我们只要掌握一个套路，就会变得非常简单，一起来看看吧！</p><h2 id="权限区分"><a href="#权限区分" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>权限区分</h2><p>因为有了权限，我们可以在一个系统中实现各种各样的功能，系统也会变得庞大而复杂。一般可以将权限分为“功能权限”、“数据权限”和“字段权限”。</p><p>功能权限：用户具有哪些权利，例如特定数据的增、删、改、查等；比如在一个视频网站中，超级管理员拥有对所有视频的审核权限，而普通用户只能拥有对着自己视频的编辑和删除权限。功能权限需要前后端共同实现；</p><p>数据权限：用户可以看到哪些范围的主数据。比如视频网站中，VIP 用户可以看到 VIP 视频，而非 VIP 用户只能看普通视频。数据权限主要是后端实现；</p><p>字段权限：在特定的数据表中，可以看到哪些字段；比如普通用户能够看到其他用户的基本信息，但是看不到其它人的账户信息。字段权限也主要是由后端实现；</p><h2 id="权限系统设计"><a href="#权限系统设计" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>权限系统设计</h2><p>我们可以将网站中的功能按角色划分，根据不同的角色来指定不同的权限，这便是大部分网站的实现方式。 比如在视频网站中我们可以将角色划分为：</p><p><strong>前台角色</strong></p><ul><li>普通用户</li><li>VIP 用户</li></ul><p>我们可以在数据库中加入 2 个字段区分，User 表加入 <code>isVip</code>， Video 表加入 <code>vip</code>，prisma Schema 定义如下：</p><div class="relative"><pre><code class="code-highlight language-js"><span class="code-line">model <span class="token maybe-class-name">User</span> <span class="token punctuation">{</span>
</span><span class="code-line">  id            <span class="token class-name known-class-name">String</span>    @id @<span class="token keyword module">default</span><span class="token punctuation">(</span><span class="token function">cuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">  name          <span class="token class-name known-class-name">String</span><span class="token operator">?</span>
</span><span class="code-line">  email         <span class="token class-name known-class-name">String</span><span class="token operator">?</span>   @unique
</span><span class="code-line">  isVip         <span class="token class-name known-class-name">Boolean</span>
</span><span class="code-line">  emailVerified <span class="token maybe-class-name">DateTime</span><span class="token operator">?</span>
</span><span class="code-line">  <span class="token maybe-class-name">Video</span>         <span class="token maybe-class-name">Video</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">model <span class="token maybe-class-name">Video</span> <span class="token punctuation">{</span>
</span><span class="code-line">  id    <span class="token maybe-class-name">Int</span>    @id @<span class="token keyword module">default</span><span class="token punctuation">(</span><span class="token function">autoincrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">  title <span class="token class-name known-class-name">String</span> @unique
</span><span class="code-line">  vip        <span class="token class-name known-class-name">Boolean</span>
</span><span class="code-line">  desc       <span class="token class-name known-class-name">String</span><span class="token operator">?</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>那么我们通过接口就可以查出 Vip 视频。</p><div class="relative"><pre><code class="code-highlight language-ts"><span class="code-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> authOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;@/pages/api/auth/[...nextauth]&#x27;</span>
</span><span class="code-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> unstable_getServerSession <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;next-auth/next&#x27;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handler</span><span class="token punctuation">(</span>req<span class="token operator">:</span> NextApiRequest<span class="token punctuation">,</span> res<span class="token operator">:</span> NextApiResponse<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> session <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">unstable_getServerSession</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> authOptions<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>session<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">&#x27;You must be logged in.&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">return</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> prisma<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">findFirst</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">    where<span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">      id<span class="token operator">:</span> session<span class="token punctuation">.</span>id <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">.</span>isVip<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">&#x27;You are not vip user&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">return</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token keyword">const</span> videos <span class="token operator">=</span> <span class="token keyword">await</span> prisma<span class="token punctuation">.</span>video<span class="token punctuation">.</span><span class="token function">findMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">    where<span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">      vip<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>上面代码中，先通过 session 获得用户 id，再查询用户是否为 vip，若为 vip 则查询出 vip 视频，不是则返回 401。</p><p><strong>后台角色</strong></p><ul><li>视频管理员：用于视频审核，对不合法的视频进行下架。</li><li>超级管理员：拥有所有权限，用户管理、视频管理等</li></ul><blockquote><p>备注：由于系统比较简单，我们将前台后台的用户系统使用同一个，只要在数据库中设置一个字段<code>isAdmin</code> ，然后在页面上根据这个字段显示后台管理入口，就可以实现管理视频啦。</p></blockquote><p><img alt="数据表关系图" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/987343ea05ee414888615ed917857b8e~tplv-k3u1fbpfcp-zoom-1.image"/></p><p>一般情况下，我们需要给网站添加 2 张表：一张是角色表（Rule）、一张是权限表（Permission），角色和权限的关系是多对多的关系，一个角色可以有多个权限，一个权限也可以赋给多个角色， 因此需要加入第三章表关联表，在 <a target="_blank" rel="noopener noreferrer" href="https://www.prisma.io/" title="NodeJS ORM">Prisma</a> 中，关联表一般使用 <code>TablesOnTables</code>的形式设计，使用 <code>@relation</code>关联表中的附键，下面代码就是 prisma Schema 代码</p><div class="relative"><pre><code class="code-highlight language-js"><span class="code-line">model <span class="token maybe-class-name">User</span> <span class="token punctuation">{</span>
</span><span class="code-line">  id            <span class="token class-name known-class-name">String</span>    @id @<span class="token keyword module">default</span><span class="token punctuation">(</span><span class="token function">cuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">  name          <span class="token class-name known-class-name">String</span><span class="token operator">?</span>
</span><span class="code-line">  email         <span class="token class-name known-class-name">String</span><span class="token operator">?</span>   @unique
</span><span class="code-line">  roleId        <span class="token class-name known-class-name">String</span><span class="token operator">?</span>
</span><span class="code-line">  role          <span class="token maybe-class-name">Role</span><span class="token operator">?</span>     @<span class="token function">relation</span><span class="token punctuation">(</span>fields<span class="token operator">:</span> <span class="token punctuation">[</span>roleId<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">references</span><span class="token operator">:</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">model <span class="token maybe-class-name">Role</span> <span class="token punctuation">{</span>
</span><span class="code-line">  id                 <span class="token class-name known-class-name">String</span>               @id @<span class="token keyword module">default</span><span class="token punctuation">(</span><span class="token function">cuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">  name               <span class="token class-name known-class-name">String</span>
</span><span class="code-line">  <span class="token maybe-class-name">PermissionsOnRoles</span> <span class="token maybe-class-name">PermissionsOnRoles</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
</span><span class="code-line">  <span class="token maybe-class-name">User</span>               <span class="token maybe-class-name">User</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">model <span class="token maybe-class-name">Permission</span> <span class="token punctuation">{</span>
</span><span class="code-line">  id                 <span class="token class-name known-class-name">String</span>               @id @<span class="token keyword module">default</span><span class="token punctuation">(</span><span class="token function">cuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">  pid                <span class="token class-name known-class-name">String</span><span class="token operator">?</span>
</span><span class="code-line">  name               <span class="token class-name known-class-name">String</span>
</span><span class="code-line">  code               <span class="token class-name known-class-name">String</span>
</span><span class="code-line">  <span class="token maybe-class-name">PermissionsOnRoles</span> <span class="token maybe-class-name">PermissionsOnRoles</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">model <span class="token maybe-class-name">PermissionsOnRoles</span> <span class="token punctuation">{</span>
</span><span class="code-line">  role         <span class="token maybe-class-name">Role</span>       @<span class="token function">relation</span><span class="token punctuation">(</span>fields<span class="token operator">:</span> <span class="token punctuation">[</span>roleId<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">references</span><span class="token operator">:</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span>
</span><span class="code-line">  roleId       <span class="token class-name known-class-name">String</span>
</span><span class="code-line">  permission   <span class="token maybe-class-name">Permission</span> @<span class="token function">relation</span><span class="token punctuation">(</span>fields<span class="token operator">:</span> <span class="token punctuation">[</span>permissionId<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">references</span><span class="token operator">:</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span>
</span><span class="code-line">  permissionId <span class="token class-name known-class-name">String</span>
</span><span class="code-line">  assignedAt   <span class="token maybe-class-name">DateTime</span>   @<span class="token keyword module">default</span><span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">  @@<span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">[</span>roleId<span class="token punctuation">,</span> permissionId<span class="token punctuation">]</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>在 <code>prisma/schema.prisma</code>文件中修改 schema， 修改完 prisma schema 后，执行以下命令，我们便可以往数据库迁移，生成真实的表。</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">npx prisma migrate dev
</span></code></pre></div><p>执行后，会在 <code>prisma/migrations/*/migration.sql</code> 文件下生成 Sql 语句，效果如下。</p><p><img alt="生成的sql语句" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f8c0e3f416a24adea432ab42fe9a38bd~tplv-k3u1fbpfcp-zoom-1.image"/></p><p>系统中，一般权限数据都数据库内置的，因此需要新建一个<code>seed.ts</code>文件，可以方便我们往默认数据库插入数据</p><div class="relative"><pre><code class="code-highlight language-ts"><span class="code-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> PrismaClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;@prisma/client&#x27;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// initialize Prisma Client</span>
</span><span class="code-line"><span class="token keyword">const</span> prisma <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrismaClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">await</span> prisma<span class="token punctuation">.</span>permission<span class="token punctuation">.</span><span class="token function">createMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">    data<span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-line">      <span class="token punctuation">{</span>
</span><span class="code-line">        name<span class="token operator">:</span> <span class="token string">&#x27;用户管理&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">        code<span class="token operator">:</span> <span class="token string">&#x27;user_management&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token punctuation">{</span>
</span><span class="code-line">        name<span class="token operator">:</span> <span class="token string">&#x27;视频管理&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">        code<span class="token operator">:</span> <span class="token string">&#x27;video_management&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">await</span> prisma<span class="token punctuation">.</span>role<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">    data<span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">      name<span class="token operator">:</span> <span class="token string">&#x27;超级管理员&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">      permissions<span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">        create<span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-line">          <span class="token punctuation">{</span>
</span><span class="code-line">            assignedAt<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            permission<span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">              connect<span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">                code<span class="token operator">:</span> <span class="token string">&#x27;video_management&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">              <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">          <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">          <span class="token punctuation">{</span>
</span><span class="code-line">            assignedAt<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            permission<span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">              connect<span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">                code<span class="token operator">:</span> <span class="token string">&#x27;user_management&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">              <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">          <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">await</span> prisma<span class="token punctuation">.</span>role<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">    data<span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">      name<span class="token operator">:</span> <span class="token string">&#x27;视频管理员&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">      permissions<span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">        create<span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-line">          <span class="token punctuation">{</span>
</span><span class="code-line">            assignedAt<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            permission<span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">              connect<span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">                code<span class="token operator">:</span> <span class="token string">&#x27;video_management&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">              <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">          <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
</span><span class="code-line">    process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment">// close Prisma Client at the end</span>
</span><span class="code-line">    <span class="token keyword">await</span> prisma<span class="token punctuation">.</span><span class="token function">$disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></code></pre></div><p>执行<code>npx ts-node prisma/seed.ts</code>，就可以初始化角色和权限数据了，上述代码中我们设置了 2 个角色，分别为超级管理员和视频管理员，添加了 2 个权限分别为视频管理和用户管理并且设置了唯一键 code，code 可以拥有前端权限的判断。</p><h2 id="后端接口设计"><a href="#后端接口设计" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>后端接口设计</h2><p>有了数据库和数据我们便可以实现一个接口，“用户信息接口”，我们将它定义为<code>/api/user/me</code>，用于返回权限信息</p><p>新建一个<code>pages/api/me.ts</code> 文件, 代码如下</p><div class="relative"><pre><code class="code-highlight language-ts"><span class="code-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> authOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;@/pages/api/auth/[...nextauth]&#x27;</span>
</span><span class="code-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> unstable_getServerSession <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;next-auth/next&#x27;</span>
</span><span class="code-line"><span class="token keyword">import</span> prisma <span class="token keyword">from</span> <span class="token string">&#x27;@/lib/prisma&#x27;</span>
</span><span class="code-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> makeSerializable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;@/lib/util&#x27;</span>
</span><span class="code-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> NextApiRequest<span class="token punctuation">,</span> NextApiResponse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;next&#x27;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handler</span><span class="token punctuation">(</span>req<span class="token operator">:</span> NextApiRequest<span class="token punctuation">,</span> res<span class="token operator">:</span> NextApiResponse<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> session <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">unstable_getServerSession</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> authOptions<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>session<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">&#x27;You must be logged in.&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">return</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> prisma<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">findFirst</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">    where<span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">      id<span class="token operator">:</span> session<span class="token punctuation">.</span>id <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> permissionsOnRoles <span class="token operator">=</span> <span class="token keyword">await</span> prisma<span class="token punctuation">.</span>permissionsOnRoles<span class="token punctuation">.</span><span class="token function">findMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">    where<span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">      roleId<span class="token operator">:</span> user<span class="token punctuation">.</span>roleId<span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token keyword">const</span> ids <span class="token operator">=</span> permissionsOnRoles<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>permissionId<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> permissions <span class="token operator">=</span> <span class="token keyword">await</span> prisma<span class="token punctuation">.</span>permission<span class="token punctuation">.</span><span class="token function">findMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">    where<span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">      id<span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">in</span><span class="token operator">:</span> ids<span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">    user<span class="token punctuation">,</span>
</span><span class="code-line">    permissions<span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>上面的代码中，查询步骤为：</p><ul><li>先通过 session 获得用户 id</li><li>通过用户 id 查询用户信息，获得角色 id</li><li>通过角色 id 查询关联表，获得权限 id</li><li>再通过权限 id 查询权限信息。</li></ul><p>以上代码便是多对多查询过程，访问接口，就可以获得当前用户的权限信息了。</p><p><img alt="权限接口查询" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1a8504e2079f45cbb9369c6296283234~tplv-k3u1fbpfcp-zoom-1.image"/></p><p>那么前端就可以通过该接口来判断功能权限了，至此后端权限部分就完成了。</p><h2 id="react-中实现权限管理"><a href="#react-中实现权限管理" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>React 中实现权限管理</h2><p>在 React 中实现状态管理，我们可以在整个 App 组件（跟组件）渲染前选请求<code>me</code>接口，然后通过 <code>React Context</code> 将 permission 信息进行全局状态管理，这样我们就可以在任意组件获取权限信息，进行权限判断了。</p><div class="relative"><pre><code class="code-highlight language-tsx"><span class="code-line"><span class="token keyword">import</span> <span class="token imports"><span class="token maybe-class-name">React</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> useContext<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword">from</span> <span class="token string">&#x27;react&#x27;</span>
</span><span class="code-line"><span class="token keyword">import</span> <span class="token imports">axios</span> <span class="token keyword">from</span> <span class="token string">&#x27;axios&#x27;</span>
</span><span class="code-line"><span class="token keyword">import</span> <span class="token imports"><span class="token punctuation">{</span> createBrowserRouter<span class="token punctuation">,</span> <span class="token maybe-class-name">RouterProvider</span><span class="token punctuation">,</span> <span class="token maybe-class-name">Route</span><span class="token punctuation">,</span> <span class="token maybe-class-name">Outlet</span> <span class="token punctuation">}</span></span> <span class="token keyword">from</span> <span class="token string">&#x27;react-router-dom&#x27;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">const</span> <span class="token maybe-class-name">PermissionContext</span> <span class="token operator">=</span> <span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token function property-access method">createContext</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">const</span> <span class="token function function-variable">usePermission</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">return</span> <span class="token function">useContext</span><span class="token punctuation">(</span><span class="token maybe-class-name">PermissionContext</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">function</span> <span class="token function">Permission</span><span class="token punctuation">(</span><span class="token punctuation">{</span> code<span class="token punctuation">,</span> children <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> permissions <span class="token operator">=</span> <span class="token function">usePermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>permissions<span class="token punctuation">.</span><span class="token function property-access method">includes</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">return</span> children
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token keyword">return</span> <span class="token keyword">null</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token punctuation">[</span>permissions<span class="token punctuation">,</span> setPermissions<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token function property-access method">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator arrow">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    axios<span class="token punctuation">.</span><span class="token function property-access method">get</span><span class="token punctuation">(</span><span class="token string">&#x27;/api/user/me&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function property-access method">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator arrow">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token keyword">const</span> permissions <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token function property-access method">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator arrow">=&gt;</span> item<span class="token punctuation">.</span><span class="token property-access">code</span><span class="token punctuation">)</span>
</span><span class="code-line">      <span class="token function">setPermissions</span><span class="token punctuation">(</span>permissions<span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">return</span> <span class="token punctuation">(</span>
</span><span class="code-line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">PermissionContext.Provider</span></span> <span class="token attr-name">value</span><span class="token language-javascript script"><span class="token punctuation script-punctuation">=</span><span class="token punctuation">{</span>permissions<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">RouterProvider</span></span> <span class="token attr-name">router</span><span class="token language-javascript script"><span class="token punctuation script-punctuation">=</span><span class="token punctuation">{</span>router<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">PermissionContext.Provider</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>上面代码中，我们创建了一个我们定义了一个<code>Permission</code>组件，那么在项目中，只要在要判断权限的地方使用该组件，若没有权限，则会不显示。我们还定义了一个<code>usePermission</code> 自定义 hooks，这样在后续开发中，若要使用到权限，我们就可以直接使用这个 Hooks，界面 UI 也可以重新定义了。</p><p>比如在 React-router 路由（V6）中，直接嵌套一个<code>Permission</code> 组件便可以实现权限控制了。</p><div class="relative"><pre><code class="code-highlight language-jsx"><span class="code-line"><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">createBrowserRouter</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
</span><span class="code-line">  <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#x27;/&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">首页</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#x27;/login&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">登录</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#x27;/admin&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token punctuation">(</span>
</span><span class="code-line">      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">        后台管理 </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Outlet</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">    <span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-line">      <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#x27;user&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token punctuation">(</span>
</span><span class="code-line">          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Permission</span></span> <span class="token attr-name">code</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user_management<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">用户管理</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Permission</span></span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">        <span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#x27;video&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token punctuation">(</span>
</span><span class="code-line">          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Permission</span></span> <span class="token attr-name">code</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user_management<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">视频管理</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Permission</span></span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">        <span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">]</span><span class="token punctuation">)</span>
</span></code></pre></div><h2 id="nextjs-实现权限管理"><a href="#nextjs-实现权限管理" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Next.js 实现权限管理</h2><p>在 Next.js 中，我们可以同 React 一样的方式来实现权限控制。若是服务端渲染的页面，我们也可以在服务端控制。</p><div class="relative"><pre><code class="code-highlight language-js"><span class="code-line"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> authOptions <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">&#x27;@/pages/api/auth/[...nextauth]&#x27;</span>
</span><span class="code-line"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> unstable_getServerSession <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">&#x27;next-auth/next&#x27;</span>
</span><span class="code-line"><span class="token keyword module">import</span> <span class="token imports">prisma</span> <span class="token keyword module">from</span> <span class="token string">&#x27;@/lib/prisma&#x27;</span>
</span><span class="code-line"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> makeSerializable <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">&#x27;@/lib/util&#x27;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getServerSideProps</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> session <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">unstable_getServerSession</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token property-access">req</span><span class="token punctuation">,</span> context<span class="token punctuation">.</span><span class="token property-access">res</span><span class="token punctuation">,</span> authOptions<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>session<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token literal-property property">redirect</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token literal-property property">destination</span><span class="token operator">:</span> <span class="token string">&#x27;/403&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token literal-property property">permanent</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token comment">//const permissions =  prisma query</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>permissions<span class="token punctuation">.</span><span class="token function property-access method">includes</span><span class="token punctuation">(</span><span class="token string">&#x27;video_management&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token literal-property property">errorCode</span><span class="token operator">:</span> <span class="token number">403</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword control-flow">await</span> prisma<span class="token punctuation">.</span><span class="token property-access">video</span><span class="token punctuation">.</span><span class="token function property-access method">findMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token literal-property property">include</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">author</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">      session<span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token function">makeSerializable</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>同接口的方式一致，我们也可以在 <code>getServerSideProps</code> 通过获得 <code>session</code>，然后获得用户权限，再通过权限判断，是否让页面显示 403。</p><p>那如果有多个页面有需要权限判断，该怎么办呢？我们可以在根目录下建立一个<code>middleware.js</code>, 中间件会在每个请求的时候执行。</p><div class="relative"><pre><code class="code-highlight language-js"><span class="code-line"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> getToken <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">&quot;next-auth/jwt&quot;</span>
</span><span class="code-line"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">NextResponse</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">&quot;next/server&quot;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">middleware</span><span class="token punctuation">(</span><span class="token parameter">req</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token comment">// 如果url不应该受到保护，请尽早返回</span>
</span><span class="code-line">  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>req<span class="token punctuation">.</span><span class="token property-access">url</span><span class="token punctuation">.</span><span class="token function property-access method">includes</span><span class="token punctuation">(</span><span class="token string">&quot;/protected-url&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword control-flow">return</span> <span class="token maybe-class-name">NextResponse</span><span class="token punctuation">.</span><span class="token function property-access method">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> session <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">{</span> req<span class="token punctuation">,</span> <span class="token literal-property property">secret</span><span class="token operator">:</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">SECRET</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>session<span class="token punctuation">)</span> <span class="token keyword control-flow">return</span> <span class="token maybe-class-name">NextResponse</span><span class="token punctuation">.</span><span class="token function property-access method">redirect</span><span class="token punctuation">(</span><span class="token string">&quot;/api/auth/signin&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token operator spread">...</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token comment">// 如果授权通过则继续。</span>
</span><span class="code-line">  <span class="token keyword control-flow">return</span> <span class="token maybe-class-name">NextResponse</span><span class="token punctuation">.</span><span class="token function property-access method">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>在中间件中，我们也可以获得<code>session</code>，那么与 api 接口一样，就可以在中间件中判断权限信息了，有一点需要注意的是，Url 不需要权限判断，我们应该尽早返回，这样可以避免多余的查询。</p><h2 id="小结"><a href="#小结" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>小结</h2><p>本文以视频网站为例，讲解了权限系统的设计与实现，主要涉及到的知识点有：</p><ul><li>后端基于角色表和权限表，多对多表结构设计</li><li>Prisma 中实现多对多关系查询</li><li>前端使用 React Context 和 自定义 hooks 实现全局状态管理</li><li>利用 Next.js 的 <a target="_blank" rel="noopener noreferrer" href="https://gist.github.com/balazsorban44/30e2267fe1105529f217acbe3763b468" title="NextAuth.js Auth Middleware for Next.js 12">middleware</a> 也可以获得 session，并且用于权限判断。</li></ul><p>好了，以上就是本文的全部内容，你学会了吗？接下来我将继续分享 Next.js 相关的实战文章，欢迎各位关注我的《Next.js 全栈开发实战》 专栏，感谢您的阅读。</p></div><div class="border-t border-gray-200 pt-6 pb-6 text-sm text-gray-700 dark:border-gray-700 dark:text-gray-300"><div class="mb-3"><img alt="runjs-cool" width="384" height="140" src="/static/images/runjs-cool.webp"/></div><span>关注微信公众号，获取最新原创文章（首发）</span><a target="_blank" rel="noopener noreferrer" href="https://github.com/balac2015/blob/main/data/blog/Next.js 应用实现权限管理.md">View on GitHub</a></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">标签</h2><div class="mt-3 flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/reactjs">React.js</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">上一篇 文章</h2><div class="mt-3 text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/%E7%90%86%E8%A7%A3%20Next.js%20%E4%B8%AD%E7%9A%84%20CSR%E3%80%81SSR%E3%80%81SSG%E3%80%81ISR%20%E4%BB%A5%E5%8F%8A%20Streaming">理解 Next.js 中的 CSR、SSR、SSG、ISR 以及 Streaming</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">下一篇 文章</h2><div class="mt-3 text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/%E4%BD%BF%E7%94%A8%20Next.js%20%E6%90%AD%E5%BB%BA%20Monorepo%20%E7%BB%84%E4%BB%B6%E5%BA%93%E6%96%87%E6%A1%A3">使用 Next.js 搭建 Monorepo 组件库文档</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">← 返回文章列表</a></div></footer></div></div></article></div></main></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var d=Object.create;var t=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var N=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var i=a=\u003et(a,\"__esModule\",{value:!0});var k=(a,s)=\u003e()=\u003e(s||a((s={exports:{}}).exports,s),s.exports),y=(a,s)=\u003e{for(var c in s)t(a,c,{get:s[c],enumerable:!0})},o=(a,s,c,e)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let l of h(s))!u.call(a,l)\u0026\u0026(c||l!==\"default\")\u0026\u0026t(a,l,{get:()=\u003es[l],enumerable:!(e=m(s,l))||e.enumerable});return a},g=(a,s)=\u003eo(i(t(a!=null?d(N(a)):{},\"default\",!s\u0026\u0026a\u0026\u0026a.__esModule?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a),w=(a=\u003e(s,c)=\u003ea\u0026\u0026a.get(s)||(c=o(i({}),s,1),a\u0026\u0026a.set(s,c),c))(typeof WeakMap!=\"undefined\"?new WeakMap:0);var r=k((S,p)=\u003e{p.exports=_jsx_runtime});var v={};y(v,{default:()=\u003eb,frontmatter:()=\u003ef});var n=g(r()),f={title:\"Next.js \\u5E94\\u7528\\u5B9E\\u73B0\\u6743\\u9650\\u7BA1\\u7406\",date:\"2022/11/14 22:48:39\",lastmod:\"2023/1/25 11:42:28\",tags:[\"React.js\"],draft:!1,summary:\"\\u4ECA\\u5929\\u6211\\u4EEC\\u5C31\\u804A\\u4E00\\u804A\\u6743\\u9650\\u7CFB\\u7EDF\\u7684\\u8BBE\\u8BA1\\u4E0E\\u5B9E\\u73B0\\uFF0C\\u8981\\u5728\\u7F51\\u7AD9\\u4E2D\\u5B9E\\u73B0\\u590D\\u6742\\u7684\\u6743\\u9650\\u7BA1\\u7406\\u5BF9\\u5E94\\u65B0\\u624B\\u6765\\u8BF4\\uFF0C\\u8FD9\\u53EF\\u80FD\\u4F1A\\u662F\\u6BD4\\u8F83\\u56F0\\u96BE\\u7684\\uFF0C\\u4F46\\u6743\\u9650\\u7CFB\\u7EDF\\u662F\\u8F6F\\u4EF6\\u4E2D\\u4E0D\\u53EF\\u6216\\u7F3A\\u7684\\u90E8\\u5206\\uFF0C\\u6211\\u4EEC\\u53EA\\u8981\\u638C\\u63E1\\u4E00\\u4E2A\\u5957\\u8DEF\\uFF0C\\u5C31\\u4F1A\\u53D8\\u5F97\\u975E\\u5E38\\u7B80\\u5355\\uFF0C\\u4E00\\u8D77\\u6765\\u770B\\u770B\\u5427\\uFF01\",images:\"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1e6342307e9244edb7650de27adf8eda~tplv-k3u1fbpfcp-watermark.image?\",authors:[\"default\"],layout:\"PostLayout\"};function x(a={}){let{wrapper:s}=a.components||{};return s?(0,n.jsx)(s,Object.assign({},a,{children:(0,n.jsx)(c,{})})):c();function c(){let e=Object.assign({blockquote:\"blockquote\",p:\"p\",h2:\"h2\",a:\"a\",span:\"span\",strong:\"strong\",ul:\"ul\",li:\"li\",code:\"code\",pre:\"pre\",img:\"img\"},a.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.blockquote,{children:(0,n.jsx)(e.p,{children:\"\\u6587\\u7AE0\\u4E3A\\u7A00\\u571F\\u6398\\u91D1\\u6280\\u672F\\u793E\\u533A\\u9996\\u53D1\\u7B7E\\u7EA6\\u6587\\u7AE0\\uFF0C14 \\u5929\\u5185\\u7981\\u6B62\\u8F6C\\u8F7D\\uFF0C14 \\u5929\\u540E\\u672A\\u83B7\\u6388\\u6743\\u7981\\u6B62\\u8F6C\\u8F7D\\uFF0C\\u4FB5\\u6743\\u5FC5\\u7A76\\uFF01\"})}),(0,n.jsxs)(e.h2,{id:\"\\u524D\\u8A00\",children:[(0,n.jsx)(e.a,{href:\"#\\u524D\\u8A00\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\u524D\\u8A00\"]}),(0,n.jsxs)(e.p,{children:[\"\\u5728\\u524D\\u9762\\u7684\\u6587\\u7AE0\\u4E2D\",(0,n.jsx)(e.a,{href:\"https://juejin.cn/post/7155514465591984136\",title:\"\\u4F7F\\u7528 NextAuth.js \\u7ED9 Next.js \\u5E94\\u7528\\u6DFB\\u52A0\\u9274\\u6743\\u4E0E\\u8BA4\\u8BC1\",children:\"\\u300A\\u4F7F\\u7528 NextAuth.js \\u7ED9 Next.js \\u5E94\\u7528\\u6DFB\\u52A0\\u9274\\u6743\\u4E0E\\u8BA4\\u8BC1\\u300B\"}),\"\\uFF0C\\u6211\\u4EEC\\u4F7F\\u7528\\u4E86 Github OAuth \\u548C\\u90AE\\u7BB1\\u8BA4\\u8BC1\\u767B\\u5F55\\uFF0C\\u6211\\u4EEC\\u7684\\u89C6\\u9891\\u7F51\\u7AD9\\u5C31\\u6709\\u4E86\\u7528\\u6237\\u7CFB\\u7EDF\\uFF0C\\u548C\\u7528\\u6237\\u7CFB\\u7EDF\\u79BB\\u4E0D\\u5F00\\u7684\\uFF0C\\u4FBF\\u662F\\u6743\\u9650\\u7CFB\\u7EDF\\uFF0C\\u4ECA\\u5929\\u6211\\u4EEC\\u5C31\\u804A\\u4E00\\u804A\\u6743\\u9650\\u7CFB\\u7EDF\\u7684\\u8BBE\\u8BA1\\u4E0E\\u5B9E\\u73B0\\uFF0C\\u8981\\u5728\\u7F51\\u7AD9\\u4E2D\\u5B9E\\u73B0\\u590D\\u6742\\u7684\\u6743\\u9650\\u7BA1\\u7406\\u5BF9\\u5E94\\u65B0\\u624B\\u6765\\u8BF4\\uFF0C\\u8FD9\\u53EF\\u80FD\\u4F1A\\u662F\\u6BD4\\u8F83\\u56F0\\u96BE\\u7684\\uFF0C\\u4F46\\u6743\\u9650\\u7CFB\\u7EDF\\u662F\\u8F6F\\u4EF6\\u4E2D\\u4E0D\\u53EF\\u6216\\u7F3A\\u7684\\u90E8\\u5206\\uFF0C\\u6211\\u4EEC\\u53EA\\u8981\\u638C\\u63E1\\u4E00\\u4E2A\\u5957\\u8DEF\\uFF0C\\u5C31\\u4F1A\\u53D8\\u5F97\\u975E\\u5E38\\u7B80\\u5355\\uFF0C\\u4E00\\u8D77\\u6765\\u770B\\u770B\\u5427\\uFF01\"]}),(0,n.jsxs)(e.h2,{id:\"\\u6743\\u9650\\u533A\\u5206\",children:[(0,n.jsx)(e.a,{href:\"#\\u6743\\u9650\\u533A\\u5206\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\u6743\\u9650\\u533A\\u5206\"]}),(0,n.jsx)(e.p,{children:\"\\u56E0\\u4E3A\\u6709\\u4E86\\u6743\\u9650\\uFF0C\\u6211\\u4EEC\\u53EF\\u4EE5\\u5728\\u4E00\\u4E2A\\u7CFB\\u7EDF\\u4E2D\\u5B9E\\u73B0\\u5404\\u79CD\\u5404\\u6837\\u7684\\u529F\\u80FD\\uFF0C\\u7CFB\\u7EDF\\u4E5F\\u4F1A\\u53D8\\u5F97\\u5E9E\\u5927\\u800C\\u590D\\u6742\\u3002\\u4E00\\u822C\\u53EF\\u4EE5\\u5C06\\u6743\\u9650\\u5206\\u4E3A\\u201C\\u529F\\u80FD\\u6743\\u9650\\u201D\\u3001\\u201C\\u6570\\u636E\\u6743\\u9650\\u201D\\u548C\\u201C\\u5B57\\u6BB5\\u6743\\u9650\\u201D\\u3002\"}),(0,n.jsx)(e.p,{children:\"\\u529F\\u80FD\\u6743\\u9650\\uFF1A\\u7528\\u6237\\u5177\\u6709\\u54EA\\u4E9B\\u6743\\u5229\\uFF0C\\u4F8B\\u5982\\u7279\\u5B9A\\u6570\\u636E\\u7684\\u589E\\u3001\\u5220\\u3001\\u6539\\u3001\\u67E5\\u7B49\\uFF1B\\u6BD4\\u5982\\u5728\\u4E00\\u4E2A\\u89C6\\u9891\\u7F51\\u7AD9\\u4E2D\\uFF0C\\u8D85\\u7EA7\\u7BA1\\u7406\\u5458\\u62E5\\u6709\\u5BF9\\u6240\\u6709\\u89C6\\u9891\\u7684\\u5BA1\\u6838\\u6743\\u9650\\uFF0C\\u800C\\u666E\\u901A\\u7528\\u6237\\u53EA\\u80FD\\u62E5\\u6709\\u5BF9\\u7740\\u81EA\\u5DF1\\u89C6\\u9891\\u7684\\u7F16\\u8F91\\u548C\\u5220\\u9664\\u6743\\u9650\\u3002\\u529F\\u80FD\\u6743\\u9650\\u9700\\u8981\\u524D\\u540E\\u7AEF\\u5171\\u540C\\u5B9E\\u73B0\\uFF1B\"}),(0,n.jsx)(e.p,{children:\"\\u6570\\u636E\\u6743\\u9650\\uFF1A\\u7528\\u6237\\u53EF\\u4EE5\\u770B\\u5230\\u54EA\\u4E9B\\u8303\\u56F4\\u7684\\u4E3B\\u6570\\u636E\\u3002\\u6BD4\\u5982\\u89C6\\u9891\\u7F51\\u7AD9\\u4E2D\\uFF0CVIP \\u7528\\u6237\\u53EF\\u4EE5\\u770B\\u5230 VIP \\u89C6\\u9891\\uFF0C\\u800C\\u975E VIP \\u7528\\u6237\\u53EA\\u80FD\\u770B\\u666E\\u901A\\u89C6\\u9891\\u3002\\u6570\\u636E\\u6743\\u9650\\u4E3B\\u8981\\u662F\\u540E\\u7AEF\\u5B9E\\u73B0\\uFF1B\"}),(0,n.jsx)(e.p,{children:\"\\u5B57\\u6BB5\\u6743\\u9650\\uFF1A\\u5728\\u7279\\u5B9A\\u7684\\u6570\\u636E\\u8868\\u4E2D\\uFF0C\\u53EF\\u4EE5\\u770B\\u5230\\u54EA\\u4E9B\\u5B57\\u6BB5\\uFF1B\\u6BD4\\u5982\\u666E\\u901A\\u7528\\u6237\\u80FD\\u591F\\u770B\\u5230\\u5176\\u4ED6\\u7528\\u6237\\u7684\\u57FA\\u672C\\u4FE1\\u606F\\uFF0C\\u4F46\\u662F\\u770B\\u4E0D\\u5230\\u5176\\u5B83\\u4EBA\\u7684\\u8D26\\u6237\\u4FE1\\u606F\\u3002\\u5B57\\u6BB5\\u6743\\u9650\\u4E5F\\u4E3B\\u8981\\u662F\\u7531\\u540E\\u7AEF\\u5B9E\\u73B0\\uFF1B\"}),(0,n.jsxs)(e.h2,{id:\"\\u6743\\u9650\\u7CFB\\u7EDF\\u8BBE\\u8BA1\",children:[(0,n.jsx)(e.a,{href:\"#\\u6743\\u9650\\u7CFB\\u7EDF\\u8BBE\\u8BA1\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\u6743\\u9650\\u7CFB\\u7EDF\\u8BBE\\u8BA1\"]}),(0,n.jsx)(e.p,{children:\"\\u6211\\u4EEC\\u53EF\\u4EE5\\u5C06\\u7F51\\u7AD9\\u4E2D\\u7684\\u529F\\u80FD\\u6309\\u89D2\\u8272\\u5212\\u5206\\uFF0C\\u6839\\u636E\\u4E0D\\u540C\\u7684\\u89D2\\u8272\\u6765\\u6307\\u5B9A\\u4E0D\\u540C\\u7684\\u6743\\u9650\\uFF0C\\u8FD9\\u4FBF\\u662F\\u5927\\u90E8\\u5206\\u7F51\\u7AD9\\u7684\\u5B9E\\u73B0\\u65B9\\u5F0F\\u3002 \\u6BD4\\u5982\\u5728\\u89C6\\u9891\\u7F51\\u7AD9\\u4E2D\\u6211\\u4EEC\\u53EF\\u4EE5\\u5C06\\u89D2\\u8272\\u5212\\u5206\\u4E3A\\uFF1A\"}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.strong,{children:\"\\u524D\\u53F0\\u89D2\\u8272\"})}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:\"\\u666E\\u901A\\u7528\\u6237\"}),(0,n.jsx)(e.li,{children:\"VIP \\u7528\\u6237\"})]}),(0,n.jsxs)(e.p,{children:[\"\\u6211\\u4EEC\\u53EF\\u4EE5\\u5728\\u6570\\u636E\\u5E93\\u4E2D\\u52A0\\u5165 2 \\u4E2A\\u5B57\\u6BB5\\u533A\\u5206\\uFF0CUser \\u8868\\u52A0\\u5165 \",(0,n.jsx)(e.code,{children:\"isVip\"}),\"\\uFF0C Video \\u8868\\u52A0\\u5165 \",(0,n.jsx)(e.code,{children:\"vip\"}),\"\\uFF0Cprisma Schema \\u5B9A\\u4E49\\u5982\\u4E0B\\uFF1A\"]}),(0,n.jsx)(e.pre,{className:\"language-js\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-js\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"model \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"User\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  id            \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"String\"}),\"    @id @\",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"default\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"cuid\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  name          \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  email         \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),`   @unique\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  isVip         \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"Boolean\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  emailVerified \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"DateTime\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"Video\"}),\"         \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"Video\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"model \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"Video\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  id    \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"Int\"}),\"    @id @\",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"default\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"autoincrement\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  title \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"String\"}),` @unique\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  vip        \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"Boolean\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  desc       \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"\\u90A3\\u4E48\\u6211\\u4EEC\\u901A\\u8FC7\\u63A5\\u53E3\\u5C31\\u53EF\\u4EE5\\u67E5\\u51FA Vip \\u89C6\\u9891\\u3002\"}),(0,n.jsx)(e.pre,{className:\"language-ts\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-ts\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" authOptions \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'@/pages/api/auth/[...nextauth]'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" unstable_getServerSession \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'next-auth/next'\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"export\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"default\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"handler\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"req\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" NextApiRequest\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" res\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" NextApiResponse\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" session \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"await\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"unstable_getServerSession\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" authOptions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"!\"}),\"session\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"status\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"401\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"json\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" message\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'You must be logged in.'\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" user \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"await\"}),\" prisma\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"user\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"findFirst\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    where\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      id\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" session\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"id \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"!\"}),\"user\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"isVip\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"status\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"401\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"json\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" message\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'You are not vip user'\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" videos \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"await\"}),\" prisma\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"video\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"findMany\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    where\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      vip\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"true\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"\\u4E0A\\u9762\\u4EE3\\u7801\\u4E2D\\uFF0C\\u5148\\u901A\\u8FC7 session \\u83B7\\u5F97\\u7528\\u6237 id\\uFF0C\\u518D\\u67E5\\u8BE2\\u7528\\u6237\\u662F\\u5426\\u4E3A vip\\uFF0C\\u82E5\\u4E3A vip \\u5219\\u67E5\\u8BE2\\u51FA vip \\u89C6\\u9891\\uFF0C\\u4E0D\\u662F\\u5219\\u8FD4\\u56DE 401\\u3002\"}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.strong,{children:\"\\u540E\\u53F0\\u89D2\\u8272\"})}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:\"\\u89C6\\u9891\\u7BA1\\u7406\\u5458\\uFF1A\\u7528\\u4E8E\\u89C6\\u9891\\u5BA1\\u6838\\uFF0C\\u5BF9\\u4E0D\\u5408\\u6CD5\\u7684\\u89C6\\u9891\\u8FDB\\u884C\\u4E0B\\u67B6\\u3002\"}),(0,n.jsx)(e.li,{children:\"\\u8D85\\u7EA7\\u7BA1\\u7406\\u5458\\uFF1A\\u62E5\\u6709\\u6240\\u6709\\u6743\\u9650\\uFF0C\\u7528\\u6237\\u7BA1\\u7406\\u3001\\u89C6\\u9891\\u7BA1\\u7406\\u7B49\"})]}),(0,n.jsx)(e.blockquote,{children:(0,n.jsxs)(e.p,{children:[\"\\u5907\\u6CE8\\uFF1A\\u7531\\u4E8E\\u7CFB\\u7EDF\\u6BD4\\u8F83\\u7B80\\u5355\\uFF0C\\u6211\\u4EEC\\u5C06\\u524D\\u53F0\\u540E\\u53F0\\u7684\\u7528\\u6237\\u7CFB\\u7EDF\\u4F7F\\u7528\\u540C\\u4E00\\u4E2A\\uFF0C\\u53EA\\u8981\\u5728\\u6570\\u636E\\u5E93\\u4E2D\\u8BBE\\u7F6E\\u4E00\\u4E2A\\u5B57\\u6BB5\",(0,n.jsx)(e.code,{children:\"isAdmin\"}),\" \\uFF0C\\u7136\\u540E\\u5728\\u9875\\u9762\\u4E0A\\u6839\\u636E\\u8FD9\\u4E2A\\u5B57\\u6BB5\\u663E\\u793A\\u540E\\u53F0\\u7BA1\\u7406\\u5165\\u53E3\\uFF0C\\u5C31\\u53EF\\u4EE5\\u5B9E\\u73B0\\u7BA1\\u7406\\u89C6\\u9891\\u5566\\u3002\"]})}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:\"\\u6570\\u636E\\u8868\\u5173\\u7CFB\\u56FE\",src:\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/987343ea05ee414888615ed917857b8e~tplv-k3u1fbpfcp-zoom-1.image\"})}),(0,n.jsxs)(e.p,{children:[\"\\u4E00\\u822C\\u60C5\\u51B5\\u4E0B\\uFF0C\\u6211\\u4EEC\\u9700\\u8981\\u7ED9\\u7F51\\u7AD9\\u6DFB\\u52A0 2 \\u5F20\\u8868\\uFF1A\\u4E00\\u5F20\\u662F\\u89D2\\u8272\\u8868\\uFF08Rule\\uFF09\\u3001\\u4E00\\u5F20\\u662F\\u6743\\u9650\\u8868\\uFF08Permission\\uFF09\\uFF0C\\u89D2\\u8272\\u548C\\u6743\\u9650\\u7684\\u5173\\u7CFB\\u662F\\u591A\\u5BF9\\u591A\\u7684\\u5173\\u7CFB\\uFF0C\\u4E00\\u4E2A\\u89D2\\u8272\\u53EF\\u4EE5\\u6709\\u591A\\u4E2A\\u6743\\u9650\\uFF0C\\u4E00\\u4E2A\\u6743\\u9650\\u4E5F\\u53EF\\u4EE5\\u8D4B\\u7ED9\\u591A\\u4E2A\\u89D2\\u8272\\uFF0C \\u56E0\\u6B64\\u9700\\u8981\\u52A0\\u5165\\u7B2C\\u4E09\\u7AE0\\u8868\\u5173\\u8054\\u8868\\uFF0C\\u5728 \",(0,n.jsx)(e.a,{href:\"https://www.prisma.io/\",title:\"NodeJS ORM\",children:\"Prisma\"}),\" \\u4E2D\\uFF0C\\u5173\\u8054\\u8868\\u4E00\\u822C\\u4F7F\\u7528 \",(0,n.jsx)(e.code,{children:\"TablesOnTables\"}),\"\\u7684\\u5F62\\u5F0F\\u8BBE\\u8BA1\\uFF0C\\u4F7F\\u7528 \",(0,n.jsx)(e.code,{children:\"@relation\"}),\"\\u5173\\u8054\\u8868\\u4E2D\\u7684\\u9644\\u952E\\uFF0C\\u4E0B\\u9762\\u4EE3\\u7801\\u5C31\\u662F prisma Schema \\u4EE3\\u7801\"]}),(0,n.jsx)(e.pre,{className:\"language-js\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-js\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"model \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"User\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  id            \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"String\"}),\"    @id @\",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"default\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"cuid\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  name          \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  email         \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),`   @unique\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  roleId        \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  role          \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"Role\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),\"     @\",(0,n.jsx)(e.span,{className:\"token function\",children:\"relation\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"fields\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"roleId\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"references\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"id\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"model \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"Role\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  id                 \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"String\"}),\"               @id @\",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"default\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"cuid\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  name               \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"String\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"PermissionsOnRoles\"}),\" \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"PermissionsOnRoles\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"User\"}),\"               \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"User\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"model \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"Permission\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  id                 \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"String\"}),\"               @id @\",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"default\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"cuid\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  pid                \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  name               \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"String\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  code               \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"String\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"PermissionsOnRoles\"}),\" \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"PermissionsOnRoles\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"model \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"PermissionsOnRoles\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  role         \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"Role\"}),\"       @\",(0,n.jsx)(e.span,{className:\"token function\",children:\"relation\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"fields\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"roleId\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"references\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"id\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  roleId       \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"String\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  permission   \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"Permission\"}),\" @\",(0,n.jsx)(e.span,{className:\"token function\",children:\"relation\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"fields\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"permissionId\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"references\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"id\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  permissionId \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"String\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  assignedAt   \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"DateTime\"}),\"   @\",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"default\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"now\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  @@\",(0,n.jsx)(e.span,{className:\"token function\",children:\"id\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"roleId\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" permissionId\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"\\u5728 \",(0,n.jsx)(e.code,{children:\"prisma/schema.prisma\"}),\"\\u6587\\u4EF6\\u4E2D\\u4FEE\\u6539 schema\\uFF0C \\u4FEE\\u6539\\u5B8C prisma schema \\u540E\\uFF0C\\u6267\\u884C\\u4EE5\\u4E0B\\u547D\\u4EE4\\uFF0C\\u6211\\u4EEC\\u4FBF\\u53EF\\u4EE5\\u5F80\\u6570\\u636E\\u5E93\\u8FC1\\u79FB\\uFF0C\\u751F\\u6210\\u771F\\u5B9E\\u7684\\u8868\\u3002\"]}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"code-highlight language-bash\",children:(0,n.jsx)(e.span,{className:\"code-line\",children:`npx prisma migrate dev\n`})})}),(0,n.jsxs)(e.p,{children:[\"\\u6267\\u884C\\u540E\\uFF0C\\u4F1A\\u5728 \",(0,n.jsx)(e.code,{children:\"prisma/migrations/*/migration.sql\"}),\" \\u6587\\u4EF6\\u4E0B\\u751F\\u6210 Sql \\u8BED\\u53E5\\uFF0C\\u6548\\u679C\\u5982\\u4E0B\\u3002\"]}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:\"\\u751F\\u6210\\u7684sql\\u8BED\\u53E5\",src:\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f8c0e3f416a24adea432ab42fe9a38bd~tplv-k3u1fbpfcp-zoom-1.image\"})}),(0,n.jsxs)(e.p,{children:[\"\\u7CFB\\u7EDF\\u4E2D\\uFF0C\\u4E00\\u822C\\u6743\\u9650\\u6570\\u636E\\u90FD\\u6570\\u636E\\u5E93\\u5185\\u7F6E\\u7684\\uFF0C\\u56E0\\u6B64\\u9700\\u8981\\u65B0\\u5EFA\\u4E00\\u4E2A\",(0,n.jsx)(e.code,{children:\"seed.ts\"}),\"\\u6587\\u4EF6\\uFF0C\\u53EF\\u4EE5\\u65B9\\u4FBF\\u6211\\u4EEC\\u5F80\\u9ED8\\u8BA4\\u6570\\u636E\\u5E93\\u63D2\\u5165\\u6570\\u636E\"]}),(0,n.jsx)(e.pre,{className:\"language-ts\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-ts\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" PrismaClient \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'@prisma/client'\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// initialize Prisma Client\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" prisma \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PrismaClient\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"main\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"await\"}),\" prisma\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"permission\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"createMany\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    data\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        name\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'\\u7528\\u6237\\u7BA1\\u7406'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        code\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'user_management'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        name\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'\\u89C6\\u9891\\u7BA1\\u7406'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        code\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'video_management'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"await\"}),\" prisma\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"role\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"create\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    data\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      name\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'\\u8D85\\u7EA7\\u7BA1\\u7406\\u5458'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      permissions\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        create\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            assignedAt\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Date\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            permission\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              connect\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                code\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'video_management'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            assignedAt\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Date\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            permission\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              connect\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                code\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'user_management'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"await\"}),\" prisma\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"role\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"create\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    data\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      name\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'\\u89C6\\u9891\\u7BA1\\u7406\\u5458'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      permissions\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        create\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            assignedAt\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Date\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            permission\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              connect\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                code\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'video_management'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token function\",children:\"main\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"catch\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"e\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"console\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"error\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"e\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    process\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"exit\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"finally\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// close Prisma Client at the end\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"await\"}),\" prisma\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"$disconnect\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"\\u6267\\u884C\",(0,n.jsx)(e.code,{children:\"npx ts-node prisma/seed.ts\"}),\"\\uFF0C\\u5C31\\u53EF\\u4EE5\\u521D\\u59CB\\u5316\\u89D2\\u8272\\u548C\\u6743\\u9650\\u6570\\u636E\\u4E86\\uFF0C\\u4E0A\\u8FF0\\u4EE3\\u7801\\u4E2D\\u6211\\u4EEC\\u8BBE\\u7F6E\\u4E86 2 \\u4E2A\\u89D2\\u8272\\uFF0C\\u5206\\u522B\\u4E3A\\u8D85\\u7EA7\\u7BA1\\u7406\\u5458\\u548C\\u89C6\\u9891\\u7BA1\\u7406\\u5458\\uFF0C\\u6DFB\\u52A0\\u4E86 2 \\u4E2A\\u6743\\u9650\\u5206\\u522B\\u4E3A\\u89C6\\u9891\\u7BA1\\u7406\\u548C\\u7528\\u6237\\u7BA1\\u7406\\u5E76\\u4E14\\u8BBE\\u7F6E\\u4E86\\u552F\\u4E00\\u952E code\\uFF0Ccode \\u53EF\\u4EE5\\u62E5\\u6709\\u524D\\u7AEF\\u6743\\u9650\\u7684\\u5224\\u65AD\\u3002\"]}),(0,n.jsxs)(e.h2,{id:\"\\u540E\\u7AEF\\u63A5\\u53E3\\u8BBE\\u8BA1\",children:[(0,n.jsx)(e.a,{href:\"#\\u540E\\u7AEF\\u63A5\\u53E3\\u8BBE\\u8BA1\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\u540E\\u7AEF\\u63A5\\u53E3\\u8BBE\\u8BA1\"]}),(0,n.jsxs)(e.p,{children:[\"\\u6709\\u4E86\\u6570\\u636E\\u5E93\\u548C\\u6570\\u636E\\u6211\\u4EEC\\u4FBF\\u53EF\\u4EE5\\u5B9E\\u73B0\\u4E00\\u4E2A\\u63A5\\u53E3\\uFF0C\\u201C\\u7528\\u6237\\u4FE1\\u606F\\u63A5\\u53E3\\u201D\\uFF0C\\u6211\\u4EEC\\u5C06\\u5B83\\u5B9A\\u4E49\\u4E3A\",(0,n.jsx)(e.code,{children:\"/api/user/me\"}),\"\\uFF0C\\u7528\\u4E8E\\u8FD4\\u56DE\\u6743\\u9650\\u4FE1\\u606F\"]}),(0,n.jsxs)(e.p,{children:[\"\\u65B0\\u5EFA\\u4E00\\u4E2A\",(0,n.jsx)(e.code,{children:\"pages/api/me.ts\"}),\" \\u6587\\u4EF6, \\u4EE3\\u7801\\u5982\\u4E0B\"]}),(0,n.jsx)(e.pre,{className:\"language-ts\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-ts\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" authOptions \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'@/pages/api/auth/[...nextauth]'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" unstable_getServerSession \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'next-auth/next'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" prisma \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'@/lib/prisma'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" makeSerializable \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'@/lib/util'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" NextApiRequest\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" NextApiResponse \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'next'\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"export\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"default\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"handler\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"req\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" NextApiRequest\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" res\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" NextApiResponse\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" session \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"await\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"unstable_getServerSession\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" authOptions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"!\"}),\"session\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"status\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"401\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"json\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" message\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'You must be logged in.'\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" user \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"await\"}),\" prisma\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"user\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"findFirst\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    where\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      id\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" session\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"id \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" permissionsOnRoles \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"await\"}),\" prisma\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"permissionsOnRoles\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"findMany\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    where\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      roleId\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" user\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"roleId\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" ids \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" permissionsOnRoles\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"map\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"item\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\u003e\"}),\" item\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"permissionId\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" permissions \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"await\"}),\" prisma\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"permission\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"findMany\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    where\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      id\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" ids\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"json\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    user\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    permissions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"\\u4E0A\\u9762\\u7684\\u4EE3\\u7801\\u4E2D\\uFF0C\\u67E5\\u8BE2\\u6B65\\u9AA4\\u4E3A\\uFF1A\"}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:\"\\u5148\\u901A\\u8FC7 session \\u83B7\\u5F97\\u7528\\u6237 id\"}),(0,n.jsx)(e.li,{children:\"\\u901A\\u8FC7\\u7528\\u6237 id \\u67E5\\u8BE2\\u7528\\u6237\\u4FE1\\u606F\\uFF0C\\u83B7\\u5F97\\u89D2\\u8272 id\"}),(0,n.jsx)(e.li,{children:\"\\u901A\\u8FC7\\u89D2\\u8272 id \\u67E5\\u8BE2\\u5173\\u8054\\u8868\\uFF0C\\u83B7\\u5F97\\u6743\\u9650 id\"}),(0,n.jsx)(e.li,{children:\"\\u518D\\u901A\\u8FC7\\u6743\\u9650 id \\u67E5\\u8BE2\\u6743\\u9650\\u4FE1\\u606F\\u3002\"})]}),(0,n.jsx)(e.p,{children:\"\\u4EE5\\u4E0A\\u4EE3\\u7801\\u4FBF\\u662F\\u591A\\u5BF9\\u591A\\u67E5\\u8BE2\\u8FC7\\u7A0B\\uFF0C\\u8BBF\\u95EE\\u63A5\\u53E3\\uFF0C\\u5C31\\u53EF\\u4EE5\\u83B7\\u5F97\\u5F53\\u524D\\u7528\\u6237\\u7684\\u6743\\u9650\\u4FE1\\u606F\\u4E86\\u3002\"}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:\"\\u6743\\u9650\\u63A5\\u53E3\\u67E5\\u8BE2\",src:\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1a8504e2079f45cbb9369c6296283234~tplv-k3u1fbpfcp-zoom-1.image\"})}),(0,n.jsx)(e.p,{children:\"\\u90A3\\u4E48\\u524D\\u7AEF\\u5C31\\u53EF\\u4EE5\\u901A\\u8FC7\\u8BE5\\u63A5\\u53E3\\u6765\\u5224\\u65AD\\u529F\\u80FD\\u6743\\u9650\\u4E86\\uFF0C\\u81F3\\u6B64\\u540E\\u7AEF\\u6743\\u9650\\u90E8\\u5206\\u5C31\\u5B8C\\u6210\\u4E86\\u3002\"}),(0,n.jsxs)(e.h2,{id:\"react-\\u4E2D\\u5B9E\\u73B0\\u6743\\u9650\\u7BA1\\u7406\",children:[(0,n.jsx)(e.a,{href:\"#react-\\u4E2D\\u5B9E\\u73B0\\u6743\\u9650\\u7BA1\\u7406\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"React \\u4E2D\\u5B9E\\u73B0\\u6743\\u9650\\u7BA1\\u7406\"]}),(0,n.jsxs)(e.p,{children:[\"\\u5728 React \\u4E2D\\u5B9E\\u73B0\\u72B6\\u6001\\u7BA1\\u7406\\uFF0C\\u6211\\u4EEC\\u53EF\\u4EE5\\u5728\\u6574\\u4E2A App \\u7EC4\\u4EF6\\uFF08\\u8DDF\\u7EC4\\u4EF6\\uFF09\\u6E32\\u67D3\\u524D\\u9009\\u8BF7\\u6C42\",(0,n.jsx)(e.code,{children:\"me\"}),\"\\u63A5\\u53E3\\uFF0C\\u7136\\u540E\\u901A\\u8FC7 \",(0,n.jsx)(e.code,{children:\"React Context\"}),\" \\u5C06 permission \\u4FE1\\u606F\\u8FDB\\u884C\\u5168\\u5C40\\u72B6\\u6001\\u7BA1\\u7406\\uFF0C\\u8FD9\\u6837\\u6211\\u4EEC\\u5C31\\u53EF\\u4EE5\\u5728\\u4EFB\\u610F\\u7EC4\\u4EF6\\u83B7\\u53D6\\u6743\\u9650\\u4FE1\\u606F\\uFF0C\\u8FDB\\u884C\\u6743\\u9650\\u5224\\u65AD\\u4E86\\u3002\"]}),(0,n.jsx)(e.pre,{className:\"language-tsx\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-tsx\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token imports\",children:[(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"React\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" useContext\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" useEffect \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'react'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsx)(e.span,{className:\"token imports\",children:\"axios\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'axios'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token imports\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" createBrowserRouter\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"RouterProvider\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"Route\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"Outlet\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'react-router-dom'\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"PermissionContext\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"React\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function property-access method\",children:\"createContext\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token function function-variable\",children:\"usePermission\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"useContext\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"PermissionContext\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"Permission\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" code\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" children \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" permissions \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"usePermission\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"permissions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function property-access method\",children:\"includes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"code\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),` children\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"null\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"export\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"default\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"App\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"permissions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" setPermissions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"React\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function property-access method\",children:\"useState\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token function\",children:\"useEffect\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator arrow\",children:\"=\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    axios\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function property-access method\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'/api/user/me'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function property-access method\",children:\"then\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator arrow\",children:\"=\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" permissions \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"data\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function property-access method\",children:\"map\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"item\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator arrow\",children:\"=\u003e\"}),\" item\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"code\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token function\",children:\"setPermissions\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"permissions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c\"}),\"div\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),(0,n.jsx)(e.span,{className:\"token plain-text\",children:`\n`})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token plain-text\",children:\"      \"}),(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PermissionContext.Provider\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"value\"}),(0,n.jsxs)(e.span,{className:\"token language-javascript script\",children:[(0,n.jsx)(e.span,{className:\"token punctuation script-punctuation\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"permissions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),(0,n.jsx)(e.span,{className:\"token plain-text\",children:`\n`})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token plain-text\",children:\"        \"}),(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"RouterProvider\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"router\"}),(0,n.jsxs)(e.span,{className:\"token language-javascript script\",children:[(0,n.jsx)(e.span,{className:\"token punctuation script-punctuation\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"router\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"/\u003e\"})]}),(0,n.jsx)(e.span,{className:\"token plain-text\",children:`\n`})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token plain-text\",children:\"      \"}),(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c/\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PermissionContext.Provider\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),(0,n.jsx)(e.span,{className:\"token plain-text\",children:`\n`})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token plain-text\",children:\"    \"}),(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"div\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"\\u4E0A\\u9762\\u4EE3\\u7801\\u4E2D\\uFF0C\\u6211\\u4EEC\\u521B\\u5EFA\\u4E86\\u4E00\\u4E2A\\u6211\\u4EEC\\u5B9A\\u4E49\\u4E86\\u4E00\\u4E2A\",(0,n.jsx)(e.code,{children:\"Permission\"}),\"\\u7EC4\\u4EF6\\uFF0C\\u90A3\\u4E48\\u5728\\u9879\\u76EE\\u4E2D\\uFF0C\\u53EA\\u8981\\u5728\\u8981\\u5224\\u65AD\\u6743\\u9650\\u7684\\u5730\\u65B9\\u4F7F\\u7528\\u8BE5\\u7EC4\\u4EF6\\uFF0C\\u82E5\\u6CA1\\u6709\\u6743\\u9650\\uFF0C\\u5219\\u4F1A\\u4E0D\\u663E\\u793A\\u3002\\u6211\\u4EEC\\u8FD8\\u5B9A\\u4E49\\u4E86\\u4E00\\u4E2A\",(0,n.jsx)(e.code,{children:\"usePermission\"}),\" \\u81EA\\u5B9A\\u4E49 hooks\\uFF0C\\u8FD9\\u6837\\u5728\\u540E\\u7EED\\u5F00\\u53D1\\u4E2D\\uFF0C\\u82E5\\u8981\\u4F7F\\u7528\\u5230\\u6743\\u9650\\uFF0C\\u6211\\u4EEC\\u5C31\\u53EF\\u4EE5\\u76F4\\u63A5\\u4F7F\\u7528\\u8FD9\\u4E2A Hooks\\uFF0C\\u754C\\u9762 UI \\u4E5F\\u53EF\\u4EE5\\u91CD\\u65B0\\u5B9A\\u4E49\\u4E86\\u3002\"]}),(0,n.jsxs)(e.p,{children:[\"\\u6BD4\\u5982\\u5728 React-router \\u8DEF\\u7531\\uFF08V6\\uFF09\\u4E2D\\uFF0C\\u76F4\\u63A5\\u5D4C\\u5957\\u4E00\\u4E2A\",(0,n.jsx)(e.code,{children:\"Permission\"}),\" \\u7EC4\\u4EF6\\u4FBF\\u53EF\\u4EE5\\u5B9E\\u73B0\\u6743\\u9650\\u63A7\\u5236\\u4E86\\u3002\"]}),(0,n.jsx)(e.pre,{className:\"language-jsx\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-jsx\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" router \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"createBrowserRouter\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"path\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'/'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"element\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c\"}),\"div\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),(0,n.jsx)(e.span,{className:\"token plain-text\",children:\"\\u9996\\u9875\"}),(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"div\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"path\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'/login'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"element\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c\"}),\"div\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),(0,n.jsx)(e.span,{className:\"token plain-text\",children:\"\\u767B\\u5F55\"}),(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"div\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"path\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'/admin'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"element\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c\"}),\"div\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),(0,n.jsx)(e.span,{className:\"token plain-text\",children:`\n`})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token plain-text\",children:\"        \\u540E\\u53F0\\u7BA1\\u7406 \"}),(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Outlet\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"/\u003e\"})]}),(0,n.jsx)(e.span,{className:\"token plain-text\",children:`\n`})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token plain-text\",children:\"      \"}),(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"div\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"children\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"path\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'user'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"element\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Permission\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"code\"}),(0,n.jsxs)(e.span,{className:\"token attr-value\",children:[(0,n.jsx)(e.span,{className:\"token punctuation attr-equals\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:'\"'}),\"user_management\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:'\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),(0,n.jsx)(e.span,{className:\"token plain-text\",children:`\n`})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token plain-text\",children:\"            \"}),(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c\"}),\"div\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),(0,n.jsx)(e.span,{className:\"token plain-text\",children:\"\\u7528\\u6237\\u7BA1\\u7406\"}),(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"div\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),(0,n.jsx)(e.span,{className:\"token plain-text\",children:`\n`})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token plain-text\",children:\"          \"}),(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c/\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Permission\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"path\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'video'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"element\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Permission\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"code\"}),(0,n.jsxs)(e.span,{className:\"token attr-value\",children:[(0,n.jsx)(e.span,{className:\"token punctuation attr-equals\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:'\"'}),\"user_management\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:'\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),(0,n.jsx)(e.span,{className:\"token plain-text\",children:`\n`})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token plain-text\",children:\"            \"}),(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c\"}),\"div\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),(0,n.jsx)(e.span,{className:\"token plain-text\",children:\"\\u89C6\\u9891\\u7BA1\\u7406\"}),(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"div\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),(0,n.jsx)(e.span,{className:\"token plain-text\",children:`\n`})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token plain-text\",children:\"          \"}),(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003c/\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Permission\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,n.jsxs)(e.h2,{id:\"nextjs-\\u5B9E\\u73B0\\u6743\\u9650\\u7BA1\\u7406\",children:[(0,n.jsx)(e.a,{href:\"#nextjs-\\u5B9E\\u73B0\\u6743\\u9650\\u7BA1\\u7406\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Next.js \\u5B9E\\u73B0\\u6743\\u9650\\u7BA1\\u7406\"]}),(0,n.jsx)(e.p,{children:\"\\u5728 Next.js \\u4E2D\\uFF0C\\u6211\\u4EEC\\u53EF\\u4EE5\\u540C React \\u4E00\\u6837\\u7684\\u65B9\\u5F0F\\u6765\\u5B9E\\u73B0\\u6743\\u9650\\u63A7\\u5236\\u3002\\u82E5\\u662F\\u670D\\u52A1\\u7AEF\\u6E32\\u67D3\\u7684\\u9875\\u9762\\uFF0C\\u6211\\u4EEC\\u4E5F\\u53EF\\u4EE5\\u5728\\u670D\\u52A1\\u7AEF\\u63A7\\u5236\\u3002\"}),(0,n.jsx)(e.pre,{className:\"language-js\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-js\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token imports\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" authOptions \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'@/pages/api/auth/[...nextauth]'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token imports\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" unstable_getServerSession \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'next-auth/next'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"import\"}),\" \",(0,n.jsx)(e.span,{className:\"token imports\",children:\"prisma\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'@/lib/prisma'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token imports\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" makeSerializable \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'@/lib/util'\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"export\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"getServerSideProps\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token parameter\",children:\"context\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" session \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"await\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"unstable_getServerSession\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"req\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"res\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" authOptions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"!\"}),\"session\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"redirect\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"destination\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'/403'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"permanent\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"false\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"//const permissions =  prisma query\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"!\"}),\"permissions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function property-access method\",children:\"includes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'video_management'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"props\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"errorCode\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"403\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" data \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"await\"}),\" prisma\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"video\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function property-access method\",children:\"findMany\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"include\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"author\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"true\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"props\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      session\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"data\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"makeSerializable\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"data\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"\\u540C\\u63A5\\u53E3\\u7684\\u65B9\\u5F0F\\u4E00\\u81F4\\uFF0C\\u6211\\u4EEC\\u4E5F\\u53EF\\u4EE5\\u5728 \",(0,n.jsx)(e.code,{children:\"getServerSideProps\"}),\" \\u901A\\u8FC7\\u83B7\\u5F97 \",(0,n.jsx)(e.code,{children:\"session\"}),\"\\uFF0C\\u7136\\u540E\\u83B7\\u5F97\\u7528\\u6237\\u6743\\u9650\\uFF0C\\u518D\\u901A\\u8FC7\\u6743\\u9650\\u5224\\u65AD\\uFF0C\\u662F\\u5426\\u8BA9\\u9875\\u9762\\u663E\\u793A 403\\u3002\"]}),(0,n.jsxs)(e.p,{children:[\"\\u90A3\\u5982\\u679C\\u6709\\u591A\\u4E2A\\u9875\\u9762\\u6709\\u9700\\u8981\\u6743\\u9650\\u5224\\u65AD\\uFF0C\\u8BE5\\u600E\\u4E48\\u529E\\u5462\\uFF1F\\u6211\\u4EEC\\u53EF\\u4EE5\\u5728\\u6839\\u76EE\\u5F55\\u4E0B\\u5EFA\\u7ACB\\u4E00\\u4E2A\",(0,n.jsx)(e.code,{children:\"middleware.js\"}),\", \\u4E2D\\u95F4\\u4EF6\\u4F1A\\u5728\\u6BCF\\u4E2A\\u8BF7\\u6C42\\u7684\\u65F6\\u5019\\u6267\\u884C\\u3002\"]}),(0,n.jsx)(e.pre,{className:\"language-js\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-js\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token imports\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" getToken \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"next-auth/jwt\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token imports\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"NextResponse\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"next/server\"'}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"export\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"middleware\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token parameter\",children:\"req\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// \\u5982\\u679Curl\\u4E0D\\u5E94\\u8BE5\\u53D7\\u5230\\u4FDD\\u62A4\\uFF0C\\u8BF7\\u5C3D\\u65E9\\u8FD4\\u56DE\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"!\"}),\"req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"url\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function property-access method\",children:\"includes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"/protected-url\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"NextResponse\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function property-access method\",children:\"next\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" session \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"await\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"getToken\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"secret\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" process\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"env\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"SECRET\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"!\"}),\"session\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"NextResponse\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function property-access method\",children:\"redirect\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"/api/auth/signin\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token operator spread\",children:\"...\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// \\u5982\\u679C\\u6388\\u6743\\u901A\\u8FC7\\u5219\\u7EE7\\u7EED\\u3002\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"NextResponse\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function property-access method\",children:\"next\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"\\u5728\\u4E2D\\u95F4\\u4EF6\\u4E2D\\uFF0C\\u6211\\u4EEC\\u4E5F\\u53EF\\u4EE5\\u83B7\\u5F97\",(0,n.jsx)(e.code,{children:\"session\"}),\"\\uFF0C\\u90A3\\u4E48\\u4E0E api \\u63A5\\u53E3\\u4E00\\u6837\\uFF0C\\u5C31\\u53EF\\u4EE5\\u5728\\u4E2D\\u95F4\\u4EF6\\u4E2D\\u5224\\u65AD\\u6743\\u9650\\u4FE1\\u606F\\u4E86\\uFF0C\\u6709\\u4E00\\u70B9\\u9700\\u8981\\u6CE8\\u610F\\u7684\\u662F\\uFF0CUrl \\u4E0D\\u9700\\u8981\\u6743\\u9650\\u5224\\u65AD\\uFF0C\\u6211\\u4EEC\\u5E94\\u8BE5\\u5C3D\\u65E9\\u8FD4\\u56DE\\uFF0C\\u8FD9\\u6837\\u53EF\\u4EE5\\u907F\\u514D\\u591A\\u4F59\\u7684\\u67E5\\u8BE2\\u3002\"]}),(0,n.jsxs)(e.h2,{id:\"\\u5C0F\\u7ED3\",children:[(0,n.jsx)(e.a,{href:\"#\\u5C0F\\u7ED3\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\u5C0F\\u7ED3\"]}),(0,n.jsx)(e.p,{children:\"\\u672C\\u6587\\u4EE5\\u89C6\\u9891\\u7F51\\u7AD9\\u4E3A\\u4F8B\\uFF0C\\u8BB2\\u89E3\\u4E86\\u6743\\u9650\\u7CFB\\u7EDF\\u7684\\u8BBE\\u8BA1\\u4E0E\\u5B9E\\u73B0\\uFF0C\\u4E3B\\u8981\\u6D89\\u53CA\\u5230\\u7684\\u77E5\\u8BC6\\u70B9\\u6709\\uFF1A\"}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:\"\\u540E\\u7AEF\\u57FA\\u4E8E\\u89D2\\u8272\\u8868\\u548C\\u6743\\u9650\\u8868\\uFF0C\\u591A\\u5BF9\\u591A\\u8868\\u7ED3\\u6784\\u8BBE\\u8BA1\"}),(0,n.jsx)(e.li,{children:\"Prisma \\u4E2D\\u5B9E\\u73B0\\u591A\\u5BF9\\u591A\\u5173\\u7CFB\\u67E5\\u8BE2\"}),(0,n.jsx)(e.li,{children:\"\\u524D\\u7AEF\\u4F7F\\u7528 React Context \\u548C \\u81EA\\u5B9A\\u4E49 hooks \\u5B9E\\u73B0\\u5168\\u5C40\\u72B6\\u6001\\u7BA1\\u7406\"}),(0,n.jsxs)(e.li,{children:[\"\\u5229\\u7528 Next.js \\u7684 \",(0,n.jsx)(e.a,{href:\"https://gist.github.com/balazsorban44/30e2267fe1105529f217acbe3763b468\",title:\"NextAuth.js Auth Middleware for Next.js 12\",children:\"middleware\"}),\" \\u4E5F\\u53EF\\u4EE5\\u83B7\\u5F97 session\\uFF0C\\u5E76\\u4E14\\u7528\\u4E8E\\u6743\\u9650\\u5224\\u65AD\\u3002\"]})]}),(0,n.jsx)(e.p,{children:\"\\u597D\\u4E86\\uFF0C\\u4EE5\\u4E0A\\u5C31\\u662F\\u672C\\u6587\\u7684\\u5168\\u90E8\\u5185\\u5BB9\\uFF0C\\u4F60\\u5B66\\u4F1A\\u4E86\\u5417\\uFF1F\\u63A5\\u4E0B\\u6765\\u6211\\u5C06\\u7EE7\\u7EED\\u5206\\u4EAB Next.js \\u76F8\\u5173\\u7684\\u5B9E\\u6218\\u6587\\u7AE0\\uFF0C\\u6B22\\u8FCE\\u5404\\u4F4D\\u5173\\u6CE8\\u6211\\u7684\\u300ANext.js \\u5168\\u6808\\u5F00\\u53D1\\u5B9E\\u6218\\u300B \\u4E13\\u680F\\uFF0C\\u611F\\u8C22\\u60A8\\u7684\\u9605\\u8BFB\\u3002\"})]})}}var b=x;return w(v);})();\n;return Component;","toc":[{"value":"前言","url":"#前言","depth":2},{"value":"权限区分","url":"#权限区分","depth":2},{"value":"权限系统设计","url":"#权限系统设计","depth":2},{"value":"后端接口设计","url":"#后端接口设计","depth":2},{"value":"React 中实现权限管理","url":"#react-中实现权限管理","depth":2},{"value":"Next.js 实现权限管理","url":"#nextjs-实现权限管理","depth":2},{"value":"小结","url":"#小结","depth":2}],"frontMatter":{"readingTime":{"text":"12 min read","minutes":11.905,"time":714300,"words":2381},"slug":"Next.js 应用实现权限管理","fileName":"Next.js 应用实现权限管理.md","title":"Next.js 应用实现权限管理","date":"2022-11-14T14:48:39.000Z","lastmod":"2023/1/25 11:42:28","tags":["React.js"],"draft":false,"summary":"今天我们就聊一聊权限系统的设计与实现，要在网站中实现复杂的权限管理对应新手来说，这可能会是比较困难的，但权限系统是软件中不可或缺的部分，我们只要掌握一个套路，就会变得非常简单，一起来看看吧！","images":"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1e6342307e9244edb7650de27adf8eda~tplv-k3u1fbpfcp-watermark.image?","authors":["default"],"layout":"PostLayout"}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.19,"time":11400,"words":38},"slug":["default"],"fileName":"default.md","name":"随风","avatar":"/static/images/avatar.jpeg","occupation":"前端工程师","company":"分享 JavaScript 热门框架，记录前端工程师学习成长历程。","email":"tianping888@163.com","juejin":"https://juejin.cn","zhihu":"https://www.zhihu.com","github":"https://github.com/balac2015","date":null}],"prev":{"title":"理解 Next.js 中的 CSR、SSR、SSG、ISR 以及 Streaming","date":"2022-11-06T05:51:14.000Z","lastmod":"2023/1/25 11:42:31","tags":["React.js"],"draft":false,"summary":"Next.js 提供了 CSR、SSR、SSG、ISR、 Streaming 这么多渲染方式，本文就从渲染方式方面来讲解，让我们可以更好地理解 Next.js 以及使用 Next.js。","images":"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/12e21e255cc44345a47656fb5ac37f3b~tplv-k3u1fbpfcp-watermark.image?","authors":["default"],"layout":"PostLayout","slug":"理解 Next.js 中的 CSR、SSR、SSG、ISR 以及 Streaming"},"next":{"title":"使用 Next.js 搭建 Monorepo 组件库文档","date":"2022-11-22T16:59:38.000Z","lastmod":"2023/1/25 11:42:26","tags":["前端","React.js"],"draft":false,"summary":"本文，我们从零开始，使用 Next.js 和 pnpm 搭建了一个组件库文档，主要使用 Next.js 动态导入功能解决了开发服务缓慢的问题，使用 Next.js 的 SSG 模式来生成静态文档。","images":"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f99c63bee274496982410a51624c9069~tplv-k3u1fbpfcp-watermark.image?","authors":["default"],"layout":"PostLayout","slug":"使用 Next.js 搭建 Monorepo 组件库文档"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["Next.js 应用实现权限管理"]},"buildId":"aH9txFemS00-bQZ7Vq_Y7","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>